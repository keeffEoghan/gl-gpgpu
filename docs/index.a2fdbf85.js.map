{"mappings":"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","sources":[".yarn/cache/@thi.ng-math-npm-5.4.0-52f68754e2-399736a0ad.zip/node_modules/@thi.ng/math/interval.js",".yarn/cache/@thi.ng-math-npm-5.4.0-52f68754e2-399736a0ad.zip/node_modules/@thi.ng/math/fit.js",".yarn/cache/@thi.ng-errors-npm-2.2.8-2edd338dd8-187a4df7da.zip/node_modules/@thi.ng/errors/deferror.js",".yarn/cache/@thi.ng-errors-npm-2.2.8-2edd338dd8-187a4df7da.zip/node_modules/@thi.ng/errors/unsupported.js",".yarn/cache/@thi.ng-vectors-npm-7.5.31-856e2d4358-7bbc6b9925.zip/node_modules/@thi.ng/vectors/vop.js",".yarn/cache/@thi.ng-matrices-npm-2.1.40-df846732bf-ed21d92c96.zip/node_modules/@thi.ng/matrices/constants.js",".yarn/cache/@thi.ng-errors-npm-2.2.8-2edd338dd8-187a4df7da.zip/node_modules/@thi.ng/errors/illegal-arity.js",".yarn/cache/@thi.ng-compose-npm-2.1.24-c983939304-329c0d01d6.zip/node_modules/@thi.ng/compose/comp.js",".yarn/cache/@thi.ng-checks-npm-3.3.7-ec6d5a227d-780008a6c0.zip/node_modules/@thi.ng/checks/implements-function.js",".yarn/cache/@thi.ng-transducers-npm-8.3.30-f46a255a0a-af111041a1.zip/node_modules/@thi.ng/transducers/ensure.js",".yarn/cache/@thi.ng-transducers-npm-8.3.30-f46a255a0a-af111041a1.zip/node_modules/@thi.ng/transducers/comp.js",".yarn/cache/@thi.ng-checks-npm-3.3.7-ec6d5a227d-780008a6c0.zip/node_modules/@thi.ng/checks/is-iterable.js",".yarn/cache/@thi.ng-transducers-npm-8.3.30-f46a255a0a-af111041a1.zip/node_modules/@thi.ng/transducers/compr.js",".yarn/cache/@thi.ng-api-npm-8.6.3-a92669c76e-dcaf304f7b.zip/node_modules/@thi.ng/api/api.js",".yarn/cache/@thi.ng-transducers-npm-8.3.30-f46a255a0a-af111041a1.zip/node_modules/@thi.ng/transducers/reduced.js",".yarn/cache/@thi.ng-transducers-npm-8.3.30-f46a255a0a-af111041a1.zip/node_modules/@thi.ng/transducers/reduce.js",".yarn/cache/@thi.ng-checks-npm-3.3.7-ec6d5a227d-780008a6c0.zip/node_modules/@thi.ng/checks/is-arraylike.js",".yarn/cache/@thi.ng-transducers-npm-8.3.30-f46a255a0a-af111041a1.zip/node_modules/@thi.ng/transducers/push.js",".yarn/cache/@thi.ng-transducers-npm-8.3.30-f46a255a0a-af111041a1.zip/node_modules/@thi.ng/transducers/iterator.js",".yarn/cache/@thi.ng-transducers-npm-8.3.30-f46a255a0a-af111041a1.zip/node_modules/@thi.ng/transducers/map.js",".yarn/cache/@thi.ng-transducers-npm-8.3.30-f46a255a0a-af111041a1.zip/node_modules/@thi.ng/transducers/map-indexed.js",".yarn/cache/@thi.ng-transducers-npm-8.3.30-f46a255a0a-af111041a1.zip/node_modules/@thi.ng/transducers/range.js",".yarn/cache/@thi.ng-transducers-npm-8.3.30-f46a255a0a-af111041a1.zip/node_modules/@thi.ng/transducers/str.js",".yarn/cache/@thi.ng-transducers-npm-8.3.30-f46a255a0a-af111041a1.zip/node_modules/@thi.ng/transducers/take.js",".yarn/cache/@thi.ng-transducers-npm-8.3.30-f46a255a0a-af111041a1.zip/node_modules/@thi.ng/transducers/transduce.js",".yarn/cache/@thi.ng-transducers-npm-8.3.30-f46a255a0a-af111041a1.zip/node_modules/@thi.ng/transducers/zip.js",".yarn/cache/@thi.ng-vectors-npm-7.5.31-856e2d4358-7bbc6b9925.zip/node_modules/@thi.ng/vectors/compile/templates.js",".yarn/cache/@thi.ng-vectors-npm-7.5.31-856e2d4358-7bbc6b9925.zip/node_modules/@thi.ng/vectors/compile/emit.js",".yarn/cache/@thi.ng-vectors-npm-7.5.31-856e2d4358-7bbc6b9925.zip/node_modules/@thi.ng/vectors/set.js",".yarn/cache/@thi.ng-matrices-npm-2.1.40-df846732bf-ed21d92c96.zip/node_modules/@thi.ng/matrices/set.js",".yarn/cache/@thi.ng-matrices-npm-2.1.40-df846732bf-ed21d92c96.zip/node_modules/@thi.ng/matrices/identity.js",".yarn/cache/@thi.ng-math-npm-5.4.0-52f68754e2-399736a0ad.zip/node_modules/@thi.ng/math/api.js",".yarn/cache/@thi.ng-math-npm-5.4.0-52f68754e2-399736a0ad.zip/node_modules/@thi.ng/math/angle.js",".yarn/cache/@thi.ng-vectors-npm-7.5.31-856e2d4358-7bbc6b9925.zip/node_modules/@thi.ng/vectors/magsq.js",".yarn/cache/@thi.ng-vectors-npm-7.5.31-856e2d4358-7bbc6b9925.zip/node_modules/@thi.ng/vectors/muln.js",".yarn/cache/@thi.ng-vectors-npm-7.5.31-856e2d4358-7bbc6b9925.zip/node_modules/@thi.ng/vectors/normalize.js",".yarn/cache/@thi.ng-vectors-npm-7.5.31-856e2d4358-7bbc6b9925.zip/node_modules/@thi.ng/vectors/setc.js",".yarn/cache/@thi.ng-matrices-npm-2.1.40-df846732bf-ed21d92c96.zip/node_modules/@thi.ng/matrices/m33-m44.js",".yarn/cache/@thi.ng-matrices-npm-2.1.40-df846732bf-ed21d92c96.zip/node_modules/@thi.ng/matrices/rotation-around-axis.js",".yarn/cache/@thi.ng-matrices-npm-2.1.40-df846732bf-ed21d92c96.zip/node_modules/@thi.ng/matrices/frustum.js",".yarn/cache/@thi.ng-matrices-npm-2.1.40-df846732bf-ed21d92c96.zip/node_modules/@thi.ng/matrices/perspective.js",".yarn/cache/@thi.ng-vectors-npm-7.5.31-856e2d4358-7bbc6b9925.zip/node_modules/@thi.ng/vectors/cross.js",".yarn/cache/@thi.ng-vectors-npm-7.5.31-856e2d4358-7bbc6b9925.zip/node_modules/@thi.ng/vectors/dot.js",".yarn/cache/@thi.ng-vectors-npm-7.5.31-856e2d4358-7bbc6b9925.zip/node_modules/@thi.ng/vectors/sub.js",".yarn/cache/@thi.ng-matrices-npm-2.1.40-df846732bf-ed21d92c96.zip/node_modules/@thi.ng/matrices/lookat.js",".yarn/cache/@thi.ng-vectors-npm-7.5.31-856e2d4358-7bbc6b9925.zip/node_modules/@thi.ng/vectors/dots.js",".yarn/cache/@thi.ng-matrices-npm-2.1.40-df846732bf-ed21d92c96.zip/node_modules/@thi.ng/matrices/mulm.js",".yarn/cache/@thi.ng-matrices-npm-2.1.40-df846732bf-ed21d92c96.zip/node_modules/@thi.ng/matrices/concat.js",".yarn/cache/@thi.ng-matrices-npm-2.1.40-df846732bf-ed21d92c96.zip/node_modules/@thi.ng/matrices/mulv.js",".yarn/cache/@thi.ng-vectors-npm-7.5.31-856e2d4358-7bbc6b9925.zip/node_modules/@thi.ng/vectors/dotc.js",".yarn/cache/@thi.ng-matrices-npm-2.1.40-df846732bf-ed21d92c96.zip/node_modules/@thi.ng/matrices/determinant.js",".yarn/cache/@thi.ng-matrices-npm-2.1.40-df846732bf-ed21d92c96.zip/node_modules/@thi.ng/matrices/invert.js",".yarn/cache/@thi.ng-errors-npm-2.2.2-79c8f729f8-a8144abc8c.zip/node_modules/@thi.ng/errors/deferror.js",".yarn/cache/@thi.ng-errors-npm-2.2.2-79c8f729f8-a8144abc8c.zip/node_modules/@thi.ng/errors/illegal-arity.js",".yarn/cache/@thi.ng-compose-npm-2.1.15-44e9fea825-cff680a1f8.zip/node_modules/@thi.ng/compose/comp.js",".yarn/cache/@thi.ng-checks-npm-3.2.6-5d8affb4e8-b29235850c.zip/node_modules/@thi.ng/checks/implements-function.js",".yarn/cache/@thi.ng-transducers-npm-8.3.17-84620dd479-9a17a4ee56.zip/node_modules/@thi.ng/transducers/ensure.js",".yarn/cache/@thi.ng-transducers-npm-8.3.17-84620dd479-9a17a4ee56.zip/node_modules/@thi.ng/transducers/comp.js",".yarn/cache/@thi.ng-checks-npm-3.2.6-5d8affb4e8-b29235850c.zip/node_modules/@thi.ng/checks/is-iterable.js",".yarn/cache/@thi.ng-transducers-npm-8.3.17-84620dd479-9a17a4ee56.zip/node_modules/@thi.ng/transducers/compr.js",".yarn/cache/@thi.ng-api-npm-8.4.3-1eb379d03f-5adb33b09f.zip/node_modules/@thi.ng/api/api.js",".yarn/cache/@thi.ng-transducers-npm-8.3.17-84620dd479-9a17a4ee56.zip/node_modules/@thi.ng/transducers/reduced.js",".yarn/cache/@thi.ng-transducers-npm-8.3.17-84620dd479-9a17a4ee56.zip/node_modules/@thi.ng/transducers/reduce.js",".yarn/cache/@thi.ng-checks-npm-3.2.6-5d8affb4e8-b29235850c.zip/node_modules/@thi.ng/checks/is-arraylike.js",".yarn/cache/@thi.ng-transducers-npm-8.3.17-84620dd479-9a17a4ee56.zip/node_modules/@thi.ng/transducers/push.js",".yarn/cache/@thi.ng-transducers-npm-8.3.17-84620dd479-9a17a4ee56.zip/node_modules/@thi.ng/transducers/iterator.js",".yarn/cache/@thi.ng-transducers-npm-8.3.17-84620dd479-9a17a4ee56.zip/node_modules/@thi.ng/transducers/map.js",".yarn/cache/@thi.ng-transducers-npm-8.3.17-84620dd479-9a17a4ee56.zip/node_modules/@thi.ng/transducers/map-indexed.js",".yarn/cache/@thi.ng-transducers-npm-8.3.17-84620dd479-9a17a4ee56.zip/node_modules/@thi.ng/transducers/range.js",".yarn/cache/@thi.ng-transducers-npm-8.3.17-84620dd479-9a17a4ee56.zip/node_modules/@thi.ng/transducers/str.js",".yarn/cache/@thi.ng-transducers-npm-8.3.17-84620dd479-9a17a4ee56.zip/node_modules/@thi.ng/transducers/take.js",".yarn/cache/@thi.ng-transducers-npm-8.3.17-84620dd479-9a17a4ee56.zip/node_modules/@thi.ng/transducers/transduce.js",".yarn/cache/@thi.ng-transducers-npm-8.3.17-84620dd479-9a17a4ee56.zip/node_modules/@thi.ng/transducers/zip.js",".yarn/cache/@thi.ng-errors-npm-2.2.2-79c8f729f8-a8144abc8c.zip/node_modules/@thi.ng/errors/unsupported.js",".yarn/cache/@thi.ng-vectors-npm-7.5.18-8b6c940b84-4103c301a5.zip/node_modules/@thi.ng/vectors/vop.js",".yarn/cache/@thi.ng-vectors-npm-7.5.18-8b6c940b84-4103c301a5.zip/node_modules/@thi.ng/vectors/compile/templates.js",".yarn/cache/@thi.ng-vectors-npm-7.5.18-8b6c940b84-4103c301a5.zip/node_modules/@thi.ng/vectors/compile/emit.js",".yarn/cache/@thi.ng-vectors-npm-7.5.18-8b6c940b84-4103c301a5.zip/node_modules/@thi.ng/vectors/muln.js",".yarn/cache/@thi.ng-vectors-npm-7.5.18-8b6c940b84-4103c301a5.zip/node_modules/@thi.ng/vectors/div.js",".yarn/cache/@thi.ng-vectors-npm-7.5.18-8b6c940b84-4103c301a5.zip/node_modules/@thi.ng/vectors/divn.js",".yarn/cache/@thi.ng-vectors-npm-7.5.18-8b6c940b84-4103c301a5.zip/node_modules/@thi.ng/vectors/sub.js",".yarn/cache/@thi.ng-vectors-npm-7.5.18-8b6c940b84-4103c301a5.zip/node_modules/@thi.ng/vectors/add.js",".yarn/cache/@thi.ng-vectors-npm-7.5.18-8b6c940b84-4103c301a5.zip/node_modules/@thi.ng/vectors/invert.js",".yarn/cache/@thi.ng-vectors-npm-7.5.18-8b6c940b84-4103c301a5.zip/node_modules/@thi.ng/vectors/setc.js",".yarn/cache/@thi.ng-vectors-npm-7.5.18-8b6c940b84-4103c301a5.zip/node_modules/@thi.ng/vectors/distsq.js",".yarn/cache/@thi.ng-vectors-npm-7.5.18-8b6c940b84-4103c301a5.zip/node_modules/@thi.ng/vectors/dist.js",".yarn/cache/@thi.ng-math-npm-5.3.10-6ff40c3dbd-374cf5d94e.zip/node_modules/@thi.ng/math/api.js",".yarn/cache/@thi.ng-vectors-npm-7.5.18-8b6c940b84-4103c301a5.zip/node_modules/@thi.ng/vectors/magsq.js",".yarn/cache/@thi.ng-vectors-npm-7.5.18-8b6c940b84-4103c301a5.zip/node_modules/@thi.ng/vectors/set.js",".yarn/cache/@thi.ng-vectors-npm-7.5.18-8b6c940b84-4103c301a5.zip/node_modules/@thi.ng/vectors/normalize.js",".yarn/cache/gsl-const-npm-1.0.2-aa478f68bf-f40e554778.zip/node_modules/gsl-const/main.js",".yarn/cache/@epok.tech-fn-time-npm-0.2.1-4ea264980d-08c6bc1abc.zip/node_modules/@epok.tech/fn-time/dist/es/index.js",".yarn/cache/@epok.tech-fn-lists-npm-0.1.4-f8d8e09191-a09750e171.zip/node_modules/@epok.tech/fn-lists/reduce.js",".yarn/cache/@epok.tech-fn-lists-npm-0.1.4-f8d8e09191-a09750e171.zip/node_modules/@epok.tech/fn-lists/map.js",".yarn/cache/@epok.tech-fn-lists-npm-0.1.4-f8d8e09191-a09750e171.zip/node_modules/@epok.tech/fn-lists/each.js",".yarn/cache/@epok.tech-fn-lists-npm-0.1.4-f8d8e09191-a09750e171.zip/node_modules/@epok.tech/fn-lists/range.js",".yarn/cache/@epok.tech-fn-lists-npm-0.1.4-f8d8e09191-a09750e171.zip/node_modules/@epok.tech/fn-lists/wrap-index.js",".yarn/cache/@epok.tech-fn-lists-npm-0.1.4-f8d8e09191-a09750e171.zip/node_modules/@epok.tech/fn-lists/wrap.js",".yarn/cache/@epok.tech-gl-screen-triangle-npm-1.2.1-49978ae6b0-551e98be3c.zip/node_modules/@epok.tech/gl-screen-triangle/dist/esm/index.js","src/const.js","src/index.vert.glsl","src/maps.js","src/size.js","src/data.js","src/uniforms.js",".yarn/cache/@epok.tech-is-type-npm-0.1.0-e4ecb8732b-3e1f1e06b6.zip/node_modules/@epok.tech/is-type/type.js","src/macros.js","src/step.js","src/index.js","src/index-forms/index.js",".yarn/cache/@thi.ng-math-npm-5.4.0-52f68754e2-399736a0ad.zip/node_modules/@thi.ng/math/mix.js",".yarn/cache/@thi.ng-vectors-npm-7.5.18-8b6c940b84-4103c301a5.zip/node_modules/@thi.ng/vectors/maddns.js",".yarn/cache/@thi.ng-vectors-npm-7.5.18-8b6c940b84-4103c301a5.zip/node_modules/@thi.ng/vectors/sets.js",".yarn/cache/@thi.ng-math-npm-5.3.10-6ff40c3dbd-374cf5d94e.zip/node_modules/@thi.ng/math/angle.js",".yarn/cache/@thi.ng-vectors-npm-7.5.18-8b6c940b84-4103c301a5.zip/node_modules/@thi.ng/vectors/api.js",".yarn/cache/@thi.ng-vectors-npm-7.5.18-8b6c940b84-4103c301a5.zip/node_modules/@thi.ng/vectors/cartesian.js","demo/particles-regl/axis2.js","demo/particles-regl/shake.js","demo/particles-regl/index.js","demo/particles-regl/step.frag.glsl","demo/particles-regl/draw.vert.glsl","demo/particles-regl/draw.frag.glsl"],"sourcesContent":["/**\n * Clamps value `x` to given closed interval.\n *\n * @param x - value to clamp\n * @param min - lower bound\n * @param max - upper bound\n */\nexport const clamp = (x, min, max) => (x < min ? min : x > max ? max : x);\n/**\n * Clamps value `x` to closed [0 .. ∞] interval.\n *\n * @param x -\n */\nexport const clamp0 = (x) => (x > 0 ? x : 0);\n/**\n * Clamps value `x` to closed [0 .. 1] interval.\n *\n * @param x -\n */\nexport const clamp01 = (x) => (x < 0 ? 0 : x > 1 ? 1 : x);\n/**\n * Clamps value `x` to closed [-1 .. 1] interval.\n *\n * @param x -\n */\nexport const clamp11 = (x) => (x < -1 ? -1 : x > 1 ? 1 : x);\n/**\n * Clamps value `x` to closed [0 .. 0.5] interval.\n *\n * @param x -\n */\nexport const clamp05 = (x) => (x < 0 ? 0 : x > 0.5 ? 0.5 : x);\n/**\n * Folds `x` back inside closed [min..max] interval. Also see\n * {@link wrapOnce}.\n *\n * @param x -\n * @param min -\n * @param max -\n */\nexport const wrap = (x, min, max) => {\n    if (min === max)\n        return min;\n    if (x > max) {\n        const d = max - min;\n        x -= d;\n        if (x > max)\n            x -= d * (((x - min) / d) | 0);\n    }\n    else if (x < min) {\n        const d = max - min;\n        x += d;\n        if (x < min)\n            x += d * (((min - x) / d + 1) | 0);\n    }\n    return x;\n};\n/**\n * Like {@link wrap}, but optimized for cases where `x` is guaranteed to\n * be in `[min - d, max + d]` interval, where `d = max - min`. Result\n * will be in closed `[min..max]` interval.\n *\n * @param x -\n * @param min -\n * @param max -\n */\nexport const wrapOnce = (x, min, max) => x < min ? x - min + max : x > max ? x - max + min : x;\n/**\n * Similar to {@link wrapOnce} for [0..1] interval.\n *\n * @param x -\n */\nexport const wrap01 = (x) => (x < 0 ? x + 1 : x > 1 ? x - 1 : x);\n/**\n * Similar to {@link wrapOnce} for [-1..1] interval.\n *\n * @param x -\n */\nexport const wrap11 = (x) => (x < -1 ? x + 2 : x > 1 ? x - 2 : x);\nexport const min2id = (a, b) => (a <= b ? 0 : 1);\nexport const min3id = (a, b, c) => a <= b ? (a <= c ? 0 : 2) : b <= c ? 1 : 2;\nexport const min4id = (a, b, c, d) => a <= b\n    ? a <= c\n        ? a <= d\n            ? 0\n            : 3\n        : c <= d\n            ? 2\n            : 3\n    : b <= c\n        ? b <= d\n            ? 1\n            : 3\n        : c <= d\n            ? 2\n            : 3;\nexport const max2id = (a, b) => (a >= b ? 0 : 1);\nexport const max3id = (a, b, c) => a >= b ? (a >= c ? 0 : 2) : b >= c ? 1 : 2;\nexport const max4id = (a, b, c, d) => a >= b\n    ? a >= c\n        ? a >= d\n            ? 0\n            : 3\n        : c >= d\n            ? 2\n            : 3\n    : b >= c\n        ? b >= d\n            ? 1\n            : 3\n        : c >= d\n            ? 2\n            : 3;\n/**\n * Returns the non-zero minimum value of the given `a`, `b` args.\n *\n * @param a -\n * @param b -\n */\nexport const minNonZero2 = (a, b) => a !== 0 ? (b !== 0 ? Math.min(a, b) : a) : b;\n/**\n * Returns the non-zero minimum value of the given `a`, `b`, `c` args.\n *\n * @param a -\n * @param b -\n * @param c -\n */\nexport const minNonZero3 = (a, b, c) => minNonZero2(minNonZero2(a, b), c);\n/**\n * See `smax()`.\n *\n * @param a -\n * @param b -\n * @param k - smooth exponent (MUST be > 0)\n */\nexport const smin = (a, b, k) => smax(a, b, -k);\n/**\n * Smooth maximum. Note: Result values will be slightly larger than max value\n * near max(a,b) + eps due to exponential decay. Higher `k` values reduce the\n * error, but also reduce the smoothing. Recommended k=16.\n *\n * https://en.wikipedia.org/wiki/Smooth_maximum\n *\n * @param a -\n * @param b -\n * @param k - smooth exponent (MUST be > 0)\n */\nexport const smax = (a, b, k) => {\n    const ea = Math.exp(a * k);\n    const eb = Math.exp(b * k);\n    return (a * ea + b * eb) / (ea + eb);\n};\n/**\n * Same as `smin(smax(x, min, k), max, k)`.\n *\n * @param x -\n * @param min -\n * @param max -\n * @param k -\n */\nexport const sclamp = (x, min, max, k) => smin(smax(x, min, k), max, k);\nexport const absMin = (a, b) => (Math.abs(a) < Math.abs(b) ? a : b);\nexport const absMax = (a, b) => (Math.abs(a) > Math.abs(b) ? a : b);\n/**\n * If `abs(x) > abs(e)`, recursively mirrors `x` back into `[-e .. +e]`\n * interval at respective positive/negative boundary.\n *\n * @remarks\n * References:\n * - https://www.desmos.com/calculator/lkyf2ag3ta\n * - https://www.musicdsp.org/en/latest/Effects/203-fold-back-distortion.html\n *\n * @param e - threshold (> 0)\n * @param x - input value\n */\nexport const foldback = (e, x) => x < -e || x > e ? Math.abs(Math.abs((x - e) % (4 * e)) - 2 * e) - e : x;\n/**\n * Returns true iff `x` is in closed interval `[min .. max]`\n *\n * @param x -\n * @param min -\n * @param max -\n */\nexport const inRange = (x, min, max) => x >= min && x <= max;\n/**\n * Returns true iff `x` is in open interval `(min .. max)`\n *\n * @param x -\n * @param min -\n * @param max -\n */\nexport const inOpenRange = (x, min, max) => x > min && x < max;\n","import { clamp01, clamp11 } from \"./interval.js\";\n/**\n * Returns normalized value of `x` WRT to interval `a .. b`. If `a`\n * equals `b`, returns 0.\n *\n * @param x -\n * @param a -\n * @param b -\n */\nexport const norm = (x, a, b) => (b !== a ? (x - a) / (b - a) : 0);\n/**\n * Returns a number in the `[c,d]` interval which is relative to `x` in the\n * `[a,b]` interval. **No** clamping will be performed if `x` lies outside the\n * original range (for that use {@link fitClamped} instead).\n *\n * @param x\n * @param a\n * @param b\n * @param c\n * @param d\n */\nexport const fit = (x, a, b, c, d) => c + (d - c) * norm(x, a, b);\n/**\n * Clamped version of {@link fit}, i.e. before mapping `x` into the target\n * interval `[c,d]`, it will be clamped to the source interval `[a,b]`.\n *\n * @param x\n * @param a\n * @param b\n * @param c\n * @param d\n */\nexport const fitClamped = (x, a, b, c, d) => c + (d - c) * clamp01(norm(x, a, b));\n/**\n * Similar to {@link fitClamped}, assuming [0,1] as source interval.\n *\n * @param x\n * @param a\n * @param b\n */\nexport const fit01 = (x, a, b) => a + (b - a) * clamp01(x);\n/**\n * Similar to {@link fitClamped}, assuming the reverse ordered [1,0] as source\n * interval.\n *\n * @param x\n * @param a\n * @param b\n */\nexport const fit10 = (x, a, b) => b + (a - b) * clamp01(x);\n/**\n * Similar to {@link fitClamped}, assuming [-1,1] as source interval.\n *\n * @param x\n * @param a\n * @param b\n */\nexport const fit11 = (x, a, b) => a + (b - a) * (0.5 + 0.5 * clamp11(x));\n","export const defError = (prefix, suffix = (msg) => (msg !== undefined ? \": \" + msg : \"\")) => class extends Error {\n    constructor(msg) {\n        super(prefix(msg) + suffix(msg));\n    }\n};\n","import { defError } from \"./deferror.js\";\nexport const UnsupportedOperationError = defError(() => \"unsupported operation\");\nexport const unsupported = (msg) => {\n    throw new UnsupportedOperationError(msg);\n};\n","import { unsupported } from \"@thi.ng/errors/unsupported\";\n/**\n * Specialized / optimized version of\n * [`thi.ng/defmulti`](https://thi.ng/defmulti) for vector operations. Uses\n * simplified logic to dispatch on length (vector size) of `dispatch` argument.\n *\n * @param dispatch - arg index\n */\nexport const vop = (dispatch = 0) => {\n    const impls = new Array(5);\n    let fallback;\n    const fn = (...args) => {\n        const g = impls[args[dispatch].length] || fallback;\n        return g\n            ? g(...args)\n            : unsupported(`no impl for vec size ${args[dispatch].length}`);\n    };\n    fn.add = (dim, fn) => (impls[dim] = fn);\n    fn.default = (fn) => (fallback = fn);\n    fn.impl = (dim) => impls[dim] || fallback;\n    // fn.impls = impls;\n    return fn;\n};\n","export const IDENT22 = Object.freeze([1, 0, 0, 1]);\nexport const IDENT23 = Object.freeze([1, 0, 0, 1, 0, 0]);\n//prettier-ignore\nexport const IDENT33 = Object.freeze([\n    1, 0, 0,\n    0, 1, 0,\n    0, 0, 1\n]);\n//prettier-ignore\nexport const IDENT44 = Object.freeze([\n    1, 0, 0, 0,\n    0, 1, 0, 0,\n    0, 0, 1, 0,\n    0, 0, 0, 1\n]);\n","import { defError } from \"./deferror.js\";\nexport const IllegalArityError = defError(() => \"illegal arity\");\nexport const illegalArity = (n) => {\n    throw new IllegalArityError(n);\n};\n","import { illegalArity } from \"@thi.ng/errors/illegal-arity\";\nexport function comp(...fns) {\n    let [a, b, c, d, e, f, g, h, i, j] = fns;\n    switch (fns.length) {\n        case 0:\n            illegalArity(0);\n        case 1:\n            return a;\n        case 2:\n            return (...xs) => a(b(...xs));\n        case 3:\n            return (...xs) => a(b(c(...xs)));\n        case 4:\n            return (...xs) => a(b(c(d(...xs))));\n        case 5:\n            return (...xs) => a(b(c(d(e(...xs)))));\n        case 6:\n            return (...xs) => a(b(c(d(e(f(...xs))))));\n        case 7:\n            return (...xs) => a(b(c(d(e(f(g(...xs)))))));\n        case 8:\n            return (...xs) => a(b(c(d(e(f(g(h(...xs))))))));\n        case 9:\n            return (...xs) => a(b(c(d(e(f(g(h(i(...xs)))))))));\n        case 10:\n        default:\n            const fn = (...xs) => a(b(c(d(e(f(g(h(i(j(...xs))))))))));\n            return fns.length === 10 ? fn : comp(fn, ...fns.slice(10));\n    }\n}\nexport function compL(...fns) {\n    return comp.apply(null, fns.reverse());\n}\n/**\n * @deprecated renamed to {@link compL}\n */\nexport const compI = compL;\n","export const implementsFunction = (x, fn) => x != null && typeof x[fn] === \"function\";\n","import { implementsFunction } from \"@thi.ng/checks/implements-function\";\nexport const ensureTransducer = (x) => implementsFunction(x, \"xform\") ? x.xform() : x;\n","import { comp as _comp } from \"@thi.ng/compose/comp\";\nimport { ensureTransducer } from \"./ensure.js\";\nexport function comp(...fns) {\n    fns = fns.map(ensureTransducer);\n    return _comp.apply(null, fns);\n}\n","export const isIterable = (x) => x != null && typeof x[Symbol.iterator] === \"function\";\n","/**\n * Reducer composition helper, internally used by various transducers\n * during initialization. Takes existing reducer `rfn` (a 3-tuple) and a\n * reducing function `fn`. Returns a new reducer tuple.\n *\n * @remarks\n * `rfn[2]` reduces values of type `B` into an accumulator of type `A`.\n * `fn` accepts values of type `C` and produces interim results of type\n * `B`, which are then (possibly) passed to the \"inner\" `rfn[2]`\n * function. Therefore the resulting reducer takes inputs of `C` and an\n * accumulator of type `A`.\n *\n * It is assumed that `fn` internally calls `rfn[2]` to pass its own\n * results for further processing by the nested reducer `rfn`.\n *\n * @example\n * ```ts\n * compR(rfn, fn)\n * // [rfn[0], rfn[1], fn]\n * ```\n *\n * @param rfn -\n * @param fn -\n */\nexport const compR = (rfn, fn) => [rfn[0], rfn[1], fn];\n","export const DEFAULT_EPS = 1e-6;\n/**\n * Internal use only. **Do NOT use in user land code!**\n *\n * @internal\n */\nexport const SEMAPHORE = Symbol();\n/**\n * No-effect placeholder function.\n */\nexport const NO_OP = () => { };\n/**\n * Catch-all event ID\n */\nexport const EVENT_ALL = \"*\";\nexport const EVENT_ENABLE = \"enable\";\nexport const EVENT_DISABLE = \"disable\";\n","export class Reduced {\n    constructor(val) {\n        this.value = val;\n    }\n    deref() {\n        return this.value;\n    }\n}\nexport const reduced = (x) => new Reduced(x);\nexport const isReduced = (x) => x instanceof Reduced;\nexport const ensureReduced = (x) => x instanceof Reduced ? x : new Reduced(x);\nexport const unreduced = (x) => (x instanceof Reduced ? x.deref() : x);\n","import { implementsFunction } from \"@thi.ng/checks/implements-function\";\nimport { isArrayLike } from \"@thi.ng/checks/is-arraylike\";\nimport { isIterable } from \"@thi.ng/checks/is-iterable\";\nimport { illegalArity } from \"@thi.ng/errors/illegal-arity\";\nimport { isReduced, unreduced } from \"./reduced.js\";\nconst parseArgs = (args) => args.length === 2\n    ? [undefined, args[1]]\n    : args.length === 3\n        ? [args[1], args[2]]\n        : illegalArity(args.length);\nexport function reduce(...args) {\n    const rfn = args[0];\n    const init = rfn[0];\n    const complete = rfn[1];\n    const reduce = rfn[2];\n    args = parseArgs(args);\n    const acc = args[0] == null ? init() : args[0];\n    const xs = args[1];\n    return unreduced(complete(implementsFunction(xs, \"$reduce\")\n        ? xs.$reduce(reduce, acc)\n        : isArrayLike(xs)\n            ? reduceArray(reduce, acc, xs)\n            : reduceIterable(reduce, acc, xs)));\n}\nexport function reduceRight(...args) {\n    const rfn = args[0];\n    const init = rfn[0];\n    const complete = rfn[1];\n    const reduce = rfn[2];\n    args = parseArgs(args);\n    let acc = args[0] == null ? init() : args[0];\n    const xs = args[1];\n    for (let i = xs.length; i-- > 0;) {\n        acc = reduce(acc, xs[i]);\n        if (isReduced(acc)) {\n            acc = acc.deref();\n            break;\n        }\n    }\n    return unreduced(complete(acc));\n}\nconst reduceArray = (rfn, acc, xs) => {\n    for (let i = 0, n = xs.length; i < n; i++) {\n        acc = rfn(acc, xs[i]);\n        if (isReduced(acc)) {\n            acc = acc.deref();\n            break;\n        }\n    }\n    return acc;\n};\nconst reduceIterable = (rfn, acc, xs) => {\n    for (let x of xs) {\n        acc = rfn(acc, x);\n        if (isReduced(acc)) {\n            acc = acc.deref();\n            break;\n        }\n    }\n    return acc;\n};\n/**\n * Convenience helper for building a full {@link Reducer} using the identity\n * function (i.e. `(x) => x`) as completion step (true for 90% of all\n * bundled transducers).\n *\n * @param init - init step of reducer\n * @param rfn - reduction step of reducer\n */\nexport const reducer = (init, rfn) => [init, (acc) => acc, rfn];\nexport const $$reduce = (rfn, args) => {\n    const n = args.length - 1;\n    return isIterable(args[n])\n        ? args.length > 1\n            ? reduce(rfn.apply(null, args.slice(0, n)), args[n])\n            : reduce(rfn(), args[0])\n        : undefined;\n};\n","export const isArrayLike = (x) => x != null && typeof x !== \"function\" && x.length !== undefined;\n","import { reducer } from \"./reduce.js\";\nexport function push(xs) {\n    return xs\n        ? [...xs]\n        : reducer(() => [], (acc, x) => (acc.push(x), acc));\n}\n","import { NO_OP, SEMAPHORE } from \"@thi.ng/api/api\";\nimport { isIterable } from \"@thi.ng/checks/is-iterable\";\nimport { ensureTransducer } from \"./ensure.js\";\nimport { push } from \"./push.js\";\nimport { isReduced, unreduced } from \"./reduced.js\";\n/**\n * Takes a transducer and input iterable. Returns iterator of\n * transformed results.\n *\n * @param xform -\n * @param xs -\n */\nexport function* iterator(xform, xs) {\n    const rfn = ensureTransducer(xform)(push());\n    const complete = rfn[1];\n    const reduce = rfn[2];\n    for (let x of xs) {\n        const y = reduce([], x);\n        if (isReduced(y)) {\n            yield* unreduced(complete(y.deref()));\n            return;\n        }\n        if (y.length) {\n            yield* y;\n        }\n    }\n    yield* unreduced(complete([]));\n}\n/**\n * Optimized version of {@link iterator} for transducers which are\n * guaranteed to:\n *\n * 1) Only produce none or a single result per input\n * 2) Do not require a `completion` reduction step\n *\n * @param xform -\n * @param xs -\n */\nexport function* iterator1(xform, xs) {\n    const reduce = (ensureTransducer(xform)([NO_OP, NO_OP, (_, x) => x]))[2];\n    for (let x of xs) {\n        let y = reduce(SEMAPHORE, x);\n        if (isReduced(y)) {\n            y = unreduced(y.deref());\n            if (y !== SEMAPHORE) {\n                yield y;\n            }\n            return;\n        }\n        if (y !== SEMAPHORE) {\n            yield y;\n        }\n    }\n}\n/**\n * Helper function used by various transducers to wrap themselves as\n * transforming iterators. Delegates to {@link iterator1} by default.\n *\n * @param xform -\n * @param args -\n * @param impl -\n *\n * @internal\n */\nexport const __iter = (xform, args, impl = iterator1) => {\n    const n = args.length - 1;\n    return isIterable(args[n])\n        ? args.length > 1\n            ? impl(xform.apply(null, args.slice(0, n)), args[n])\n            : impl(xform(), args[0])\n        : undefined;\n};\n","import { isIterable } from \"@thi.ng/checks/is-iterable\";\nimport { compR } from \"./compr.js\";\nimport { iterator1 } from \"./iterator.js\";\nexport function map(fn, src) {\n    return isIterable(src)\n        ? iterator1(map(fn), src)\n        : (rfn) => {\n            const r = rfn[2];\n            return compR(rfn, (acc, x) => r(acc, fn(x)));\n        };\n}\n/**\n * Convenience wrapper for {@link map} to transform an iterable with given `fn`\n * and immediatedly collect results into an array.\n */\nexport const mapA = (fn, src) => [\n    ...map(fn, src),\n];\n","import { compR } from \"./compr.js\";\nimport { __iter } from \"./iterator.js\";\nexport function mapIndexed(...args) {\n    return (__iter(mapIndexed, args) ||\n        ((rfn) => {\n            const r = rfn[2];\n            const fn = args[0];\n            let i = args[1] || 0;\n            return compR(rfn, (acc, x) => r(acc, fn(i++, x)));\n        }));\n}\n","import { isReduced } from \"./reduced.js\";\nexport function range(from, to, step) {\n    return new Range(from, to, step);\n}\n/**\n * Simple class wrapper around given range interval and implementing `Iterable`\n * and {@link IReducible} interfaces, the latter is used to accelerate use with\n * {@link reduce}.\n */\nexport class Range {\n    constructor(from, to, step) {\n        if (from === undefined) {\n            from = 0;\n            to = Infinity;\n        }\n        else if (to === undefined) {\n            to = from;\n            from = 0;\n        }\n        step = step === undefined ? (from < to ? 1 : -1) : step;\n        this.from = from;\n        this.to = to;\n        this.step = step;\n    }\n    *[Symbol.iterator]() {\n        let { from, to, step } = this;\n        if (step > 0) {\n            while (from < to) {\n                yield from;\n                from += step;\n            }\n        }\n        else if (step < 0) {\n            while (from > to) {\n                yield from;\n                from += step;\n            }\n        }\n    }\n    $reduce(rfn, acc) {\n        const step = this.step;\n        if (step > 0) {\n            for (let i = this.from, n = this.to; i < n && !isReduced(acc); i += step) {\n                acc = rfn(acc, i);\n            }\n        }\n        else {\n            for (let i = this.from, n = this.to; i > n && !isReduced(acc); i += step) {\n                acc = rfn(acc, i);\n            }\n        }\n        return acc;\n    }\n}\n","import { reducer } from \"./reduce.js\";\nexport function str(sep, xs) {\n    sep = sep || \"\";\n    let first = true;\n    return xs\n        ? [...xs].join(sep)\n        : reducer(() => \"\", (acc, x) => ((acc = first ? acc + x : acc + sep + x),\n            (first = false),\n            acc));\n}\n","import { isIterable } from \"@thi.ng/checks/is-iterable\";\nimport { compR } from \"./compr.js\";\nimport { iterator } from \"./iterator.js\";\nimport { ensureReduced, reduced } from \"./reduced.js\";\nexport function take(n, src) {\n    return isIterable(src)\n        ? iterator(take(n), src)\n        : (rfn) => {\n            const r = rfn[2];\n            let m = n;\n            return compR(rfn, (acc, x) => --m > 0\n                ? r(acc, x)\n                : m === 0\n                    ? ensureReduced(r(acc, x))\n                    : reduced(acc));\n        };\n}\n","import { illegalArity } from \"@thi.ng/errors/illegal-arity\";\nimport { ensureTransducer } from \"./ensure.js\";\nimport { map } from \"./map.js\";\nimport { reduce, reduceRight } from \"./reduce.js\";\nexport function transduce(...args) {\n    return $transduce(transduce, reduce, args);\n}\nexport function transduceRight(...args) {\n    return $transduce(transduceRight, reduceRight, args);\n}\nconst $transduce = (tfn, rfn, args) => {\n    let acc, xs;\n    switch (args.length) {\n        case 4:\n            xs = args[3];\n            acc = args[2];\n            break;\n        case 3:\n            xs = args[2];\n            break;\n        case 2:\n            return map((x) => tfn(args[0], args[1], x));\n        default:\n            illegalArity(args.length);\n    }\n    return rfn(ensureTransducer(args[0])(args[1]), acc, xs);\n};\n","export function* zip(...src) {\n    const iters = src.map((s) => s[Symbol.iterator]());\n    while (true) {\n        const tuple = [];\n        for (let i of iters) {\n            let v = i.next();\n            if (v.done) {\n                return;\n            }\n            tuple.push(v.value);\n        }\n        yield tuple;\n    }\n}\n","/** @internal */\nexport const ARGS_V = \"o,a\";\n/** @internal */\nexport const ARGS_VV = \"o,a,b\";\n/** @internal */\nexport const ARGS_VVV = \"o,a,b,c\";\n/** @internal */\nexport const ARGS_VN = \"o,a,n\";\n/** @internal */\nexport const ARGS_VNV = \"o,a,n,b\";\n/** @internal */\nexport const ARGS_VVN = \"o,a,b,n\";\n/** @internal */\nexport const SARGS_V = \"io=0,ia=0,so=1,sa=1\";\n/** @internal */\nexport const SARGS_VV = \"io=0,ia=0,ib=0,so=1,sa=1,sb=1\";\n/** @internal */\nexport const SARGS_VVV = \"io=0,ia=0,ib=0,ic=0,so=1,sa=1,sb=1,sc=1\";\n/** @internal */\nexport const DEFAULT_OUT = \"!o&&(o=a);\";\n/** @internal */\nexport const NEW_OUT = \"!o&&(o=[]);\";\n/** @internal */\nexport const NEW_OUT_A = \"!a&&(a=[]);\";\n/** @internal */\n// prettier-ignore\nexport const MATH = (op) => ([o, a, b]) => `${o}=${a}${op}${b};`;\n/** @internal */\n// prettier-ignore\nexport const MATH_N = (op) => ([o, a]) => `${o}=${a}${op}n;`;\n/** @internal */\n// prettier-ignore\nexport const MATH2 = (op1, op2) => ([o, a, b, c]) => `${o}=(${a}${op1}${b})${op2}${c};`;\n/** @internal */\n// prettier-ignore\nexport const MATH2_N = (op1, op2) => ([o, a, b]) => `${o}=(${a}${op1}${b})${op2}n;`;\n/** @internal */\n// prettier-ignore\nexport const MATH2A_N = (op1, op2) => ([o, a, b]) => `${o}=(${a}${op1}n)${op2}${b};`;\n/** @internal */\n// prettier-ignore\nexport const SIGNED = (op) => ([o, a, b]) => `${o}=(${a}${op}${b})|0;`;\n/** @internal */\n// prettier-ignore\nexport const UNSIGNED = (op) => ([o, a, b]) => `${o}=(${a}${op}${b})>>>0;`;\n/** @internal */\n// prettier-ignore\nexport const SIGNED_N = (op) => ([o, a]) => `${o}=(${a}${op}n)|0;`;\n/** @internal */\n// prettier-ignore\nexport const UNSIGNED_N = (op) => ([o, a]) => `${o}=(${a}${op}n)>>>0;`;\n/** @internal */\n// prettier-ignore\nexport const FN = (op = \"op\") => ([o, a]) => `${o}=${op}(${a});`;\n/** @internal */\n// prettier-ignore\nexport const FN2 = (op = \"op\") => ([o, a, b]) => `${o}=${op}(${a},${b});`;\n/** @internal */\n// prettier-ignore\nexport const FN3 = (op = \"op\") => ([o, a, b, c]) => `${o}=${op}(${a},${b},${c});`;\n/** @internal */\n// prettier-ignore\nexport const FN5 = (op = \"op\") => ([o, a, b, c, d, e]) => `${o}=${op}(${a},${b},${c},${d},${e});`;\n/** @internal */\n// prettier-ignore\nexport const FN_N = (op = \"op\") => ([o, a]) => `${o}=${op}(${a},n);`;\n/** @internal */\nexport const DOT = ([a, b]) => `${a}*${b}`;\n/** @internal */\nexport const DOT_G = ([a, b]) => `s+=${a}*${b};`;\n/** @internal */\nexport const SET = ([o, a]) => `${o}=${a};`;\n/** @internal */\nexport const SET_N = ([a]) => `${a}=n;`;\n/** @internal */\nexport const MIX = ([o, a, b, c]) => `${o}=${a}+(${b}-${a})*${c};`;\n/** @internal */\nexport const MIX_N = ([o, a, b]) => `${o}=${a}+(${b}-${a})*n;`;\n","import { comp } from \"@thi.ng/transducers/comp\";\nimport { map } from \"@thi.ng/transducers/map\";\nimport { mapIndexed } from \"@thi.ng/transducers/map-indexed\";\nimport { range } from \"@thi.ng/transducers/range\";\nimport { str } from \"@thi.ng/transducers/str\";\nimport { take } from \"@thi.ng/transducers/take\";\nimport { transduce } from \"@thi.ng/transducers/transduce\";\nimport { zip } from \"@thi.ng/transducers/zip\";\nimport { vop } from \"../vop.js\";\nimport { ARGS_V, ARGS_VN, ARGS_VV, DEFAULT_OUT, FN, MATH, MATH_N, SARGS_VV, SIGNED, SIGNED_N, UNSIGNED, UNSIGNED_N, } from \"./templates.js\";\n/**\n * HOF array index lookup gen to provide optimized versions of:\n *\n * @example\n * ```ts\n * lookup(\"a\")(0) // a[ia]\n * lookup(\"a\")(1) // a[ia * sa]\n * lookup(\"a\")(2) // a[ia + 2 * sa]\n * ```\n *\n * @param sym -\n */\nconst lookup = (sym) => (i) => i > 1\n    ? `${sym}[i${sym}+${i}*s${sym}]`\n    : i == 1\n        ? `${sym}[i${sym}+s${sym}]`\n        : `${sym}[i${sym}]`;\n/**\n * Infinite iterator of strided index lookups for `sym`.\n *\n * @param sym -\n */\nconst indicesStrided = (sym) => map(lookup(sym), range());\n/**\n * Infinite iterator of simple (non-strided) index lookups for `sym`.\n *\n * @param sym -\n */\nconst indices = (sym) => map((i) => `${sym}[${i}]`, range());\n/**\n * Code generator for loop-unrolled vector operations. Takes a vector\n * size `dim`, a code template function `tpl` and an array of symbol\n * names participating in the template. For each symbol, creates\n * iterator of index lookups (e.g. `a[0]` or `a[ia+k*sa]`), forms them\n * into tuples and passes them to template to generate code and joins\n * generated result with `opJoin` separator (default:\n * `\"\"`).\n *\n * If the optional `ret` arg is not `null` (default `\"a\"`), appends a\n * `return` statement to the result array, using `ret` as return value.\n * Returns array of source code lines.\n *\n * The optional `pre` and `post` strings can be used to wrap the\n * generated code. `post` will be injected **before** the generated\n * return statement (if not suppressed).\n *\n * @param dim -\n * @param tpl -\n * @param syms -\n * @param ret -\n * @param opJoin -\n * @param pre -\n * @param post -\n * @param strided -\n */\nconst assemble = (dim, tpl, syms, ret = \"a\", opJoin = \"\", pre = \"\", post = \"\", strided = false) => [\n    pre,\n    transduce(comp(take(dim), mapIndexed((i, x) => tpl(x, i))), str(opJoin), (zip.apply(null, syms.split(\",\").map(strided ? indicesStrided : indices)))),\n    post,\n    ret !== \"\" ? `return ${ret};` : \"\",\n];\nconst assembleG = (tpl, syms, ret = \"a\", pre, post, strided = false) => [\n    pre,\n    \"for(let i=a.length;--i>=0;) {\",\n    tpl(syms\n        .split(\",\")\n        .map(strided ? (x) => `${x}[i${x}+i*s${x}]` : (x) => `${x}[i]`)),\n    \"}\",\n    post,\n    ret !== null ? `return ${ret};` : \"\",\n];\nconst assembleS = (tpl, syms = ARGS_VV, ret = \"o\", pre = DEFAULT_OUT, post) => [\n    pre,\n    \"while(k-->0) {\",\n    tpl(syms.split(\",\").map((x) => `${x}[i${x}+k*s${x}]`)),\n    \"}\",\n    post,\n    ret !== null ? `return ${ret};` : \"\",\n];\n/** @internal */\nexport const defaultOut = (o, args) => `!${o} && (${o}=${args.split(\",\")[1]});`;\n/** @internal */\nexport const compile = (dim, tpl, args, syms = args, ret = \"a\", opJoin, pre, post, strided = false) => (new Function(args, assemble(dim, tpl, syms, ret, opJoin, pre, post, strided).join(\"\")));\n/** @internal */\nexport const compileHOF = (dim, fns, tpl, hofArgs, args, syms = args, ret = \"a\", opJoin = \"\", pre, post, strided = false) => {\n    return new Function(hofArgs, `return (${args})=>{${assemble(dim, tpl, syms, ret, opJoin, pre, post, strided).join(\"\")}}`)(...fns);\n};\n/** @internal */\nexport const compileG = (tpl, args, syms = args, ret = \"a\", pre, post, strided = false) => (new Function(args, assembleG(tpl, syms, ret, pre, post, strided).join(\"\")));\n/** @internal */\nexport const compileS = (tpl, args, syms = args, ret, pre, post) => new Function(args, assembleS(tpl, syms, ret, pre, post).join(\"\"));\n/** @internal */\nexport const compileGHOF = (fns, tpl, hofArgs, args, syms = args, ret = \"a\", pre, post, strided = false) => (new Function(hofArgs, `return (${args})=>{${assembleG(tpl, syms, ret, pre, post, strided).join(\"\")}}`)(...fns));\nexport const defOp = (tpl, args = ARGS_VV, syms, ret = \"o\", dispatch = 1, pre) => {\n    syms = syms || args;\n    pre = pre != null ? pre : defaultOut(ret, args);\n    const fn = vop(dispatch);\n    const $ = (dim) => fn.add(dim, compile(dim, tpl, args, syms, ret, \"\", pre));\n    fn.default(compileG(tpl, args, syms, ret, pre));\n    return [fn, $(2), $(3), $(4)];\n};\nexport const defFnOp = (op) => defOp(FN(op), ARGS_V);\nexport const defHofOp = (op, tpl, args = ARGS_V, syms, ret = \"o\", dispatch = 1, pre) => {\n    const _tpl = tpl || FN(\"op\");\n    syms = syms || args;\n    pre = pre != null ? pre : defaultOut(ret, args);\n    const fn = vop(dispatch);\n    const $ = (dim) => fn.add(dim, compileHOF(dim, [op], _tpl, \"op\", args, syms, ret, \"\", pre));\n    fn.default(compileGHOF([op], _tpl, \"op\", args, syms, ret, pre));\n    return [fn, $(2), $(3), $(4)];\n};\nexport const defOpS = (tpl, args = ARGS_VV, idxArgs = SARGS_VV, syms = ARGS_VV, ret = \"o\", pre, sizes = [2, 3, 4]) => [\n    compileS(tpl, `${args},k,${idxArgs}`, syms, ret, pre),\n    ...sizes.map((dim) => compile(dim, tpl, `${args},${idxArgs}`, syms, ret, \"\", pre != null ? pre : defaultOut(ret, args), \"\", true)),\n];\nexport const defHofOpS = (op, tpl, args = ARGS_VV, idxArgs = SARGS_VV, syms = ARGS_VV, ret = \"o\", pre, sizes = [2, 3, 4]) => [\n    new Function(\"op\", `return (${args},k,${idxArgs})=>{${assembleS(tpl, syms, ret, pre).join(\"\")}}`)(op),\n    ...sizes.map((dim) => compileHOF(dim, [op], tpl, \"op\", `${args},${idxArgs}`, syms, ret, \"\", pre != null ? pre : defaultOut(ret, args), \"\", true)),\n];\nexport const defMathOp = (op) => defOp(MATH(op));\nexport const defMathOpN = (op) => defOp(MATH_N(op), ARGS_VN);\nexport const defBitOp = (op, signed = false) => defOp((signed ? SIGNED : UNSIGNED)(op));\nexport const defBitOpN = (op, signed = false) => defOp((signed ? SIGNED_N : UNSIGNED_N)(op), ARGS_VN);\n","import { defOp } from \"./compile/emit.js\";\nimport { NEW_OUT, SET } from \"./compile/templates.js\";\nexport const [set, set2, set3, set4] = defOp(SET, \"o,a\", undefined, \"o\", 1, NEW_OUT);\n","import { compile } from \"@thi.ng/vectors/compile/emit\";\nimport { SET } from \"@thi.ng/vectors/compile/templates\";\nimport { set as _set, set4 } from \"@thi.ng/vectors/set\";\nconst $ = (dim) => _set.add(dim, compile(dim, SET, \"o,a\", undefined, \"o\"));\nexport const set = _set;\nexport const set22 = set4;\nexport const set23 = $(6);\nexport const set33 = $(9);\nexport const set44 = $(16);\n","import { vop } from \"@thi.ng/vectors/vop\";\nimport { IDENT22, IDENT23, IDENT33, IDENT44 } from \"./constants.js\";\nimport { set } from \"./set.js\";\n/**\n * Writes identity matrix into given matrix.\n */\nexport const identity = vop();\nexport const identity22 = identity.add(4, (m) => set(m, IDENT22));\nexport const identity23 = identity.add(6, (m) => set(m, IDENT23));\nexport const identity33 = identity.add(9, (m) => set(m, IDENT33));\nexport const identity44 = identity.add(16, (m) => set(m, IDENT44));\n","export const PI = Math.PI;\nexport const TAU = PI * 2;\nexport const HALF_PI = PI / 2;\nexport const THIRD_PI = PI / 3;\nexport const QUARTER_PI = PI / 4;\nexport const SIXTH_PI = PI / 6;\nexport const INV_PI = 1 / PI;\nexport const INV_TAU = 1 / TAU;\nexport const INV_HALF_PI = 1 / HALF_PI;\nexport const DEG2RAD = PI / 180;\nexport const RAD2DEG = 180 / PI;\nexport const PHI = (1 + Math.sqrt(5)) / 2;\nexport const SQRT2 = Math.SQRT2;\nexport const SQRT3 = Math.sqrt(3);\nexport const SQRT2_2 = SQRT2 / 2;\nexport const SQRT3_2 = SQRT3 / 2;\nexport const THIRD = 1 / 3;\nexport const TWO_THIRD = 2 / 3;\nexport const SIXTH = 1 / 6;\nexport let EPS = 1e-6;\n","import { DEG2RAD, HALF_PI, INV_HALF_PI, PI, RAD2DEG, TAU } from \"./api.js\";\n/**\n * Returns vector of `[sin(theta)*n, cos(theta)*n]`.\n *\n * @param theta -\n * @param n -\n */\nexport const sincos = (theta, n = 1) => [\n    Math.sin(theta) * n,\n    Math.cos(theta) * n,\n];\n/**\n * Returns vector of `[cos(theta)*n, sin(theta)*n]`.\n *\n * @param theta -\n * @param n -\n */\nexport const cossin = (theta, n = 1) => [\n    Math.cos(theta) * n,\n    Math.sin(theta) * n,\n];\n/**\n * Projects `theta` into [0 .. 2π] interval.\n *\n * @param theta -\n */\nexport const absTheta = (theta) => ((theta %= TAU), theta < 0 ? TAU + theta : theta);\nexport const absInnerAngle = (theta) => ((theta = Math.abs(theta)), theta > PI ? TAU - theta : theta);\n/**\n * Returns smallest absolute angle difference between `a` and `b`.\n * Result will be in [0 .. π] interval.\n *\n * @param a -\n * @param b -\n */\nexport const angleDist = (a, b) => absInnerAngle(absTheta((b % TAU) - (a % TAU)));\n/**\n * Like `Math.atan2`, but always returns angle in [0 .. TAU) interval.\n *\n * @param y -\n * @param x -\n */\nexport const atan2Abs = (y, x) => absTheta(Math.atan2(y, x));\n/**\n * Returns quadrant ID (0-3) of given angle (in radians).\n *\n * @param theta -\n */\nexport const quadrant = (theta) => (absTheta(theta) * INV_HALF_PI) | 0;\n/**\n * Converts angle to degrees.\n *\n * @param theta - angle in radians\n */\nexport const deg = (theta) => theta * RAD2DEG;\n/**\n * Converts angle to radians.\n *\n * @param theta - angle in degrees\n */\nexport const rad = (theta) => theta * DEG2RAD;\n/**\n * Cosecant. Approaches `±Infinity` for `theta` near multiples of π.\n *\n * @param theta - angle in radians\n */\nexport const csc = (theta) => 1 / Math.sin(theta);\n/**\n * Secant. Approaches `±Infinity` for `theta` near π/2 ± nπ\n *\n * @param theta - angle in radians\n */\nexport const sec = (theta) => 1 / Math.cos(theta);\n/**\n * Cotangent. Approaches `±Infinity` for `theta` near multiples of π.\n *\n * @param theta - angle in radians\n */\nexport const cot = (theta) => 1 / Math.tan(theta);\n/**\n * Law of Cosines. Takes length of two sides of a triangle and the inner\n * angle (in radians) between them. Returns length of third side.\n *\n * @param a -\n * @param b -\n * @param gamma -\n */\nexport const loc = (a, b, gamma) => Math.sqrt(a * a + b * b - 2 * a * b * Math.cos(gamma));\n/**\n * Approximates cos(xπ) for x in [-1,1]\n *\n * @param x -\n */\nexport const normCos = (x) => {\n    const x2 = x * x;\n    return 1.0 + x2 * (-4 + 2 * x2);\n};\nconst __fastCos = (x) => {\n    const x2 = x * x;\n    return 0.99940307 + x2 * (-0.49558072 + 0.03679168 * x2);\n};\n/**\n * Fast cosine approximation using {@link normCos} (polynomial). Max. error\n * ~0.00059693\n *\n * In [0 .. 2π] interval, approx. 18-20% faster than `Math.cos` on V8.\n *\n * @param theta - in radians\n */\nexport const fastCos = (theta) => {\n    theta %= TAU;\n    theta < 0 && (theta = -theta);\n    switch ((theta * INV_HALF_PI) | 0) {\n        case 0:\n            return __fastCos(theta);\n        case 1:\n            return -__fastCos(PI - theta);\n        case 2:\n            return -__fastCos(theta - PI);\n        default:\n            return __fastCos(TAU - theta);\n    }\n};\n/**\n * {@link fastCos}\n *\n * @param theta - in radians\n */\nexport const fastSin = (theta) => fastCos(HALF_PI - theta);\n","import { compile, compileG } from \"./compile/emit.js\";\nimport { vop } from \"./vop.js\";\nconst $ = (dim) => magSq.add(dim, compile(dim, ([a]) => `${a}*${a}`, \"a\", \"a\", \"\", \"+\", \"return \", \";\"));\nexport const magSq = vop();\nmagSq.default(compileG(([a]) => `sum+=${a}*${a};`, \"a\", undefined, \"sum\", \"let sum=0;\"));\nexport const magSq2 = $(2);\nexport const magSq3 = $(3);\nexport const magSq4 = $(4);\n","import { defMathOpN } from \"./compile/emit.js\";\nexport const [mulN, mulN2, mulN3, mulN4] = defMathOpN(\"*\");\n","import { EPS } from \"@thi.ng/math/api\";\nimport { mag } from \"./mag.js\";\nimport { magSq2, magSq3, magSq4 } from \"./magsq.js\";\nimport { mulN, mulN2, mulN3, mulN4 } from \"./muln.js\";\nimport { set, set2, set3, set4 } from \"./set.js\";\n/**\n * Normalizes vector to given (optional) length (default: 1). If `out`\n * is null, modifies `v` in place.\n *\n * @param out -\n * @param v -\n * @param n -\n */\nexport const normalize = (out, v, n = 1) => {\n    !out && (out = v);\n    const m = mag(v);\n    return m >= EPS ? mulN(out, v, n / m) : out !== v ? set(out, v) : out;\n};\n/**\n * Optimized 2d version of generic {@link normalize}.\n * @param out\n * @param v\n * @param n\n */\nexport const normalize2 = (out, v, n = 1) => {\n    !out && (out = v);\n    const m = Math.sqrt(magSq2(v));\n    return m >= EPS ? mulN2(out, v, n / m) : out !== v ? set2(out, v) : out;\n};\n/**\n * Optimized 3d version of generic {@link normalize}.\n * @param out\n * @param v\n * @param n\n */\nexport const normalize3 = (out, v, n = 1) => {\n    !out && (out = v);\n    const m = Math.sqrt(magSq3(v));\n    return m >= EPS ? mulN3(out, v, n / m) : out !== v ? set3(out, v) : out;\n};\n/**\n * Optimized 4d version of generic {@link normalize}.\n * @param out\n * @param v\n * @param n\n */\nexport const normalize4 = (out, v, n = 1) => {\n    !out && (out = v);\n    const m = Math.sqrt(magSq4(v));\n    return m >= EPS ? mulN4(out, v, n / m) : out !== v ? set4(out, v) : out;\n};\n","export const setC2 = (out, x, y) => (!out && (out = []), (out[0] = x), (out[1] = y), out);\nexport const setC3 = (out, x, y, z) => (!out && (out = []), (out[0] = x), (out[1] = y), (out[2] = z), out);\nexport const setC4 = (out, x, y, z, w) => (!out && (out = []),\n    (out[0] = x),\n    (out[1] = y),\n    (out[2] = z),\n    (out[3] = w),\n    out);\nexport const setC6 = (out, a, b, c, d, e, f) => (!out && (out = []),\n    (out[0] = a),\n    (out[1] = b),\n    (out[2] = c),\n    (out[3] = d),\n    (out[4] = e),\n    (out[5] = f),\n    out);\nexport const setC = (out, ...xs) => {\n    !out && (out = []);\n    for (let i = 0, n = xs.length; i < n; i++) {\n        out[i] = xs[i];\n    }\n    return out;\n};\n","import { setC } from \"@thi.ng/vectors/setc\";\n/**\n * Converts 3x3 to 4x4 matrix and writes result to `out`. Creates new\n * matrix if `out` is `null`.\n *\n * @param out -\n * @param m33 -\n */\nexport const mat33to44 = (out, m33) => setC(out || [], \n// x\nm33[0], m33[1], m33[2], 0, \n// y\nm33[3], m33[4], m33[5], 0, \n// z\nm33[6], m33[7], m33[8], 0, \n// w\n0, 0, 0, 1);\n","import { sincos } from \"@thi.ng/math/angle\";\nimport { normalize3 } from \"@thi.ng/vectors/normalize\";\nimport { setC } from \"@thi.ng/vectors/setc\";\nimport { mat33to44 } from \"./m33-m44.js\";\n/**\n * Constructs a 3x3 matrix representing a rotation of `theta` around\n * `axis` and writes result to `out`. If `normalize` is true (default\n * false), non-destructively first normalizes axis vector.\n *\n * @param out -\n * @param axis -\n * @param theta -\n * @param normalize -\n */\nexport const rotationAroundAxis33 = (out, axis, theta, normalize = false) => {\n    const [x, y, z] = normalize ? normalize3([], axis) : axis;\n    const [s, c] = sincos(theta);\n    const t = 1 - c;\n    const xs = x * s;\n    const ys = y * s;\n    const zs = z * s;\n    const xt = x * t;\n    const yt = y * t;\n    const zt = z * t;\n    return setC(out || [], x * xt + c, y * xt + zs, z * xt - ys, x * yt - zs, y * yt + c, z * yt + xs, x * zt + ys, y * zt - xs, z * zt + c);\n};\n/**\n * Constructs a 4x4 matrix representing a rotation of `theta` around\n * `axis` and writes result to `out`. If `normalize` is true (default\n * false), non-destructively first normalizes axis vector.\n *\n * @param out -\n * @param axis -\n * @param theta -\n * @param normalize -\n */\nexport const rotationAroundAxis44 = (out, axis, theta, normalize = false) => mat33to44(out, rotationAroundAxis33([], axis, theta, normalize));\n","import { DEG2RAD } from \"@thi.ng/math/api\";\nimport { setC } from \"@thi.ng/vectors/setc\";\n/**\n * Constructs a 4x4 matrix representing the given view frustum. Creates\n * new matrix if `out` is `null`.\n *\n * @param out -\n * @param left -\n * @param right -\n * @param bottom -\n * @param top -\n * @param near -\n * @param far -\n */\nexport const frustum = (out, left, right, bottom, top, near, far) => {\n    const dx = 1 / (right - left);\n    const dy = 1 / (top - bottom);\n    const dz = 1 / (far - near);\n    return setC(out || [], near * 2 * dx, 0, 0, 0, 0, near * 2 * dy, 0, 0, (right + left) * dx, (top + bottom) * dy, -(far + near) * dz, -1, 0, 0, -(far * near * 2) * dz, 0);\n};\nexport const frustumBounds = (fovy, aspect, near, far) => {\n    const top = near * Math.tan((fovy * DEG2RAD) / 2);\n    const right = top * aspect;\n    return {\n        left: -right,\n        right,\n        bottom: -top,\n        top,\n        near,\n        far,\n    };\n};\n","import { frustum, frustumBounds } from \"./frustum.js\";\n/**\n * Creates a 4x4 matrix perspective projection matrix and writes result\n * to `out`.\n *\n * @param out -\n * @param fov -\n * @param aspect -\n * @param near -\n * @param far -\n */\nexport const perspective = (out, fov, aspect, near, far) => {\n    const f = frustumBounds(fov, aspect, near, far);\n    return frustum(out, f.left, f.right, f.bottom, f.top, f.near, f.far);\n};\n","import { setC3 } from \"./setc.js\";\nexport const cross2 = (a, b) => a[0] * b[1] - a[1] * b[0];\nexport const cross3 = (out, a, b) => setC3(out || a, a[1] * b[2] - a[2] * b[1], a[2] * b[0] - a[0] * b[2], a[0] * b[1] - a[1] * b[0]);\n","import { compile, compileG } from \"./compile/emit.js\";\nimport { DOT, DOT_G } from \"./compile/templates.js\";\nimport { vop } from \"./vop.js\";\nconst $ = (dim) => dot.add(dim, compile(dim, DOT, \"a,b\", undefined, \"\", \"+\", \"return \", \";\"));\nexport const dot = vop();\ndot.default(compileG(DOT_G, \"a,b\", undefined, \"s\", \"let s=0;\"));\nexport const dot2 = $(2);\nexport const dot3 = $(3);\nexport const dot4 = $(4);\n","import { defMathOp } from \"./compile/emit.js\";\nexport const [sub, sub2, sub3, sub4] = defMathOp(\"-\");\n","import { cross3 } from \"@thi.ng/vectors/cross\";\nimport { dot3 } from \"@thi.ng/vectors/dot\";\nimport { normalize3 } from \"@thi.ng/vectors/normalize\";\nimport { setC } from \"@thi.ng/vectors/setc\";\nimport { sub3 } from \"@thi.ng/vectors/sub\";\n/**\n * Constructs a 4x4 camera matrix for given `eye` position, look-at\n * `target` (both in world space) and normalized `up` vector. Creates\n * new matrix if `out` is `null`.\n *\n * @param out -\n * @param eye -\n * @param target -\n * @param up -\n */\nexport const lookAt = (out, eye, target, up) => {\n    const z = normalize3(null, sub3([], eye, target));\n    const x = normalize3(null, cross3([], up, z));\n    const y = normalize3(null, cross3([], z, x));\n    return setC(out || [], x[0], y[0], z[0], 0, x[1], y[1], z[1], 0, x[2], y[2], z[2], 0, -dot3(eye, x), -dot3(eye, y), -dot3(eye, z), 1);\n};\n","import { compile } from \"./compile/emit.js\";\nimport { DOT, SARGS_V } from \"./compile/templates.js\";\nexport const dotS = (a, b, n, ia = 0, ib = 0, sa = 1, sb = 1) => {\n    let sum = 0;\n    for (; n-- > 0; ia += sa, ib += sb)\n        sum += a[ia] * b[ib];\n    return sum;\n};\nconst $ = (dim) => compile(dim, DOT, `o,a,${SARGS_V}`, \"o,a\", \"\", \"+\", \"return \", \";\", true);\nexport const dotS2 = $(2);\nexport const dotS3 = $(3);\nexport const dotS4 = $(4);\n","import { dotS2, dotS3, dotS4 } from \"@thi.ng/vectors/dots\";\nimport { setC, setC4, setC6 } from \"@thi.ng/vectors/setc\";\nimport { vop } from \"@thi.ng/vectors/vop\";\n/**\n * Multi-method. Performs matrix-matrix multiplication. If `out` is not\n * given, writes result in `a`.\n *\n * @param out -\n * @param a -\n * @param b -\n */\nexport const mulM = vop(1);\n/**\n * 2x2 matrix-matrix multiplication. If `out` is not given, writes\n * result in `a`.\n *\n * @param out -\n * @param a -\n * @param b -\n */\nexport const mulM22 = mulM.add(4, (out, a, b) => setC4(out || a, dotS2(a, b, 0, 0, 2), dotS2(a, b, 1, 0, 2), dotS2(a, b, 0, 2, 2), dotS2(a, b, 1, 2, 2)));\n/**\n * 2x3 matrix-matrix multiplication. If `out` is not given, writes\n * result in `a`.\n *\n * @param out -\n * @param a -\n * @param b -\n */\nexport const mulM23 = mulM.add(6, (out, a, b) => setC6(out || a, dotS2(a, b, 0, 0, 2), dotS2(a, b, 1, 0, 2), dotS2(a, b, 0, 2, 2), dotS2(a, b, 1, 2, 2), dotS2(a, b, 0, 4, 2) + a[4], dotS2(a, b, 1, 4, 2) + a[5]));\n/**\n * 3x3 matrix-matrix multiplication. If `out` is not given, writes\n * result in `a`.\n *\n * @param out -\n * @param a -\n * @param b -\n */\nexport const mulM33 = mulM.add(9, (out, a, b) => setC(out || a, dotS3(a, b, 0, 0, 3), dotS3(a, b, 1, 0, 3), dotS3(a, b, 2, 0, 3), dotS3(a, b, 0, 3, 3), dotS3(a, b, 1, 3, 3), dotS3(a, b, 2, 3, 3), dotS3(a, b, 0, 6, 3), dotS3(a, b, 1, 6, 3), dotS3(a, b, 2, 6, 3)));\n/**\n * 4x4 matrix-matrix multiplication. If `out` is not given, writes\n * result in `a`.\n *\n * @param out -\n * @param a -\n * @param b -\n */\nexport const mulM44 = mulM.add(16, (out, a, b) => setC(out || a, dotS4(a, b, 0, 0, 4), dotS4(a, b, 1, 0, 4), dotS4(a, b, 2, 0, 4), dotS4(a, b, 3, 0, 4), dotS4(a, b, 0, 4, 4), dotS4(a, b, 1, 4, 4), dotS4(a, b, 2, 4, 4), dotS4(a, b, 3, 4, 4), dotS4(a, b, 0, 8, 4), dotS4(a, b, 1, 8, 4), dotS4(a, b, 2, 8, 4), dotS4(a, b, 3, 8, 4), dotS4(a, b, 0, 12, 4), dotS4(a, b, 1, 12, 4), dotS4(a, b, 2, 12, 4), dotS4(a, b, 3, 12, 4)));\n","import { mulM } from \"./mulm.js\";\n/**\n * Concatenates / multiplies given matrices in left-to-right order. A\n * minimum of 2 input matrices must be given. If `out` is null, writes\n * result into `a`.\n *\n * @param out -\n * @param a -\n * @param b -\n * @param xs -\n */\nexport const concat = (out, a, b, ...xs) => xs.reduce((acc, x) => mulM(acc, acc, x), mulM(out, a, b));\n","import { dotS2, dotS3, dotS4 } from \"@thi.ng/vectors/dots\";\nimport { setC2, setC3, setC4 } from \"@thi.ng/vectors/setc\";\nimport { vop } from \"@thi.ng/vectors/vop\";\n/**\n * Matrix-vector multiplication. Supports in-place modification, i.e. if\n * `out === v`.\n *\n * @param out -\n * @param m -\n * @param v -\n */\nexport const mulV = vop(1);\n/**\n * Multiplies 2x2 matrix `m` with 2D vector `v`. Supports in-place\n * modification, i.e. if `out === v`.\n *\n * @param out -\n * @param m -\n * @param v -\n */\nexport const mulV22 = mulV.add(4, (out, m, v) => setC2(out || v, dotS2(m, v, 0, 0, 2), dotS2(m, v, 1, 0, 2)));\n/**\n * Multiplies 2x3 matrix `m` with 2D vector `v`. Supports in-place\n * modification, i.e. if `out === v`.\n *\n * @param out -\n * @param m -\n * @param v -\n */\nexport const mulV23 = mulV.add(6, (out, m, v) => setC2(out || v, dotS2(m, v, 0, 0, 2) + m[4], dotS2(m, v, 1, 0, 2) + m[5]));\n/**\n * Multiplies 3x3 matrix `m` with 3D vector `v`. Supports in-place\n * modification, i.e. if `out === v`.\n *\n * @param out -\n * @param m -\n * @param v -\n */\nexport const mulV33 = mulV.add(9, (out, m, v) => setC3(out || v, dotS3(m, v, 0, 0, 3), dotS3(m, v, 1, 0, 3), dotS3(m, v, 2, 0, 3)));\n/**\n * Multiplies 4x4 matrix `m` with 4D vector `v`. Supports in-place\n * modification, i.e. if `out === v`.\n *\n * @param out -\n * @param m -\n * @param v -\n */\nexport const mulV44 = mulV.add(16, (out, m, v) => setC4(out || v, dotS4(m, v, 0, 0, 4), dotS4(m, v, 1, 0, 4), dotS4(m, v, 2, 0, 4), dotS4(m, v, 3, 0, 4)));\n/**\n * Multiplies 4x4 matrix `m` with 3D vector `v` and assumes initial\n * `w=1`, i.e. the vector is interpreted as `[x,y,z,1]`. After\n * transformation applies perspective divide of the resulting XYZ\n * components. Returns `undefined` if the computed perspective divisor\n * is zero (and would cause `NaN` results).\n *\n * @param out -\n * @param m -\n * @param v -\n */\nexport const mulV344 = (out, m, v) => {\n    const w = dotS3(m, v, 3, 0, 4) + m[15];\n    return w !== 0\n        ? setC3(out || v, (dotS3(m, v, 0, 0, 4) + m[12]) / w, (dotS3(m, v, 1, 0, 4) + m[13]) / w, (dotS3(m, v, 2, 0, 4) + m[14]) / w)\n        : undefined;\n};\n/**\n * Multiplies quaternion `q` with 3D vector `v`. Returns transformed\n * vector or modifies in-place if `out` is null or `v`.\n *\n * @param out -\n * @param q -\n * @param v -\n */\nexport const mulVQ = (out, q, v) => {\n    const { 0: px, 1: py, 2: pz } = v;\n    const { 0: qx, 1: qy, 2: qz, 3: qw } = q;\n    const ix = qw * px + qy * pz - qz * py;\n    const iy = qw * py + qz * px - qx * pz;\n    const iz = qw * pz + qx * py - qy * px;\n    const iw = -qx * px - qy * py - qz * pz;\n    return setC3(out || v, ix * qw + iw * -qx + iy * -qz - iz * -qy, iy * qw + iw * -qy + iz * -qx - ix * -qz, iz * qw + iw * -qz + ix * -qy - iy * -qx);\n};\n","/**\n * Returns pairwise product sum of given components.\n *\n * @param a -\n * @param b -\n * @param c -\n * @param d -\n */\nexport const dotC4 = (a, b, c, d) => a * b + c * d;\n/**\n * Returns pairwise product sum of given components.\n *\n * @param a -\n * @param b -\n * @param c -\n * @param d -\n * @param e -\n * @param f -\n */\nexport const dotC6 = (a, b, c, d, e, f) => a * b + c * d + e * f;\n/**\n * Returns pairwise product sum of given components.\n *\n * @param a -\n * @param b -\n * @param c -\n * @param d -\n * @param e -\n * @param f -\n * @param g -\n * @param h -\n */\nexport const dotC8 = (a, b, c, d, e, f, g, h) => a * b + c * d + e * f + g * h;\n","import { dotC4, dotC6 } from \"@thi.ng/vectors/dotc\";\nconst dp4 = dotC4;\nconst dp6 = dotC6;\nexport const det22 = (m) => dp4(m[0], m[3], -m[1], m[2]);\nexport const det23 = det22;\nexport const det33 = (m) => {\n    const [m00, m01, m02, m10, m11, m12, m20, m21, m22] = m;\n    const d01 = dp4(m22, m11, -m12, m21);\n    const d11 = dp4(m12, m20, -m22, m10);\n    const d21 = dp4(m21, m10, -m11, m20);\n    return dp6(m00, d01, m01, d11, m02, d21);\n};\nexport const detCoeffs44 = (m) => {\n    const [m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33,] = m;\n    return [\n        dp4(m00, m11, -m01, m10),\n        dp4(m00, m12, -m02, m10),\n        dp4(m00, m13, -m03, m10),\n        dp4(m01, m12, -m02, m11),\n        dp4(m01, m13, -m03, m11),\n        dp4(m02, m13, -m03, m12),\n        dp4(m20, m31, -m21, m30),\n        dp4(m20, m32, -m22, m30),\n        dp4(m20, m33, -m23, m30),\n        dp4(m21, m32, -m22, m31),\n        dp4(m21, m33, -m23, m31),\n        dp4(m22, m33, -m23, m32),\n    ];\n};\nexport const det44FromCoeffs = (d) => dp6(d[0], d[11], -d[1], d[10], d[2], d[9]) +\n    dp6(d[3], d[8], -d[4], d[7], d[5], d[6]);\nexport const det44 = (m) => det44FromCoeffs(detCoeffs44(m));\n","import { dotC4, dotC6 } from \"@thi.ng/vectors/dotc\";\nimport { magSq4 } from \"@thi.ng/vectors/magsq\";\nimport { setC, setC4, setC6 } from \"@thi.ng/vectors/setc\";\nimport { vop } from \"@thi.ng/vectors/vop\";\nimport { det44FromCoeffs, detCoeffs44 } from \"./determinant.js\";\nconst dp4 = dotC4;\nconst dp6 = dotC6;\n/**\n * Matrix inversion. Returns `undefined` if matrix is not invertible.\n * Mutates `mat` if `out` is `null`.\n *\n * @param out -\n * @param mat -\n */\nexport const invert = vop(1);\nexport const invert22 = invert.add(4, (out, m) => {\n    const [m00, m01, m10, m11] = m;\n    let det = dp4(m00, m11, -m01, m10);\n    if (det === 0)\n        return;\n    det = 1.0 / det;\n    return setC4(out || m, m11 * det, -m01 * det, -m10 * det, m00 * det);\n});\nexport const invert23 = invert.add(6, (out, m) => {\n    const [m00, m01, m10, m11, m20, m21] = m;\n    let det = dp4(m00, m11, -m01, m10);\n    if (det === 0)\n        return;\n    det = 1.0 / det;\n    return setC6(out || m, m11 * det, -m01 * det, -m10 * det, m00 * det, dp4(m10, m21, -m11, m20) * det, dp4(m01, m20, -m00, m21) * det);\n});\nexport const invert33 = invert.add(9, (out, m) => {\n    const [m00, m01, m02, m10, m11, m12, m20, m21, m22] = m;\n    const d01 = dp4(m22, m11, -m12, m21);\n    const d11 = dp4(m12, m20, -m22, m10);\n    const d21 = dp4(m21, m10, -m11, m20);\n    let det = dp6(m00, d01, m01, d11, m02, d21);\n    if (det === 0)\n        return;\n    det = 1.0 / det;\n    return setC(out || m, d01 * det, dp4(-m22, m01, m02, m21) * det, dp4(m12, m01, -m02, m11) * det, d11 * det, dp4(m22, m00, -m02, m20) * det, dp4(-m12, m00, m02, m10) * det, d21 * det, dp4(-m21, m00, m01, m20) * det, dp4(m11, m00, -m01, m10) * det);\n});\nexport const invert44 = invert.add(16, (out, m) => {\n    const coeffs = detCoeffs44(m);\n    let det = det44FromCoeffs(coeffs);\n    if (det === 0)\n        return;\n    det = 1.0 / det;\n    const [m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33,] = m;\n    const [d00, d01, d02, d03, d04, d05, d06, d07, d08, d09, d10, d11] = coeffs;\n    return setC(out || m, dp6(m11, d11, -m12, d10, m13, d09) * det, dp6(-m01, d11, m02, d10, -m03, d09) * det, dp6(m31, d05, -m32, d04, m33, d03) * det, dp6(-m21, d05, m22, d04, -m23, d03) * det, dp6(-m10, d11, m12, d08, -m13, d07) * det, dp6(m00, d11, -m02, d08, m03, d07) * det, dp6(-m30, d05, m32, d02, -m33, d01) * det, dp6(m20, d05, -m22, d02, m23, d01) * det, dp6(m10, d10, -m11, d08, m13, d06) * det, dp6(-m00, d10, m01, d08, -m03, d06) * det, dp6(m30, d04, -m31, d02, m33, d00) * det, dp6(-m20, d04, m21, d02, -m23, d00) * det, dp6(-m10, d09, m11, d07, -m12, d06) * det, dp6(m00, d09, -m01, d07, m02, d06) * det, dp6(-m30, d03, m31, d01, -m32, d00) * det, dp6(m20, d03, -m21, d01, m22, d00) * det);\n});\nexport const invertQ = (out, a) => {\n    let d = magSq4(a);\n    d = d > 0 ? -1 / d : 0;\n    return setC4(out || a, a[0] * d, a[1] * d, a[2] * d, a[3] * -d);\n};\n","export const defError = (prefix, suffix = (msg) => (msg !== undefined ? \": \" + msg : \"\")) => class extends Error {\n    constructor(msg) {\n        super(prefix(msg) + suffix(msg));\n    }\n};\n","import { defError } from \"./deferror.js\";\nexport const IllegalArityError = defError(() => \"illegal arity\");\nexport const illegalArity = (n) => {\n    throw new IllegalArityError(n);\n};\n","import { illegalArity } from \"@thi.ng/errors/illegal-arity\";\nexport function comp(...fns) {\n    let [a, b, c, d, e, f, g, h, i, j] = fns;\n    switch (fns.length) {\n        case 0:\n            illegalArity(0);\n        case 1:\n            return a;\n        case 2:\n            return (...xs) => a(b(...xs));\n        case 3:\n            return (...xs) => a(b(c(...xs)));\n        case 4:\n            return (...xs) => a(b(c(d(...xs))));\n        case 5:\n            return (...xs) => a(b(c(d(e(...xs)))));\n        case 6:\n            return (...xs) => a(b(c(d(e(f(...xs))))));\n        case 7:\n            return (...xs) => a(b(c(d(e(f(g(...xs)))))));\n        case 8:\n            return (...xs) => a(b(c(d(e(f(g(h(...xs))))))));\n        case 9:\n            return (...xs) => a(b(c(d(e(f(g(h(i(...xs)))))))));\n        case 10:\n        default:\n            const fn = (...xs) => a(b(c(d(e(f(g(h(i(j(...xs))))))))));\n            return fns.length === 10 ? fn : comp(fn, ...fns.slice(10));\n    }\n}\nexport function compL(...fns) {\n    return comp.apply(null, fns.reverse());\n}\n/**\n * @deprecated renamed to {@link (compL:1)}\n */\nexport const compI = compL;\n","export const implementsFunction = (x, fn) => x != null && typeof x[fn] === \"function\";\n","import { implementsFunction } from \"@thi.ng/checks/implements-function\";\nexport const ensureTransducer = (x) => implementsFunction(x, \"xform\") ? x.xform() : x;\n","import { comp as _comp } from \"@thi.ng/compose/comp\";\nimport { ensureTransducer } from \"./ensure.js\";\nexport function comp(...fns) {\n    fns = fns.map(ensureTransducer);\n    return _comp.apply(null, fns);\n}\n","export const isIterable = (x) => x != null && typeof x[Symbol.iterator] === \"function\";\n","/**\n * Reducer composition helper, internally used by various transducers\n * during initialization. Takes existing reducer `rfn` (a 3-tuple) and a\n * reducing function `fn`. Returns a new reducer tuple.\n *\n * @remarks\n * `rfn[2]` reduces values of type `B` into an accumulator of type `A`.\n * `fn` accepts values of type `C` and produces interim results of type\n * `B`, which are then (possibly) passed to the \"inner\" `rfn[2]`\n * function. Therefore the resulting reducer takes inputs of `C` and an\n * accumulator of type `A`.\n *\n * It is assumed that `fn` internally calls `rfn[2]` to pass its own\n * results for further processing by the nested reducer `rfn`.\n *\n * @example\n * ```ts\n * compR(rfn, fn)\n * // [rfn[0], rfn[1], fn]\n * ```\n *\n * @param rfn -\n * @param fn -\n */\nexport const compR = (rfn, fn) => [rfn[0], rfn[1], fn];\n","export const DEFAULT_EPS = 1e-6;\n/**\n * Internal use only. **Do NOT use in user land code!**\n *\n * @internal\n */\nexport const SEMAPHORE = Symbol();\n/**\n * No-effect placeholder function.\n */\nexport const NO_OP = () => { };\n/**\n * Catch-all event ID\n */\nexport const EVENT_ALL = \"*\";\nexport const EVENT_ENABLE = \"enable\";\nexport const EVENT_DISABLE = \"disable\";\n","export class Reduced {\n    constructor(val) {\n        this.value = val;\n    }\n    deref() {\n        return this.value;\n    }\n}\nexport const reduced = (x) => new Reduced(x);\nexport const isReduced = (x) => x instanceof Reduced;\nexport const ensureReduced = (x) => x instanceof Reduced ? x : new Reduced(x);\nexport const unreduced = (x) => (x instanceof Reduced ? x.deref() : x);\n","import { implementsFunction } from \"@thi.ng/checks/implements-function\";\nimport { isArrayLike } from \"@thi.ng/checks/is-arraylike\";\nimport { isIterable } from \"@thi.ng/checks/is-iterable\";\nimport { illegalArity } from \"@thi.ng/errors/illegal-arity\";\nimport { isReduced, unreduced } from \"./reduced.js\";\nconst parseArgs = (args) => args.length === 2\n    ? [undefined, args[1]]\n    : args.length === 3\n        ? [args[1], args[2]]\n        : illegalArity(args.length);\nexport function reduce(...args) {\n    const rfn = args[0];\n    const init = rfn[0];\n    const complete = rfn[1];\n    const reduce = rfn[2];\n    args = parseArgs(args);\n    const acc = args[0] == null ? init() : args[0];\n    const xs = args[1];\n    return unreduced(complete(implementsFunction(xs, \"$reduce\")\n        ? xs.$reduce(reduce, acc)\n        : isArrayLike(xs)\n            ? reduceArray(reduce, acc, xs)\n            : reduceIterable(reduce, acc, xs)));\n}\nexport function reduceRight(...args) {\n    const rfn = args[0];\n    const init = rfn[0];\n    const complete = rfn[1];\n    const reduce = rfn[2];\n    args = parseArgs(args);\n    let acc = args[0] == null ? init() : args[0];\n    const xs = args[1];\n    for (let i = xs.length; i-- > 0;) {\n        acc = reduce(acc, xs[i]);\n        if (isReduced(acc)) {\n            acc = acc.deref();\n            break;\n        }\n    }\n    return unreduced(complete(acc));\n}\nconst reduceArray = (rfn, acc, xs) => {\n    for (let i = 0, n = xs.length; i < n; i++) {\n        acc = rfn(acc, xs[i]);\n        if (isReduced(acc)) {\n            acc = acc.deref();\n            break;\n        }\n    }\n    return acc;\n};\nconst reduceIterable = (rfn, acc, xs) => {\n    for (let x of xs) {\n        acc = rfn(acc, x);\n        if (isReduced(acc)) {\n            acc = acc.deref();\n            break;\n        }\n    }\n    return acc;\n};\n/**\n * Convenience helper for building a full {@link Reducer} using the identity\n * function (i.e. `(x) => x`) as completion step (true for 90% of all\n * bundled transducers).\n *\n * @param init - init step of reducer\n * @param rfn - reduction step of reducer\n */\nexport const reducer = (init, rfn) => [init, (acc) => acc, rfn];\nexport const $$reduce = (rfn, args) => {\n    const n = args.length - 1;\n    return isIterable(args[n])\n        ? args.length > 1\n            ? reduce(rfn.apply(null, args.slice(0, n)), args[n])\n            : reduce(rfn(), args[0])\n        : undefined;\n};\n","export const isArrayLike = (x) => x != null && typeof x !== \"function\" && x.length !== undefined;\n","import { reducer } from \"./reduce.js\";\nexport function push(xs) {\n    return xs\n        ? [...xs]\n        : reducer(() => [], (acc, x) => (acc.push(x), acc));\n}\n","import { NO_OP, SEMAPHORE } from \"@thi.ng/api/api\";\nimport { isIterable } from \"@thi.ng/checks/is-iterable\";\nimport { ensureTransducer } from \"./ensure.js\";\nimport { push } from \"./push.js\";\nimport { isReduced, unreduced } from \"./reduced.js\";\n/**\n * Takes a transducer and input iterable. Returns iterator of\n * transformed results.\n *\n * @param xform -\n * @param xs -\n */\nexport function* iterator(xform, xs) {\n    const rfn = ensureTransducer(xform)(push());\n    const complete = rfn[1];\n    const reduce = rfn[2];\n    for (let x of xs) {\n        const y = reduce([], x);\n        if (isReduced(y)) {\n            yield* unreduced(complete(y.deref()));\n            return;\n        }\n        if (y.length) {\n            yield* y;\n        }\n    }\n    yield* unreduced(complete([]));\n}\n/**\n * Optimized version of {@link iterator} for transducers which are\n * guaranteed to:\n *\n * 1) Only produce none or a single result per input\n * 2) Do not require a `completion` reduction step\n *\n * @param xform -\n * @param xs -\n */\nexport function* iterator1(xform, xs) {\n    const reduce = (ensureTransducer(xform)([NO_OP, NO_OP, (_, x) => x]))[2];\n    for (let x of xs) {\n        let y = reduce(SEMAPHORE, x);\n        if (isReduced(y)) {\n            y = unreduced(y.deref());\n            if (y !== SEMAPHORE) {\n                yield y;\n            }\n            return;\n        }\n        if (y !== SEMAPHORE) {\n            yield y;\n        }\n    }\n}\n/**\n * Helper function used by various transducers to wrap themselves as\n * transforming iterators. Delegates to {@link iterator1} by default.\n *\n * @param xform -\n * @param args -\n * @param impl -\n *\n * @internal\n */\nexport const __iter = (xform, args, impl = iterator1) => {\n    const n = args.length - 1;\n    return isIterable(args[n])\n        ? args.length > 1\n            ? impl(xform.apply(null, args.slice(0, n)), args[n])\n            : impl(xform(), args[0])\n        : undefined;\n};\n","import { isIterable } from \"@thi.ng/checks/is-iterable\";\nimport { compR } from \"./compr.js\";\nimport { iterator1 } from \"./iterator.js\";\nexport function map(fn, src) {\n    return isIterable(src)\n        ? iterator1(map(fn), src)\n        : (rfn) => {\n            const r = rfn[2];\n            return compR(rfn, (acc, x) => r(acc, fn(x)));\n        };\n}\n/**\n * Convenience wrapper for {@link map} to transform an iterable with given `fn`\n * and immediatedly collect results into an array.\n */\nexport const mapA = (fn, src) => [\n    ...map(fn, src),\n];\n","import { compR } from \"./compr.js\";\nimport { __iter } from \"./iterator.js\";\nexport function mapIndexed(...args) {\n    return (__iter(mapIndexed, args) ||\n        ((rfn) => {\n            const r = rfn[2];\n            const fn = args[0];\n            let i = args[1] || 0;\n            return compR(rfn, (acc, x) => r(acc, fn(i++, x)));\n        }));\n}\n","import { isReduced } from \"./reduced.js\";\nexport function range(from, to, step) {\n    return new Range(from, to, step);\n}\n/**\n * Simple class wrapper around given range interval and implementing\n * `Iterable` and {@link IReducible} interfaces, the latter is used to\n * accelerate use with {@link (reduce:1)}.\n */\nexport class Range {\n    constructor(from, to, step) {\n        if (from === undefined) {\n            from = 0;\n            to = Infinity;\n        }\n        else if (to === undefined) {\n            to = from;\n            from = 0;\n        }\n        step = step === undefined ? (from < to ? 1 : -1) : step;\n        this.from = from;\n        this.to = to;\n        this.step = step;\n    }\n    *[Symbol.iterator]() {\n        let { from, to, step } = this;\n        if (step > 0) {\n            while (from < to) {\n                yield from;\n                from += step;\n            }\n        }\n        else if (step < 0) {\n            while (from > to) {\n                yield from;\n                from += step;\n            }\n        }\n    }\n    $reduce(rfn, acc) {\n        const step = this.step;\n        if (step > 0) {\n            for (let i = this.from, n = this.to; i < n && !isReduced(acc); i += step) {\n                acc = rfn(acc, i);\n            }\n        }\n        else {\n            for (let i = this.from, n = this.to; i > n && !isReduced(acc); i += step) {\n                acc = rfn(acc, i);\n            }\n        }\n        return acc;\n    }\n}\n","import { reducer } from \"./reduce.js\";\nexport function str(sep, xs) {\n    sep = sep || \"\";\n    let first = true;\n    return xs\n        ? [...xs].join(sep)\n        : reducer(() => \"\", (acc, x) => ((acc = first ? acc + x : acc + sep + x),\n            (first = false),\n            acc));\n}\n","import { isIterable } from \"@thi.ng/checks/is-iterable\";\nimport { compR } from \"./compr.js\";\nimport { iterator } from \"./iterator.js\";\nimport { ensureReduced, reduced } from \"./reduced.js\";\nexport function take(n, src) {\n    return isIterable(src)\n        ? iterator(take(n), src)\n        : (rfn) => {\n            const r = rfn[2];\n            let m = n;\n            return compR(rfn, (acc, x) => --m > 0\n                ? r(acc, x)\n                : m === 0\n                    ? ensureReduced(r(acc, x))\n                    : reduced(acc));\n        };\n}\n","import { illegalArity } from \"@thi.ng/errors/illegal-arity\";\nimport { ensureTransducer } from \"./ensure.js\";\nimport { map } from \"./map.js\";\nimport { reduce, reduceRight } from \"./reduce.js\";\nexport function transduce(...args) {\n    return $transduce(transduce, reduce, args);\n}\nexport function transduceRight(...args) {\n    return $transduce(transduceRight, reduceRight, args);\n}\nconst $transduce = (tfn, rfn, args) => {\n    let acc, xs;\n    switch (args.length) {\n        case 4:\n            xs = args[3];\n            acc = args[2];\n            break;\n        case 3:\n            xs = args[2];\n            break;\n        case 2:\n            return map((x) => tfn(args[0], args[1], x));\n        default:\n            illegalArity(args.length);\n    }\n    return rfn(ensureTransducer(args[0])(args[1]), acc, xs);\n};\n","export function* zip(...src) {\n    const iters = src.map((s) => s[Symbol.iterator]());\n    while (true) {\n        const tuple = [];\n        for (let i of iters) {\n            let v = i.next();\n            if (v.done) {\n                return;\n            }\n            tuple.push(v.value);\n        }\n        yield tuple;\n    }\n}\n","import { defError } from \"./deferror.js\";\nexport const UnsupportedOperationError = defError(() => \"unsupported operation\");\nexport const unsupported = (msg) => {\n    throw new UnsupportedOperationError(msg);\n};\n","import { unsupported } from \"@thi.ng/errors/unsupported\";\n/**\n * Specialized / optimized version of {@link @thi.ng/defmulti# | @thi.ng/defmulti} for\n * vector operations. Uses simplified logic to dispatch on length\n * (vector size) of `dispatch` argument.\n *\n * @param dispatch - arg index\n */\nexport const vop = (dispatch = 0) => {\n    const impls = new Array(5);\n    let fallback;\n    const fn = (...args) => {\n        const g = impls[args[dispatch].length] || fallback;\n        return g\n            ? g(...args)\n            : unsupported(`no impl for vec size ${args[dispatch].length}`);\n    };\n    fn.add = (dim, fn) => (impls[dim] = fn);\n    fn.default = (fn) => (fallback = fn);\n    fn.impl = (dim) => impls[dim] || fallback;\n    // fn.impls = impls;\n    return fn;\n};\n","/** @internal */\nexport const ARGS_V = \"o,a\";\n/** @internal */\nexport const ARGS_VV = \"o,a,b\";\n/** @internal */\nexport const ARGS_VVV = \"o,a,b,c\";\n/** @internal */\nexport const ARGS_VN = \"o,a,n\";\n/** @internal */\nexport const ARGS_VNV = \"o,a,n,b\";\n/** @internal */\nexport const ARGS_VVN = \"o,a,b,n\";\n/** @internal */\nexport const SARGS_V = \"io=0,ia=0,so=1,sa=1\";\n/** @internal */\nexport const SARGS_VV = \"io=0,ia=0,ib=0,so=1,sa=1,sb=1\";\n/** @internal */\nexport const SARGS_VVV = \"io=0,ia=0,ib=0,ic=0,so=1,sa=1,sb=1,sc=1\";\n/** @internal */\nexport const DEFAULT_OUT = \"!o&&(o=a);\";\n/** @internal */\nexport const NEW_OUT = \"!o&&(o=[]);\";\n/** @internal */\nexport const NEW_OUT_A = \"!a&&(a=[]);\";\n/** @internal */\n// prettier-ignore\nexport const MATH = (op) => ([o, a, b]) => `${o}=${a}${op}${b};`;\n/** @internal */\n// prettier-ignore\nexport const MATH_N = (op) => ([o, a]) => `${o}=${a}${op}n;`;\n/** @internal */\n// prettier-ignore\nexport const MATH2 = (op1, op2) => ([o, a, b, c]) => `${o}=(${a}${op1}${b})${op2}${c};`;\n/** @internal */\n// prettier-ignore\nexport const MATH2_N = (op1, op2) => ([o, a, b]) => `${o}=(${a}${op1}${b})${op2}n;`;\n/** @internal */\n// prettier-ignore\nexport const MATH2A_N = (op1, op2) => ([o, a, b]) => `${o}=(${a}${op1}n)${op2}${b};`;\n/** @internal */\n// prettier-ignore\nexport const SIGNED = (op) => ([o, a, b]) => `${o}=(${a}${op}${b})|0;`;\n/** @internal */\n// prettier-ignore\nexport const UNSIGNED = (op) => ([o, a, b]) => `${o}=(${a}${op}${b})>>>0;`;\n/** @internal */\n// prettier-ignore\nexport const SIGNED_N = (op) => ([o, a]) => `${o}=(${a}${op}n)|0;`;\n/** @internal */\n// prettier-ignore\nexport const UNSIGNED_N = (op) => ([o, a]) => `${o}=(${a}${op}n)>>>0;`;\n/** @internal */\n// prettier-ignore\nexport const FN = (op = \"op\") => ([o, a]) => `${o}=${op}(${a});`;\n/** @internal */\n// prettier-ignore\nexport const FN2 = (op = \"op\") => ([o, a, b]) => `${o}=${op}(${a},${b});`;\n/** @internal */\n// prettier-ignore\nexport const FN3 = (op = \"op\") => ([o, a, b, c]) => `${o}=${op}(${a},${b},${c});`;\n/** @internal */\n// prettier-ignore\nexport const FN5 = (op = \"op\") => ([o, a, b, c, d, e]) => `${o}=${op}(${a},${b},${c},${d},${e});`;\n/** @internal */\n// prettier-ignore\nexport const FN_N = (op = \"op\") => ([o, a]) => `${o}=${op}(${a},n);`;\n/** @internal */\nexport const DOT = ([a, b]) => `${a}*${b}`;\n/** @internal */\nexport const DOT_G = ([a, b]) => `s+=${a}*${b};`;\n/** @internal */\nexport const SET = ([o, a]) => `${o}=${a};`;\n/** @internal */\nexport const SET_N = ([a]) => `${a}=n;`;\n/** @internal */\nexport const MIX = ([o, a, b, c]) => `${o}=${a}+(${b}-${a})*${c};`;\n/** @internal */\nexport const MIX_N = ([o, a, b]) => `${o}=${a}+(${b}-${a})*n;`;\n","import { comp } from \"@thi.ng/transducers/comp\";\nimport { map } from \"@thi.ng/transducers/map\";\nimport { mapIndexed } from \"@thi.ng/transducers/map-indexed\";\nimport { range } from \"@thi.ng/transducers/range\";\nimport { str } from \"@thi.ng/transducers/str\";\nimport { take } from \"@thi.ng/transducers/take\";\nimport { transduce } from \"@thi.ng/transducers/transduce\";\nimport { zip } from \"@thi.ng/transducers/zip\";\nimport { vop } from \"../vop.js\";\nimport { ARGS_V, ARGS_VN, ARGS_VV, DEFAULT_OUT, FN, MATH, MATH_N, SARGS_VV, SIGNED, SIGNED_N, UNSIGNED, UNSIGNED_N, } from \"./templates.js\";\n/**\n * HOF array index lookup gen to provide optimized versions of:\n *\n * @example\n * ```ts\n * lookup(\"a\")(0) // a[ia]\n * lookup(\"a\")(1) // a[ia * sa]\n * lookup(\"a\")(2) // a[ia + 2 * sa]\n * ```\n *\n * @param sym -\n */\nconst lookup = (sym) => (i) => i > 1\n    ? `${sym}[i${sym}+${i}*s${sym}]`\n    : i == 1\n        ? `${sym}[i${sym}+s${sym}]`\n        : `${sym}[i${sym}]`;\n/**\n * Infinite iterator of strided index lookups for `sym`.\n *\n * @param sym -\n */\nconst indicesStrided = (sym) => map(lookup(sym), range());\n/**\n * Infinite iterator of simple (non-strided) index lookups for `sym`.\n *\n * @param sym -\n */\nconst indices = (sym) => map((i) => `${sym}[${i}]`, range());\n/**\n * Code generator for loop-unrolled vector operations. Takes a vector\n * size `dim`, a code template function `tpl` and an array of symbol\n * names participating in the template. For each symbol, creates\n * iterator of index lookups (e.g. `a[0]` or `a[ia+k*sa]`), forms them\n * into tuples and passes them to template to generate code and joins\n * generated result with `opJoin` separator (default:\n * `\"\"`).\n *\n * If the optional `ret` arg is not `null` (default `\"a\"`), appends a\n * `return` statement to the result array, using `ret` as return value.\n * Returns array of source code lines.\n *\n * The optional `pre` and `post` strings can be used to wrap the\n * generated code. `post` will be injected **before** the generated\n * return statement (if not suppressed).\n *\n * @param dim -\n * @param tpl -\n * @param syms -\n * @param ret -\n * @param opJoin -\n * @param pre -\n * @param post -\n * @param strided -\n */\nconst assemble = (dim, tpl, syms, ret = \"a\", opJoin = \"\", pre = \"\", post = \"\", strided = false) => [\n    pre,\n    transduce(comp(take(dim), mapIndexed((i, x) => tpl(x, i))), str(opJoin), (zip.apply(null, syms.split(\",\").map(strided ? indicesStrided : indices)))),\n    post,\n    ret !== \"\" ? `return ${ret};` : \"\",\n];\nconst assembleG = (tpl, syms, ret = \"a\", pre, post, strided = false) => [\n    pre,\n    \"for(let i=a.length;--i>=0;) {\",\n    tpl(syms\n        .split(\",\")\n        .map(strided ? (x) => `${x}[i${x}+i*s${x}]` : (x) => `${x}[i]`)),\n    \"}\",\n    post,\n    ret !== null ? `return ${ret};` : \"\",\n];\nconst assembleS = (tpl, syms = ARGS_VV, ret = \"o\", pre = DEFAULT_OUT, post) => [\n    pre,\n    \"while(k-->0) {\",\n    tpl(syms.split(\",\").map((x) => `${x}[i${x}+k*s${x}]`)),\n    \"}\",\n    post,\n    ret !== null ? `return ${ret};` : \"\",\n];\n/** @internal */\nexport const defaultOut = (o, args) => `!${o} && (${o}=${args.split(\",\")[1]});`;\n/** @internal */\nexport const compile = (dim, tpl, args, syms = args, ret = \"a\", opJoin, pre, post, strided = false) => (new Function(args, assemble(dim, tpl, syms, ret, opJoin, pre, post, strided).join(\"\")));\n/** @internal */\nexport const compileHOF = (dim, fns, tpl, hofArgs, args, syms = args, ret = \"a\", opJoin = \"\", pre, post, strided = false) => {\n    return new Function(hofArgs, `return (${args})=>{${assemble(dim, tpl, syms, ret, opJoin, pre, post, strided).join(\"\")}}`)(...fns);\n};\n/** @internal */\nexport const compileG = (tpl, args, syms = args, ret = \"a\", pre, post, strided = false) => (new Function(args, assembleG(tpl, syms, ret, pre, post, strided).join(\"\")));\n/** @internal */\nexport const compileS = (tpl, args, syms = args, ret, pre, post) => new Function(args, assembleS(tpl, syms, ret, pre, post).join(\"\"));\n/** @internal */\nexport const compileGHOF = (fns, tpl, hofArgs, args, syms = args, ret = \"a\", pre, post, strided = false) => (new Function(hofArgs, `return (${args})=>{${assembleG(tpl, syms, ret, pre, post, strided).join(\"\")}}`)(...fns));\nexport const defOp = (tpl, args = ARGS_VV, syms, ret = \"o\", dispatch = 1, pre) => {\n    syms = syms || args;\n    pre = pre != null ? pre : defaultOut(ret, args);\n    const fn = vop(dispatch);\n    const $ = (dim) => fn.add(dim, compile(dim, tpl, args, syms, ret, \"\", pre));\n    fn.default(compileG(tpl, args, syms, ret, pre));\n    return [fn, $(2), $(3), $(4)];\n};\nexport const defFnOp = (op) => defOp(FN(op), ARGS_V);\nexport const defHofOp = (op, tpl, args = ARGS_V, syms, ret = \"o\", dispatch = 1, pre) => {\n    const _tpl = tpl || FN(\"op\");\n    syms = syms || args;\n    pre = pre != null ? pre : defaultOut(ret, args);\n    const fn = vop(dispatch);\n    const $ = (dim) => fn.add(dim, compileHOF(dim, [op], _tpl, \"op\", args, syms, ret, \"\", pre));\n    fn.default(compileGHOF([op], _tpl, \"op\", args, syms, ret, pre));\n    return [fn, $(2), $(3), $(4)];\n};\nexport const defOpS = (tpl, args = ARGS_VV, idxArgs = SARGS_VV, syms = ARGS_VV, ret = \"o\", pre, sizes = [2, 3, 4]) => [\n    compileS(tpl, `${args},k,${idxArgs}`, syms, ret, pre),\n    ...sizes.map((dim) => compile(dim, tpl, `${args},${idxArgs}`, syms, ret, \"\", pre != null ? pre : defaultOut(ret, args), \"\", true)),\n];\nexport const defHofOpS = (op, tpl, args = ARGS_VV, idxArgs = SARGS_VV, syms = ARGS_VV, ret = \"o\", pre, sizes = [2, 3, 4]) => [\n    new Function(\"op\", `return (${args},k,${idxArgs})=>{${assembleS(tpl, syms, ret, pre).join(\"\")}}`)(op),\n    ...sizes.map((dim) => compileHOF(dim, [op], tpl, \"op\", `${args},${idxArgs}`, syms, ret, \"\", pre != null ? pre : defaultOut(ret, args), \"\", true)),\n];\nexport const defMathOp = (op) => defOp(MATH(op));\nexport const defMathOpN = (op) => defOp(MATH_N(op), ARGS_VN);\nexport const defBitOp = (op, signed = false) => defOp((signed ? SIGNED : UNSIGNED)(op));\nexport const defBitOpN = (op, signed = false) => defOp((signed ? SIGNED_N : UNSIGNED_N)(op), ARGS_VN);\n","import { defMathOpN } from \"./compile/emit.js\";\nexport const [mulN, mulN2, mulN3, mulN4] = defMathOpN(\"*\");\n","import { defMathOp } from \"./compile/emit.js\";\nexport const [div, div2, div3, div4] = defMathOp(\"/\");\n","import { defMathOpN } from \"./compile/emit.js\";\nexport const [divN, divN2, divN3, divN4] = defMathOpN(\"/\");\n","import { defMathOp } from \"./compile/emit.js\";\nexport const [sub, sub2, sub3, sub4] = defMathOp(\"-\");\n","import { defMathOp } from \"./compile/emit.js\";\nexport const [add, add2, add3, add4] = defMathOp(\"+\");\n","import { defOp } from \"./compile/emit.js\";\nexport const [invert, invert2, invert3, invert4] = defOp(([o, a]) => `${o}=1/${a};`);\n","export const setC2 = (out, x, y) => (!out && (out = []), (out[0] = x), (out[1] = y), out);\nexport const setC3 = (out, x, y, z) => (!out && (out = []), (out[0] = x), (out[1] = y), (out[2] = z), out);\nexport const setC4 = (out, x, y, z, w) => (!out && (out = []),\n    (out[0] = x),\n    (out[1] = y),\n    (out[2] = z),\n    (out[3] = w),\n    out);\nexport const setC6 = (out, a, b, c, d, e, f) => (!out && (out = []),\n    (out[0] = a),\n    (out[1] = b),\n    (out[2] = c),\n    (out[3] = d),\n    (out[4] = e),\n    (out[5] = f),\n    out);\nexport const setC = (out, ...xs) => {\n    !out && (out = []);\n    for (let i = 0, n = xs.length; i < n; i++) {\n        out[i] = xs[i];\n    }\n    return out;\n};\n","import { compile, compileG } from \"./compile/emit.js\";\nimport { vop } from \"./vop.js\";\nconst tpl = ([a, b]) => `t=${a}-${b};s+=t*t;`;\nconst pre = \"let t,s=0;\";\nconst $ = (dim) => distSq.add(dim, compile(dim, tpl, \"a,b\", undefined, \"s\", \"\", pre));\nexport const distSq = vop();\ndistSq.default(compileG(tpl, \"a,b\", undefined, \"s\", pre));\nexport const distSq2 = $(2);\nexport const distSq3 = $(3);\nexport const distSq4 = $(4);\n","import { distSq, distSq2, distSq3, distSq4 } from \"./distsq.js\";\nexport const dist = (a, b) => Math.sqrt(distSq(a, b));\nexport const dist2 = (a, b) => Math.sqrt(distSq2(a, b));\nexport const dist3 = (a, b) => Math.sqrt(distSq3(a, b));\nexport const dist4 = (a, b) => Math.sqrt(distSq4(a, b));\n","export const PI = Math.PI;\nexport const TAU = PI * 2;\nexport const HALF_PI = PI / 2;\nexport const THIRD_PI = PI / 3;\nexport const QUARTER_PI = PI / 4;\nexport const SIXTH_PI = PI / 6;\nexport const INV_PI = 1 / PI;\nexport const INV_TAU = 1 / TAU;\nexport const INV_HALF_PI = 1 / HALF_PI;\nexport const DEG2RAD = PI / 180;\nexport const RAD2DEG = 180 / PI;\nexport const PHI = (1 + Math.sqrt(5)) / 2;\nexport const SQRT2 = Math.SQRT2;\nexport const SQRT3 = Math.sqrt(3);\nexport const SQRT2_2 = SQRT2 / 2;\nexport const SQRT3_2 = SQRT3 / 2;\nexport const THIRD = 1 / 3;\nexport const TWO_THIRD = 2 / 3;\nexport const SIXTH = 1 / 6;\nexport let EPS = 1e-6;\n","import { compile, compileG } from \"./compile/emit.js\";\nimport { vop } from \"./vop.js\";\nconst $ = (dim) => magSq.add(dim, compile(dim, ([a]) => `${a}*${a}`, \"a\", \"a\", \"\", \"+\", \"return \", \";\"));\nexport const magSq = vop();\nmagSq.default(compileG(([a]) => `sum+=${a}*${a};`, \"a\", undefined, \"sum\", \"let sum=0;\"));\nexport const magSq2 = $(2);\nexport const magSq3 = $(3);\nexport const magSq4 = $(4);\n","import { defOp } from \"./compile/emit.js\";\nimport { NEW_OUT, SET } from \"./compile/templates.js\";\nexport const [set, set2, set3, set4] = defOp(SET, \"o,a\", undefined, \"o\", 1, NEW_OUT);\n","import { EPS } from \"@thi.ng/math/api\";\nimport { mag } from \"./mag.js\";\nimport { magSq2, magSq3, magSq4 } from \"./magsq.js\";\nimport { mulN, mulN2, mulN3, mulN4 } from \"./muln.js\";\nimport { set, set2, set3, set4 } from \"./set.js\";\n/**\n * Normalizes vector to given (optional) length (default: 1). If `out`\n * is null, modifies `v` in place.\n *\n * @param out -\n * @param v -\n * @param n -\n */\nexport const normalize = (out, v, n = 1) => {\n    !out && (out = v);\n    const m = mag(v);\n    return m >= EPS ? mulN(out, v, n / m) : out !== v ? set(out, v) : out;\n};\n/**\n * Optimized 2d version of generic {@link normalize}.\n * @param out\n * @param v\n * @param n\n */\nexport const normalize2 = (out, v, n = 1) => {\n    !out && (out = v);\n    const m = Math.sqrt(magSq2(v));\n    return m >= EPS ? mulN2(out, v, n / m) : out !== v ? set2(out, v) : out;\n};\n/**\n * Optimized 3d version of generic {@link normalize}.\n * @param out\n * @param v\n * @param n\n */\nexport const normalize3 = (out, v, n = 1) => {\n    !out && (out = v);\n    const m = Math.sqrt(magSq3(v));\n    return m >= EPS ? mulN3(out, v, n / m) : out !== v ? set3(out, v) : out;\n};\n/**\n * Optimized 4d version of generic {@link normalize}.\n * @param out\n * @param v\n * @param n\n */\nexport const normalize4 = (out, v, n = 1) => {\n    !out && (out = v);\n    const m = Math.sqrt(magSq4(v));\n    return m >= EPS ? mulN4(out, v, n / m) : out !== v ? set4(out, v) : out;\n};\n","var gsl_const = {};\n\ngsl_const.CGS = {};\ngsl_const.CGS.SPEED_OF_LIGHT =  2.99792458e+10; /* cm / s */\ngsl_const.CGS.GRAVITATIONAL_CONSTANT =  6.673e-8; /* cm^3 / g s^2 */\ngsl_const.CGS.PLANCKS_CONSTANT_H =  6.62606896e-27; /* g cm^2 / s */\ngsl_const.CGS.PLANCKS_CONSTANT_HBAR =  1.05457162825e-27; /* g cm^2 / s */\ngsl_const.CGS.ASTRONOMICAL_UNIT =  1.49597870691e+13; /* cm */\ngsl_const.CGS.LIGHT_YEAR =  9.46053620707e+17; /* cm */\ngsl_const.CGS.PARSEC =  3.08567758135e+18; /* cm */\ngsl_const.CGS.GRAV_ACCEL =  9.80665e+2; /* cm / s^2 */\ngsl_const.CGS.ELECTRON_VOLT =  1.602176487e-12; /* g cm^2 / s^2 */\ngsl_const.CGS.MASS_ELECTRON =  9.10938188e-28; /* g */\ngsl_const.CGS.MASS_MUON =  1.88353109e-25; /* g */\ngsl_const.CGS.MASS_PROTON =  1.67262158e-24; /* g */\ngsl_const.CGS.MASS_NEUTRON =  1.67492716e-24; /* g */\ngsl_const.CGS.RYDBERG =  2.17987196968e-11; /* g cm^2 / s^2 */\ngsl_const.CGS.BOLTZMANN =  1.3806504e-16; /* g cm^2 / K s^2 */\ngsl_const.CGS.MOLAR_GAS =  8.314472e7; /* g cm^2 / K mol s^2 */\ngsl_const.CGS.STANDARD_GAS_VOLUME =  2.2710981e4; /* cm^3 / mol */\ngsl_const.CGS.MINUTE =  6e1; /* s */\ngsl_const.CGS.HOUR =  3.6e3; /* s */\ngsl_const.CGS.DAY =  8.64e4; /* s */\ngsl_const.CGS.WEEK =  6.048e5; /* s */\ngsl_const.CGS.INCH =  2.54e0; /* cm */\ngsl_const.CGS.FOOT =  3.048e1; /* cm */\ngsl_const.CGS.YARD =  9.144e1; /* cm */\ngsl_const.CGS.MILE =  1.609344e5; /* cm */\ngsl_const.CGS.NAUTICAL_MILE =  1.852e5; /* cm */\ngsl_const.CGS.FATHOM =  1.8288e2; /* cm */\ngsl_const.CGS.MIL =  2.54e-3; /* cm */\ngsl_const.CGS.POINT =  3.52777777778e-2; /* cm */\ngsl_const.CGS.TEXPOINT =  3.51459803515e-2; /* cm */\ngsl_const.CGS.MICRON =  1e-4; /* cm */\ngsl_const.CGS.ANGSTROM =  1e-8; /* cm */\ngsl_const.CGS.HECTARE =  1e8; /* cm^2 */\ngsl_const.CGS.ACRE =  4.04685642241e7; /* cm^2 */\ngsl_const.CGS.BARN =  1e-24; /* cm^2 */\ngsl_const.CGS.LITER =  1e3; /* cm^3 */\ngsl_const.CGS.US_GALLON =  3.78541178402e3; /* cm^3 */\ngsl_const.CGS.QUART =  9.46352946004e2; /* cm^3 */\ngsl_const.CGS.PINT =  4.73176473002e2; /* cm^3 */\ngsl_const.CGS.CUP =  2.36588236501e2; /* cm^3 */\ngsl_const.CGS.FLUID_OUNCE =  2.95735295626e1; /* cm^3 */\ngsl_const.CGS.TABLESPOON =  1.47867647813e1; /* cm^3 */\ngsl_const.CGS.TEASPOON =  4.92892159375e0; /* cm^3 */\ngsl_const.CGS.CANADIAN_GALLON =  4.54609e3; /* cm^3 */\ngsl_const.CGS.UK_GALLON =  4.546092e3; /* cm^3 */\ngsl_const.CGS.MILES_PER_HOUR =  4.4704e1; /* cm / s */\ngsl_const.CGS.KILOMETERS_PER_HOUR =  2.77777777778e1; /* cm / s */\ngsl_const.CGS.KNOT =  5.14444444444e1; /* cm / s */\ngsl_const.CGS.POUND_MASS =  4.5359237e2; /* g */\ngsl_const.CGS.OUNCE_MASS =  2.8349523125e1; /* g */\ngsl_const.CGS.TON =  9.0718474e5; /* g */\ngsl_const.CGS.METRIC_TON =  1e6; /* g */\ngsl_const.CGS.UK_TON =  1.0160469088e6; /* g */\ngsl_const.CGS.TROY_OUNCE =  3.1103475e1; /* g */\ngsl_const.CGS.CARAT =  2e-1; /* g */\ngsl_const.CGS.UNIFIED_ATOMIC_MASS =  1.660538782e-24; /* g */\ngsl_const.CGS.GRAM_FORCE =  9.80665e2; /* cm g / s^2 */\ngsl_const.CGS.POUND_FORCE =  4.44822161526e5; /* cm g / s^2 */\ngsl_const.CGS.KILOPOUND_FORCE =  4.44822161526e8; /* cm g / s^2 */\ngsl_const.CGS.POUNDAL =  1.38255e4; /* cm g / s^2 */\ngsl_const.CGS.CALORIE =  4.1868e7; /* g cm^2 / s^2 */\ngsl_const.CGS.BTU =  1.05505585262e10; /* g cm^2 / s^2 */\ngsl_const.CGS.THERM =  1.05506e15; /* g cm^2 / s^2 */\ngsl_const.CGS.HORSEPOWER =  7.457e9; /* g cm^2 / s^3 */\ngsl_const.CGS.BAR =  1e6; /* g / cm s^2 */\ngsl_const.CGS.STD_ATMOSPHERE =  1.01325e6; /* g / cm s^2 */\ngsl_const.CGS.TORR =  1.33322368421e3; /* g / cm s^2 */\ngsl_const.CGS.METER_OF_MERCURY =  1.33322368421e6; /* g / cm s^2 */\ngsl_const.CGS.INCH_OF_MERCURY =  3.38638815789e4; /* g / cm s^2 */\ngsl_const.CGS.INCH_OF_WATER =  2.490889e3; /* g / cm s^2 */\ngsl_const.CGS.PSI =  6.89475729317e4; /* g / cm s^2 */\ngsl_const.CGS.POISE =  1e0; /* g / cm s */\ngsl_const.CGS.STOKES =  1e0; /* cm^2 / s */\ngsl_const.CGS.STILB =  1e0; /* cd / cm^2 */\ngsl_const.CGS.LUMEN =  1e0; /* cd sr */\ngsl_const.CGS.LUX =  1e-4; /* cd sr / cm^2 */\ngsl_const.CGS.PHOT =  1e0; /* cd sr / cm^2 */\ngsl_const.CGS.FOOTCANDLE =  1.076e-3; /* cd sr / cm^2 */\ngsl_const.CGS.LAMBERT =  1e0; /* cd sr / cm^2 */\ngsl_const.CGS.FOOTLAMBERT =  1.07639104e-3; /* cd sr / cm^2 */\ngsl_const.CGS.CURIE =  3.7e10; /* 1 / s */\ngsl_const.CGS.ROENTGEN =  2.58e-7; /* A s / g */\ngsl_const.CGS.RAD =  1e2; /* cm^2 / s^2 */\ngsl_const.CGS.SOLAR_MASS =  1.98892e33; /* g */\ngsl_const.CGS.BOHR_RADIUS =  5.291772083e-9; /* cm */\ngsl_const.CGS.NEWTON =  1e5; /* cm g / s^2 */\ngsl_const.CGS.DYNE =  1e0; /* cm g / s^2 */\ngsl_const.CGS.JOULE =  1e7; /* g cm^2 / s^2 */\ngsl_const.CGS.ERG =  1e0; /* g cm^2 / s^2 */\ngsl_const.CGS.STEFAN_BOLTZMANN_CONSTANT =  5.67040047374e-5; /* g / K^4 s^3 */\ngsl_const.CGS.THOMSON_CROSS_SECTION =  6.65245893699e-25; /* cm^2 */\n\ngsl_const.CGSM = {};\ngsl_const.CGSM.SPEED_OF_LIGHT = 2.99792458e10 /* cm / s */\ngsl_const.CGSM.GRAVITATIONAL_CONSTANT = 6.673e-8 /* cm^3 / g s^2 */\ngsl_const.CGSM.PLANCKS_CONSTANT_H = 6.62606896e-27 /* g cm^2 / s */\ngsl_const.CGSM.PLANCKS_CONSTANT_HBAR = 1.05457162825e-27 /* g cm^2 / s */\ngsl_const.CGSM.ASTRONOMICAL_UNIT = 1.49597870691e13 /* cm */\ngsl_const.CGSM.LIGHT_YEAR = 9.46053620707e17 /* cm */\ngsl_const.CGSM.PARSEC = 3.08567758135e18 /* cm */\ngsl_const.CGSM.GRAV_ACCEL = 9.80665e2 /* cm / s^2 */\ngsl_const.CGSM.ELECTRON_VOLT = 1.602176487e-12 /* g cm^2 / s^2 */\ngsl_const.CGSM.MASS_ELECTRON = 9.10938188e-28 /* g */\ngsl_const.CGSM.MASS_MUON = 1.88353109e-25 /* g */\ngsl_const.CGSM.MASS_PROTON = 1.67262158e-24 /* g */\ngsl_const.CGSM.MASS_NEUTRON = 1.67492716e-24 /* g */\ngsl_const.CGSM.RYDBERG = 2.17987196968e-11 /* g cm^2 / s^2 */\ngsl_const.CGSM.BOLTZMANN = 1.3806504e-16 /* g cm^2 / K s^2 */\ngsl_const.CGSM.MOLAR_GAS = 8.314472e7 /* g cm^2 / K mol s^2 */\ngsl_const.CGSM.STANDARD_GAS_VOLUME = 2.2710981e4 /* cm^3 / mol */\ngsl_const.CGSM.MINUTE = 6e1 /* s */\ngsl_const.CGSM.HOUR = 3.6e3 /* s */\ngsl_const.CGSM.DAY = 8.64e4 /* s */\ngsl_const.CGSM.WEEK = 6.048e5 /* s */\ngsl_const.CGSM.INCH = 2.54e0 /* cm */\ngsl_const.CGSM.FOOT = 3.048e1 /* cm */\ngsl_const.CGSM.YARD = 9.144e1 /* cm */\ngsl_const.CGSM.MILE = 1.609344e5 /* cm */\ngsl_const.CGSM.NAUTICAL_MILE = 1.852e5 /* cm */\ngsl_const.CGSM.FATHOM = 1.8288e2 /* cm */\ngsl_const.CGSM.MIL = 2.54e-3 /* cm */\ngsl_const.CGSM.POINT = 3.52777777778e-2 /* cm */\ngsl_const.CGSM.TEXPOINT = 3.51459803515e-2 /* cm */\ngsl_const.CGSM.MICRON = 1e-4 /* cm */\ngsl_const.CGSM.ANGSTROM = 1e-8 /* cm */\ngsl_const.CGSM.HECTARE = 1e8 /* cm^2 */\ngsl_const.CGSM.ACRE = 4.04685642241e7 /* cm^2 */\ngsl_const.CGSM.BARN = 1e-24 /* cm^2 */\ngsl_const.CGSM.LITER = 1e3 /* cm^3 */\ngsl_const.CGSM.US_GALLON = 3.78541178402e3 /* cm^3 */\ngsl_const.CGSM.QUART = 9.46352946004e2 /* cm^3 */\ngsl_const.CGSM.PINT = 4.73176473002e2 /* cm^3 */\ngsl_const.CGSM.CUP = 2.36588236501e2 /* cm^3 */\ngsl_const.CGSM.FLUID_OUNCE = 2.95735295626e1 /* cm^3 */\ngsl_const.CGSM.TABLESPOON = 1.47867647813e1 /* cm^3 */\ngsl_const.CGSM.TEASPOON = 4.92892159375e0 /* cm^3 */\ngsl_const.CGSM.CANADIAN_GALLON = 4.54609e3 /* cm^3 */\ngsl_const.CGSM.UK_GALLON = 4.546092e3 /* cm^3 */\ngsl_const.CGSM.MILES_PER_HOUR = 4.4704e1 /* cm / s */\ngsl_const.CGSM.KILOMETERS_PER_HOUR = 2.77777777778e1 /* cm / s */\ngsl_const.CGSM.KNOT = 5.14444444444e1 /* cm / s */\ngsl_const.CGSM.POUND_MASS = 4.5359237e2 /* g */\ngsl_const.CGSM.OUNCE_MASS = 2.8349523125e1 /* g */\ngsl_const.CGSM.TON = 9.0718474e5 /* g */\ngsl_const.CGSM.METRIC_TON = 1e6 /* g */\ngsl_const.CGSM.UK_TON = 1.0160469088e6 /* g */\ngsl_const.CGSM.TROY_OUNCE = 3.1103475e1 /* g */\ngsl_const.CGSM.CARAT = 2e-1 /* g */\ngsl_const.CGSM.UNIFIED_ATOMIC_MASS = 1.660538782e-24 /* g */\ngsl_const.CGSM.GRAM_FORCE = 9.80665e2 /* cm g / s^2 */\ngsl_const.CGSM.POUND_FORCE = 4.44822161526e5 /* cm g / s^2 */\ngsl_const.CGSM.KILOPOUND_FORCE = 4.44822161526e8 /* cm g / s^2 */\ngsl_const.CGSM.POUNDAL = 1.38255e4 /* cm g / s^2 */\ngsl_const.CGSM.CALORIE = 4.1868e7 /* g cm^2 / s^2 */\ngsl_const.CGSM.BTU = 1.05505585262e10; /* g cm^2 / s^2 */\ngsl_const.CGSM.THERM = 1.05506e15 /* g cm^2 / s^2 */\ngsl_const.CGSM.HORSEPOWER = 7.457e9 /* g cm^2 / s^3 */\ngsl_const.CGSM.BAR = 1e6 /* g / cm s^2 */\ngsl_const.CGSM.STD_ATMOSPHERE = 1.01325e6 /* g / cm s^2 */\ngsl_const.CGSM.TORR = 1.33322368421e3 /* g / cm s^2 */\ngsl_const.CGSM.METER_OF_MERCURY = 1.33322368421e6 /* g / cm s^2 */\ngsl_const.CGSM.INCH_OF_MERCURY = 3.38638815789e4 /* g / cm s^2 */\ngsl_const.CGSM.INCH_OF_WATER = 2.490889e3 /* g / cm s^2 */\ngsl_const.CGSM.PSI = 6.89475729317e4 /* g / cm s^2 */\ngsl_const.CGSM.POISE = 1e0 /* g / cm s */\ngsl_const.CGSM.STOKES = 1e0 /* cm^2 / s */\ngsl_const.CGSM.STILB = 1e0 /* cd / cm^2 */\ngsl_const.CGSM.LUMEN = 1e0 /* cd sr */\ngsl_const.CGSM.LUX = 1e-4 /* cd sr / cm^2 */\ngsl_const.CGSM.PHOT = 1e0 /* cd sr / cm^2 */\ngsl_const.CGSM.FOOTCANDLE = 1.076e-3 /* cd sr / cm^2 */\ngsl_const.CGSM.LAMBERT = 1e0 /* cd sr / cm^2 */\ngsl_const.CGSM.FOOTLAMBERT = 1.07639104e-3 /* cd sr / cm^2 */\ngsl_const.CGSM.CURIE = 3.7e10; /* 1 / s */\ngsl_const.CGSM.ROENTGEN = 2.58e-8 /* abamp s / g */\ngsl_const.CGSM.RAD = 1e2 /* cm^2 / s^2 */\ngsl_const.CGSM.SOLAR_MASS = 1.98892e33 /* g */\ngsl_const.CGSM.BOHR_RADIUS = 5.291772083e-9 /* cm */\ngsl_const.CGSM.NEWTON = 1e5 /* cm g / s^2 */\ngsl_const.CGSM.DYNE = 1e0 /* cm g / s^2 */\ngsl_const.CGSM.JOULE = 1e7 /* g cm^2 / s^2 */\ngsl_const.CGSM.ERG = 1e0 /* g cm^2 / s^2 */\ngsl_const.CGSM.STEFAN_BOLTZMANN_CONSTANT = 5.67040047374e-5 /* g / K^4 s^3 */\ngsl_const.CGSM.THOMSON_CROSS_SECTION = 6.65245893699e-25 /* cm^2 */\ngsl_const.CGSM.BOHR_MAGNETON = 9.27400899e-21 /* abamp cm^2 */\ngsl_const.CGSM.NUCLEAR_MAGNETON = 5.05078317e-24 /* abamp cm^2 */\ngsl_const.CGSM.ELECTRON_MAGNETIC_MOMENT = 9.28476362e-21 /* abamp cm^2 */\ngsl_const.CGSM.PROTON_MAGNETIC_MOMENT = 1.410606633e-23 /* abamp cm^2 */\ngsl_const.CGSM.FARADAY = 9.64853429775e3 /* abamp s / mol */\ngsl_const.CGSM.ELECTRON_CHARGE = 1.602176487e-20 /* abamp s */\n\n\ngsl_const.MKS = {};\ngsl_const.MKS.SPEED_OF_LIGHT = 2.99792458e8 /* m / s */\ngsl_const.MKS.GRAVITATIONAL_CONSTANT = 6.673e-11 /* m^3 / kg s^2 */\ngsl_const.MKS.PLANCKS_CONSTANT_H = 6.62606896e-34 /* kg m^2 / s */\ngsl_const.MKS.PLANCKS_CONSTANT_HBAR = 1.05457162825e-34 /* kg m^2 / s */\ngsl_const.MKS.ASTRONOMICAL_UNIT = 1.49597870691e11 /* m */\ngsl_const.MKS.LIGHT_YEAR = 9.46053620707e15 /* m */\ngsl_const.MKS.PARSEC = 3.08567758135e16 /* m */\ngsl_const.MKS.GRAV_ACCEL = 9.80665e0 /* m / s^2 */\ngsl_const.MKS.ELECTRON_VOLT = 1.602176487e-19 /* kg m^2 / s^2 */\ngsl_const.MKS.MASS_ELECTRON = 9.10938188e-31 /* kg */\ngsl_const.MKS.MASS_MUON = 1.88353109e-28 /* kg */\ngsl_const.MKS.MASS_PROTON = 1.67262158e-27 /* kg */\ngsl_const.MKS.MASS_NEUTRON = 1.67492716e-27 /* kg */\ngsl_const.MKS.RYDBERG = 2.17987196968e-18 /* kg m^2 / s^2 */\ngsl_const.MKS.BOLTZMANN = 1.3806504e-23 /* kg m^2 / K s^2 */\ngsl_const.MKS.MOLAR_GAS = 8.314472e0 /* kg m^2 / K mol s^2 */\ngsl_const.MKS.STANDARD_GAS_VOLUME = 2.2710981e-2 /* m^3 / mol */\ngsl_const.MKS.MINUTE = 6e1 /* s */\ngsl_const.MKS.HOUR = 3.6e3 /* s */\ngsl_const.MKS.DAY = 8.64e4 /* s */\ngsl_const.MKS.WEEK = 6.048e5 /* s */\ngsl_const.MKS.INCH = 2.54e-2 /* m */\ngsl_const.MKS.FOOT = 3.048e-1 /* m */\ngsl_const.MKS.YARD = 9.144e-1 /* m */\ngsl_const.MKS.MILE = 1.609344e3 /* m */\ngsl_const.MKS.NAUTICAL_MILE = 1.852e3 /* m */\ngsl_const.MKS.FATHOM = 1.8288e0 /* m */\ngsl_const.MKS.MIL = 2.54e-5 /* m */\ngsl_const.MKS.POINT = 3.52777777778e-4 /* m */\ngsl_const.MKS.TEXPOINT = 3.51459803515e-4 /* m */\ngsl_const.MKS.MICRON = 1e-6 /* m */\ngsl_const.MKS.ANGSTROM = 1e-10 /* m */\ngsl_const.MKS.HECTARE = 1e4 /* m^2 */\ngsl_const.MKS.ACRE = 4.04685642241e3 /* m^2 */\ngsl_const.MKS.BARN = 1e-28 /* m^2 */\ngsl_const.MKS.LITER = 1e-3 /* m^3 */\ngsl_const.MKS.US_GALLON = 3.78541178402e-3 /* m^3 */\ngsl_const.MKS.QUART = 9.46352946004e-4 /* m^3 */\ngsl_const.MKS.PINT = 4.73176473002e-4 /* m^3 */\ngsl_const.MKS.CUP = 2.36588236501e-4 /* m^3 */\ngsl_const.MKS.FLUID_OUNCE = 2.95735295626e-5 /* m^3 */\ngsl_const.MKS.TABLESPOON = 1.47867647813e-5 /* m^3 */\ngsl_const.MKS.TEASPOON = 4.92892159375e-6 /* m^3 */\ngsl_const.MKS.CANADIAN_GALLON = 4.54609e-3 /* m^3 */\ngsl_const.MKS.UK_GALLON = 4.546092e-3 /* m^3 */\ngsl_const.MKS.MILES_PER_HOUR = 4.4704e-1 /* m / s */\ngsl_const.MKS.KILOMETERS_PER_HOUR = 2.77777777778e-1 /* m / s */\ngsl_const.MKS.KNOT = 5.14444444444e-1 /* m / s */\ngsl_const.MKS.POUND_MASS = 4.5359237e-1 /* kg */\ngsl_const.MKS.OUNCE_MASS = 2.8349523125e-2 /* kg */\ngsl_const.MKS.TON = 9.0718474e2 /* kg */\ngsl_const.MKS.METRIC_TON = 1e3 /* kg */\ngsl_const.MKS.UK_TON = 1.0160469088e3 /* kg */\ngsl_const.MKS.TROY_OUNCE = 3.1103475e-2 /* kg */\ngsl_const.MKS.CARAT = 2e-4 /* kg */\ngsl_const.MKS.UNIFIED_ATOMIC_MASS = 1.660538782e-27 /* kg */\ngsl_const.MKS.GRAM_FORCE = 9.80665e-3 /* kg m / s^2 */\ngsl_const.MKS.POUND_FORCE = 4.44822161526e0 /* kg m / s^2 */\ngsl_const.MKS.KILOPOUND_FORCE = 4.44822161526e3 /* kg m / s^2 */\ngsl_const.MKS.POUNDAL = 1.38255e-1 /* kg m / s^2 */\ngsl_const.MKS.CALORIE = 4.1868e0 /* kg m^2 / s^2 */\ngsl_const.MKS.BTU = 1.05505585262e3 /* kg m^2 / s^2 */\ngsl_const.MKS.THERM = 1.05506e8 /* kg m^2 / s^2 */\ngsl_const.MKS.HORSEPOWER = 7.457e2 /* kg m^2 / s^3 */\ngsl_const.MKS.BAR = 1e5 /* kg / m s^2 */\ngsl_const.MKS.STD_ATMOSPHERE = 1.01325e5 /* kg / m s^2 */\ngsl_const.MKS.TORR = 1.33322368421e2 /* kg / m s^2 */\ngsl_const.MKS.METER_OF_MERCURY = 1.33322368421e5 /* kg / m s^2 */\ngsl_const.MKS.INCH_OF_MERCURY = 3.38638815789e3 /* kg / m s^2 */\ngsl_const.MKS.INCH_OF_WATER = 2.490889e2 /* kg / m s^2 */\ngsl_const.MKS.PSI = 6.89475729317e3 /* kg / m s^2 */\ngsl_const.MKS.POISE = 1e-1 /* kg m^-1 s^-1 */\ngsl_const.MKS.STOKES = 1e-4 /* m^2 / s */\ngsl_const.MKS.STILB = 1e4 /* cd / m^2 */\ngsl_const.MKS.LUMEN = 1e0 /* cd sr */\ngsl_const.MKS.LUX = 1e0 /* cd sr / m^2 */\ngsl_const.MKS.PHOT = 1e4 /* cd sr / m^2 */\ngsl_const.MKS.FOOTCANDLE = 1.076e1 /* cd sr / m^2 */\ngsl_const.MKS.LAMBERT = 1e4 /* cd sr / m^2 */\ngsl_const.MKS.FOOTLAMBERT = 1.07639104e1 /* cd sr / m^2 */\ngsl_const.MKS.CURIE = 3.7e10 /* 1 / s */\ngsl_const.MKS.ROENTGEN = 2.58e-4 /* A s / kg */\ngsl_const.MKS.RAD = 1e-2 /* m^2 / s^2 */\ngsl_const.MKS.SOLAR_MASS = 1.98892e30 /* kg */\ngsl_const.MKS.BOHR_RADIUS = 5.291772083e-11 /* m */\ngsl_const.MKS.NEWTON = 1e0 /* kg m / s^2 */\ngsl_const.MKS.DYNE = 1e-5 /* kg m / s^2 */\ngsl_const.MKS.JOULE = 1e0 /* kg m^2 / s^2 */\ngsl_const.MKS.ERG = 1e-7 /* kg m^2 / s^2 */\ngsl_const.MKS.STEFAN_BOLTZMANN_CONSTANT = 5.67040047374e-8 /* kg / K^4 s^3 */\ngsl_const.MKS.THOMSON_CROSS_SECTION = 6.65245893699e-29 /* m^2 */\ngsl_const.MKS.BOHR_MAGNETON = 9.27400899e-24 /* A m^2 */\ngsl_const.MKS.NUCLEAR_MAGNETON = 5.05078317e-27 /* A m^2 */\ngsl_const.MKS.ELECTRON_MAGNETIC_MOMENT = 9.28476362e-24 /* A m^2 */\ngsl_const.MKS.PROTON_MAGNETIC_MOMENT = 1.410606633e-26 /* A m^2 */\ngsl_const.MKS.FARADAY = 9.64853429775e4 /* A s / mol */\ngsl_const.MKS.ELECTRON_CHARGE = 1.602176487e-19 /* A s */\ngsl_const.MKS.VACUUM_PERMITTIVITY = 8.854187817e-12 /* A^2 s^4 / kg m^3 */\ngsl_const.MKS.VACUUM_PERMEABILITY = 1.25663706144e-6 /* kg m / A^2 s^2 */\ngsl_const.MKS.DEBYE = 3.33564095198e-30 /* A s^2 / m^2 */\ngsl_const.MKS.GAUSS = 1e-4 /* kg / A s^2 */\n\ngsl_const.MKSA = {};\ngsl_const.MKSA.SPEED_OF_LIGHT = 2.99792458e8 /* m / s */\ngsl_const.MKSA.GRAVITATIONAL_CONSTANT = 6.673e-11 /* m^3 / kg s^2 */\ngsl_const.MKSA.PLANCKS_CONSTANT_H = 6.62606896e-34 /* kg m^2 / s */\ngsl_const.MKSA.PLANCKS_CONSTANT_HBAR = 1.05457162825e-34 /* kg m^2 / s */\ngsl_const.MKSA.ASTRONOMICAL_UNIT = 1.49597870691e11 /* m */\ngsl_const.MKSA.LIGHT_YEAR = 9.46053620707e15 /* m */\ngsl_const.MKSA.PARSEC = 3.08567758135e16 /* m */\ngsl_const.MKSA.GRAV_ACCEL = 9.80665e0 /* m / s^2 */\ngsl_const.MKSA.ELECTRON_VOLT = 1.602176487e-19 /* kg m^2 / s^2 */\ngsl_const.MKSA.MASS_ELECTRON = 9.10938188e-31 /* kg */\ngsl_const.MKSA.MASS_MUON = 1.88353109e-28 /* kg */\ngsl_const.MKSA.MASS_PROTON = 1.67262158e-27 /* kg */\ngsl_const.MKSA.MASS_NEUTRON = 1.67492716e-27 /* kg */\ngsl_const.MKSA.RYDBERG = 2.17987196968e-18 /* kg m^2 / s^2 */\ngsl_const.MKSA.BOLTZMANN = 1.3806504e-23 /* kg m^2 / K s^2 */\ngsl_const.MKSA.MOLAR_GAS = 8.314472e0 /* kg m^2 / K mol s^2 */\ngsl_const.MKSA.STANDARD_GAS_VOLUME = 2.2710981e-2 /* m^3 / mol */\ngsl_const.MKSA.MINUTE = 6e1 /* s */\ngsl_const.MKSA.HOUR = 3.6e3 /* s */\ngsl_const.MKSA.DAY = 8.64e4 /* s */\ngsl_const.MKSA.WEEK = 6.048e5 /* s */\ngsl_const.MKSA.INCH = 2.54e-2 /* m */\ngsl_const.MKSA.FOOT = 3.048e-1 /* m */\ngsl_const.MKSA.YARD = 9.144e-1 /* m */\ngsl_const.MKSA.MILE = 1.609344e3 /* m */\ngsl_const.MKSA.NAUTICAL_MILE = 1.852e3 /* m */\ngsl_const.MKSA.FATHOM = 1.8288e0 /* m */\ngsl_const.MKSA.MIL = 2.54e-5 /* m */\ngsl_const.MKSA.POINT = 3.52777777778e-4 /* m */\ngsl_const.MKSA.TEXPOINT = 3.51459803515e-4 /* m */\ngsl_const.MKSA.MICRON = 1e-6 /* m */\ngsl_const.MKSA.ANGSTROM = 1e-10 /* m */\ngsl_const.MKSA.HECTARE = 1e4 /* m^2 */\ngsl_const.MKSA.ACRE = 4.04685642241e3 /* m^2 */\ngsl_const.MKSA.BARN = 1e-28 /* m^2 */\ngsl_const.MKSA.LITER = 1e-3 /* m^3 */\ngsl_const.MKSA.US_GALLON = 3.78541178402e-3 /* m^3 */\ngsl_const.MKSA.QUART = 9.46352946004e-4 /* m^3 */\ngsl_const.MKSA.PINT = 4.73176473002e-4 /* m^3 */\ngsl_const.MKSA.CUP = 2.36588236501e-4 /* m^3 */\ngsl_const.MKSA.FLUID_OUNCE = 2.95735295626e-5 /* m^3 */\ngsl_const.MKSA.TABLESPOON = 1.47867647813e-5 /* m^3 */\ngsl_const.MKSA.TEASPOON = 4.92892159375e-6 /* m^3 */\ngsl_const.MKSA.CANADIAN_GALLON = 4.54609e-3 /* m^3 */\ngsl_const.MKSA.UK_GALLON = 4.546092e-3 /* m^3 */\ngsl_const.MKSA.MILES_PER_HOUR = 4.4704e-1 /* m / s */\ngsl_const.MKSA.KILOMETERS_PER_HOUR = 2.77777777778e-1 /* m / s */\ngsl_const.MKSA.KNOT = 5.14444444444e-1 /* m / s */\ngsl_const.MKSA.POUND_MASS = 4.5359237e-1 /* kg */\ngsl_const.MKSA.OUNCE_MASS = 2.8349523125e-2 /* kg */\ngsl_const.MKSA.TON = 9.0718474e2 /* kg */\ngsl_const.MKSA.METRIC_TON = 1e3 /* kg */\ngsl_const.MKSA.UK_TON = 1.0160469088e3 /* kg */\ngsl_const.MKSA.TROY_OUNCE = 3.1103475e-2 /* kg */\ngsl_const.MKSA.CARAT = 2e-4 /* kg */\ngsl_const.MKSA.UNIFIED_ATOMIC_MASS = 1.660538782e-27 /* kg */\ngsl_const.MKSA.GRAM_FORCE = 9.80665e-3 /* kg m / s^2 */\ngsl_const.MKSA.POUND_FORCE = 4.44822161526e0 /* kg m / s^2 */\ngsl_const.MKSA.KILOPOUND_FORCE = 4.44822161526e3 /* kg m / s^2 */\ngsl_const.MKSA.POUNDAL = 1.38255e-1 /* kg m / s^2 */\ngsl_const.MKSA.CALORIE = 4.1868e0 /* kg m^2 / s^2 */\ngsl_const.MKSA.BTU = 1.05505585262e3 /* kg m^2 / s^2 */\ngsl_const.MKSA.THERM = 1.05506e8 /* kg m^2 / s^2 */\ngsl_const.MKSA.HORSEPOWER = 7.457e2 /* kg m^2 / s^3 */\ngsl_const.MKSA.BAR = 1e5 /* kg / m s^2 */\ngsl_const.MKSA.STD_ATMOSPHERE = 1.01325e5 /* kg / m s^2 */\ngsl_const.MKSA.TORR = 1.33322368421e2 /* kg / m s^2 */\ngsl_const.MKSA.METER_OF_MERCURY = 1.33322368421e5 /* kg / m s^2 */\ngsl_const.MKSA.INCH_OF_MERCURY = 3.38638815789e3 /* kg / m s^2 */\ngsl_const.MKSA.INCH_OF_WATER = 2.490889e2 /* kg / m s^2 */\ngsl_const.MKSA.PSI = 6.89475729317e3 /* kg / m s^2 */\ngsl_const.MKSA.POISE = 1e-1 /* kg m^-1 s^-1 */\ngsl_const.MKSA.STOKES = 1e-4 /* m^2 / s */\ngsl_const.MKSA.STILB = 1e4 /* cd / m^2 */\ngsl_const.MKSA.LUMEN = 1e0 /* cd sr */\ngsl_const.MKSA.LUX = 1e0 /* cd sr / m^2 */\ngsl_const.MKSA.PHOT = 1e4 /* cd sr / m^2 */\ngsl_const.MKSA.FOOTCANDLE = 1.076e1 /* cd sr / m^2 */\ngsl_const.MKSA.LAMBERT = 1e4 /* cd sr / m^2 */\ngsl_const.MKSA.FOOTLAMBERT = 1.07639104e1 /* cd sr / m^2 */\ngsl_const.MKSA.CURIE = 3.7e10 /* 1 / s */\ngsl_const.MKSA.ROENTGEN = 2.58e-4 /* A s / kg */\ngsl_const.MKSA.RAD = 1e-2 /* m^2 / s^2 */\ngsl_const.MKSA.SOLAR_MASS = 1.98892e30 /* kg */\ngsl_const.MKSA.BOHR_RADIUS = 5.291772083e-11 /* m */\ngsl_const.MKSA.NEWTON = 1e0 /* kg m / s^2 */\ngsl_const.MKSA.DYNE = 1e-5 /* kg m / s^2 */\ngsl_const.MKSA.JOULE = 1e0 /* kg m^2 / s^2 */\ngsl_const.MKSA.ERG = 1e-7 /* kg m^2 / s^2 */\ngsl_const.MKSA.STEFAN_BOLTZMANN_CONSTANT = 5.67040047374e-8 /* kg / K^4 s^3 */\ngsl_const.MKSA.THOMSON_CROSS_SECTION = 6.65245893699e-29 /* m^2 */\ngsl_const.MKSA.BOHR_MAGNETON = 9.27400899e-24 /* A m^2 */\ngsl_const.MKSA.NUCLEAR_MAGNETON = 5.05078317e-27 /* A m^2 */\ngsl_const.MKSA.ELECTRON_MAGNETIC_MOMENT = 9.28476362e-24 /* A m^2 */\ngsl_const.MKSA.PROTON_MAGNETIC_MOMENT = 1.410606633e-26 /* A m^2 */\ngsl_const.MKSA.FARADAY = 9.64853429775e4 /* A s / mol */\ngsl_const.MKSA.ELECTRON_CHARGE = 1.602176487e-19 /* A s */\ngsl_const.MKSA.VACUUM_PERMITTIVITY = 8.854187817e-12 /* A^2 s^4 / kg m^3 */\ngsl_const.MKSA.VACUUM_PERMEABILITY = 1.25663706144e-6 /* kg m / A^2 s^2 */\ngsl_const.MKSA.DEBYE = 3.33564095198e-30 /* A s^2 / m^2 */\ngsl_const.MKSA.GAUSS = 1e-4 /* kg / A s^2 */\n\ngsl_const.NUM = {};\ngsl_const.NUM.FINE_STRUCTURE = 7.297352533e-3 /* 1 */\ngsl_const.NUM.AVOGADRO = 6.02214199e23 /* 1 / mol */\ngsl_const.NUM.YOTTA = 1e24 /* 1 */\ngsl_const.NUM.ZETTA = 1e21 /* 1 */\ngsl_const.NUM.EXA = 1e18 /* 1 */\ngsl_const.NUM.PETA = 1e15 /* 1 */\ngsl_const.NUM.TERA = 1e12 /* 1 */\ngsl_const.NUM.GIGA = 1e9 /* 1 */\ngsl_const.NUM.MEGA = 1e6 /* 1 */\ngsl_const.NUM.KILO = 1e3 /* 1 */\ngsl_const.NUM.MILLI = 1e-3 /* 1 */\ngsl_const.NUM.MICRO = 1e-6 /* 1 */\ngsl_const.NUM.NANO = 1e-9 /* 1 */\ngsl_const.NUM.PICO = 1e-12 /* 1 */\ngsl_const.NUM.FEMTO = 1e-15 /* 1 */\ngsl_const.NUM.ATTO = 1e-18 /* 1 */\ngsl_const.NUM.ZEPTO = 1e-21 /* 1 */\ngsl_const.NUM.YOCTO = 1e-24 /* 1 */\n\nmodule.exports = gsl_const;\n","/**\n * Simple time-stepping - frame, real-time, constant-step - via any API.\n */\n\nexport const steps = {\n    diff: '-', dt: '-', '⏳': '-',\n    pause: 0, '⏸': 0,\n    add: '+', '⏭': '+'\n};\n\nexport const stepDef = steps.diff;\nexport const startDef = 0;\nexport const nowDef = { [steps.diff]: Date.now, [steps.add]: 1e3/60 };\n\n/**\n * Sets up properties needed to track time, starts/steps time in various ways:\n * - Time-difference or time-advance stepping.\n * - Step forwards or backwards in time or pause it.\n * - Current time can be a number or function; or the object's fixed time-step.\n * - Override property, pass the result to new objects.\n *\n * @example\n *     // Initial call sets up properties.\n *     const diff0 = timer({ step: '-' }, 200);\n *     // => { step: '-', time: 200, dt: 200 };\n *     const add0 = timer({ step: 200 });\n *     // => { step: 200, time: 200, dt: 200 };\n *\n *     // Subsequent calls advance time and track difference.\n *\n *     // No time difference here.\n *     timer(diff0, 200); // => { step: '-', time: 200, dt: 0 };\n *     timer(add0, 0); // => { step: 200, time: 200, dt: 0 };\n *\n *     // Time-difference here with a change or step, into a new result target.\n *     const diff1 = timer(diff0, 300, {});\n *     // => { step: '-', time: 300, dt: 100 };\n *     const add1 = timer(add0, null, {});\n *     // => { step: 200, time: 400, dt: 200 };\n *\n *     diff1.time-diff0.time === diff1.dt; // => true;\n *     add1.time-add0.time === add1.dt; // => true;\n *\n * @param {object} state The state being tracked.\n * @param {number} [state.time=startDef] The initial time.\n * @param {string|number} [state.step=stepDef] How time advances:\n *     - Difference since last `time`: `'diff'`/`'dt'`/`'-'`/`'⏳'`.\n *     - Pause: `'pause'`/`'⏸'`, or number zero (`0`).\n *     - Add `time` step: `'add'`/`'+'`/`'⏭'`, or non-zero number (step size).\n * @param {number|function} [now] The time now (clock/frame/step/etc), or a\n *     function giving it; if not given, uses `state.step` if numeric or\n *     `nowDef[state.step]` otherwise.\n * @param {object|false} [out=state] The state to set up; modifies `state` if\n *     not given.\n *\n * @returns {object|number} The given `out` set up with its initial `time`; or\n *     if `out` is falsey, returns the relevant calculated unknown value:\n *     - The difference since last `time` for `diff` step.\n *     - The updated `time` for `add` or `pause` step.\n */\nexport function timer(state, now, out = state) {\n    // Get the initial time and step-step.\n    const { time: t0 = startDef, step = stepDef, now: n } = state;\n    // Get the step mode - from a key into `steps` or a numerical value.\n    const s = (steps[step] ?? step);\n    const diff = (s === steps.diff);\n    const t = (now ?? n ?? nowDef[s] ?? s);\n\n    // Step by `s`:\n    // - `0` or falsey to `pause`\n    // - `steps.diff` for difference since last `time`\n    // - `steps.add` or a number to add a `time` step\n    const t1 = ((!s)? t0 : ((diff)? 0 : t0)+((isNaN(t))? t() : t));\n    const dt = t1-t0;\n\n    // If only returning a value, return the relevant calculated unknown.\n    if(!out) { return ((diff)? dt : t1); }\n\n    out.time = t1;\n    out.dt = dt;\n    out.step = step;\n\n    return out;\n}\n\nexport default timer;\n","const r = Array.prototype.reduce;\n\n/**\n * Reduce an array-like list.\n * Similar to native, but with iteratee-first arguments.\n * Supports the native single-argument behaviour.\n *\n * @see Array.prototype.reduce\n *\n * @param {function} f Iteratee function, called as `Array`'s `reduce` does.\n * @param {array|*} a List to reduce over, array or array-like.\n * @param {*} [to] The initial accumulator, if any; handled like `Array`'s\n *     `reduce` does, given or not.\n *\n * @returns {*} The result of running the reducer iteratee function over all\n *     elements of the list.\n */\nexport const reduce = (f, a, to) =>\n    // Needs separate `call` because native detects even `undefined` parameter.\n    ((to === undefined)? r.call(a, f) : r.call(a, f, to));\n\nexport default reduce;\n","import { reduce } from './reduce';\n\n/**\n * Map an array-like list.\n * Similar to native, but with iteratee-first arguments; and allows the object\n * into which properties will be mapped to be defined (a new array, by default),\n * avoiding always creating new arrays.\n *\n * @see Array.prototype.map\n * @see [reduce]{@link ./reduce.js}\n *\n * @param {function} f The iteratee function, given standard `Array.map`\n *     arguments, and any given `to`.\n * @param {array|*} a The list to map over, array or array-like.\n * @param {false|*} [to=[]] The initial accumulator, if given; `a` if falsey; or\n *     a new array if not given.\n *\n * @returns {*} The result of mapping `to` through the iteratee function over\n *     the `a` list.\n */\nexport const map = (f, a, to = []) => reduce((to, v, i) => {\n        to[i] = f(v, i, a, to);\n\n        return to;\n    },\n    a, (to || a));\n\nexport default map;\n","const e = Array.prototype.forEach;\n\n/**\n * Iterates a function over every element of a list, returning the list.\n *\n * @see Array.prototype.forEach\n *\n * @param {function} f The iteratee function.\n * @param {array|*} a List to iterate over, array or array-like.\n *\n * @returns {array|*} The given list.\n */\nexport const each = (f, a) => {\n    e.call(a, f);\n\n    return a;\n}\n\nexport default each;\n","const { fill } = Array.prototype;\nconst { isFinite } = Number;\nconst { floor } = Math;\n\n/**\n * Fills list with the given items filled via `Array`'s `fill`.\n *\n * @see Array.constructor\n * @see Array.prototype.fill\n * @see Number.isFinite\n *\n * @param {number|array|*} [l=0] How many items to create, or existing list.\n * @param {*} [value] A value to fill the array with; for `Array`'s `fill`.\n * @param {number} [start] Start index, inclusive; for `Array`'s `fill`.\n * @param {number} [end] End index, exclusive; for `Array`'s `fill`.\n *\n * @returns {array|*} List with items filled as given.\n */\nexport const range = (l = 0, value, start, end) =>\n    fill.call(((isFinite(l))? Array(floor(l)) : l), value, start, end);\n\nexport default range;\n","/**\n * Wraps an index over a given length, so that indexes greater than the length\n * loop back past `0`, and indexes less than `0` loop backward from the length.\n * Similar to the indexing behaviour of `Array`'s `slice`.\n * Indexing is the equivalent of a true _modulo_ operator, where JavaScript's\n * `%` operator is actually a _remainder_ operator.\n *\n * @see Array.prototpye.slice\n * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Remainder\n *\n * @param {number} i Index to wrap.\n * @param {number} l Length to wrap the index over.\n *\n * @returns {number} The index wrapped over the length.\n */\nexport const wrapIndex = (i, l) => ((i%l)+l)%l;\n\nexport default wrapIndex;\n","import wrapIndex from './wrap-index';\n\n/**\n * Gives an index wrapped over a given length, or the entry at the wrapped\n * index in a given list; wrapped backwards, forwards, never exceeding bounds.\n *\n * @see [wrapIndex]{@link ./wrap-index.js}\n *\n * @param {number} i The index to wrap.\n * @param {number|array|*} l List to index, array or array-like; or numeric\n *     length for a numeric `wrapIndex` result instead.\n * @param {number} [end=l.length] Length to wrap the index over; allows wrapping\n *     over a sub-range of a list; if not given, tries the list's length.\n *\n * @returns {number|*} The index wrapped over the given length by `wrapIndex`;\n *     or the list entry at the wrapped index, if given a list.\n */\nexport const wrap = (i, l, end = l.length) =>\n    ((end || (end === 0))? l[wrapIndex(i, end)] : wrapIndex(i, l));\n\nexport default wrap;\n","/**\n * The 3 vertices of a 2D triangle covering the viewport in NDC coordinates ([-1, 1]).\n *\n * @export\n * @type {array.<array.<number>>}\n */\nexport const vertices = [[-1, -1], [-1, 4], [4, -1]];\n\nexport const count = vertices.length;\nexport const dim = 2;\n\n/**\n * The flat array of the above triangle, to be bound as a WebGL attribute buffer for\n * rendering the triangle in the vertex shader.\n * These positions will result in clipped NDC coordinates ([-1, 1]) over the\n * viewport's width and height.\n *\n * @export\n * @type {array.<number>}\n */\nexport const positions = vertices.flat();\n\nexport default positions;\n","/**\n * Default properties for `gpgpu` and `GL` capabilities and resources.\n *\n * @module\n * @category JS\n */\nimport { positions, count } from '@epok.tech/gl-screen-triangle';\n\nimport vertGLSL from './index.vert.glsl';\n\n/** Default vertex shader `GLSL` code. */\nexport const vertDef = vertGLSL;\n\n/**\n * Default vertex positions `attribute`; 3 points of a large flat triangle.\n *\n * @see {@link step.toStep}\n */\nexport const positionsDef = positions;\n\n/**\n * Default vertex `count`; 3 points of a large flat triangle.\n *\n * @see {@link step.toStep}\n */\nexport const countDef = count;\n\n// The required and optional `GL` extensions for a `gpgpu` state.\n\n/** Default required `GL` extensions; none. */\nexport const extensions = [];\n\n/** Default required `GL` extensions to render to `float` buffers. */\nexport const extensionsFloat =\n  ['oes_texture_float', 'webgl_color_buffer_float'];\n\n/** Default required `GL` extensions to render to `half float` buffers. */\nexport const extensionsHalfFloat =\n  ['oes_texture_half_float', 'ext_color_buffer_half_float'];\n\n/** Default optional `GL` extensions; update more data in one render pass. */\nexport const optionalExtensions = ['webgl_draw_buffers'];\n\n/**\n * Prefix namespace to avoid naming clashes; recommended.\n *\n * @see {@link index.vert.glsl}\n */\nexport const preDef = 'gpgpu_';\n\n/**\n * Default minimum allowable channels for `framebuffer` attachments.\n * This avoids `RGB32F` `framebuffer` attachments, which errors on Firefox.\n *\n * @see {@link state.framebuffer}\n * @see [Firefox `RGB32F` bug](https://bugzilla.mozilla.org/show_bug.cgi?id=1448632)\n */\nexport const channelsMinDef = 4;\n\n/**\n * Default maximum allowable channels for `framebuffer` attachments.\n * This avoids `RGB32F` `framebuffer` attachments, which errors on Firefox.\n *\n * @see {@link state.framebuffer}\n * @see [Firefox `RGB32F` bug](https://bugzilla.mozilla.org/show_bug.cgi?id=1448632)\n */\nexport const channelsMaxDef = 4;\n\n/**\n * Default maximum `texture`s that may be bound as buffer outputs per-pass.\n *\n * @see {@link state.framebuffer}\n * @see {@link state.texture}\n */\nexport const buffersMaxDef = 1;\n\n/**\n * Default how many steps are bound as outputs, unavailable as input; for\n * platforms forbidding read/write of same buffer.\n */\nexport const boundDef = 1;\n\n/**\n * Default length of the data `texture`s sides to allocate; gives a square\n * power-of-two `texture` raising 2 to this power.\n */\nexport const scaleDef = 9;\n\n/**\n * Default width of the data `texture`s sides to allocate; gives a square\n * power-of-two `texture` raising 2 to the default scale.\n *\n * @see {@link state.framebuffer}\n * @see {@link state.texture}\n */\nexport const widthDef = 2**scaleDef;\n\n/**\n * Default height of the data `texture`s sides to allocate; gives a square\n * power-of-two `texture` raising 2 to the default scale.\n *\n * @see {@link state.framebuffer}\n * @see {@link state.texture}\n */\nexport const heightDef = 2**scaleDef;\n\n/** Default number steps of state to track. */\nexport const stepsDef = 2;\n/** Default values to track; gives 1 set of `texture` channels. */\nexport const valuesDef = [channelsMaxDef];\n\n// `GL` resource format defaults.\n\n/**\n * Default `texture` data type.\n *\n * @see {@link state.texture}\n */\nexport const typeDef = 'float';\n\n/**\n * Default `texture` minification filter.\n *\n * @see {@link state.texture}\n */\nexport const minDef = 'nearest';\n\n/**\n * Default `texture` magnification filter.\n *\n * @see {@link state.texture}\n */\nexport const magDef = 'nearest';\n\n/**\n * Default `texture` wrap mode, avoid `WebGL1` needing power-of-2 `texture`.\n *\n * @see {@link state.texture}\n */\nexport const wrapDef = 'clamp';\n\n/**\n * Default `framebuffer` depth attachment.\n *\n * @see {@link state.framebuffer}\n */\nexport const depthDef = false;\n\n/**\n * Default `framebuffer` stencil attachment.\n *\n * @see {@link state.framebuffer}\n */\nexport const stencilDef = false;\n\n/**\n * A `RegExp` to find the `GLSL` version `number` in a `GL` parameter\n * `SHADING_LANGUAGE_VERSION` formatted `string`.\n */\nexport const glslRx = /[0-9\\.]+/;\n\n/**\n * Set a maximum to guard against number overflow.\n *\n * @todo Should be `(2**15)-1` for `mediump`, but seems to fail above `2**13`.\n * @see [SO](https://stackoverflow.com/a/67791670/716898)\n */\nexport const stepMaxDef = 2**13;\n\n/**\n * Default clear settings to clear each pass's `framebuffer`.\n *\n * @see {@link step.toStep}\n * @see {@link api.clear}\n * @see {@link api.framebuffer}\n *\n * @type {{color:[0,0,0,0],depth:1,stencil:0,framebuffer?:framebuffer}}\n * @prop {framebuffer} [framebuffer] Any `framebuffer` to clear, set upon each\n *   pass.\n */\nexport const clearPassDef = { color: [0, 0, 0, 0], depth: 1, stencil: 0 };\n\n/**\n * Default `getFramebuffer` options, to bind a given `color` to it.\n *\n * @see {@link step.updateMerge}\n * @see {@link api.framebuffer}\n * @see {@link api.getFramebuffer}\n *\n * @prop {texture|null} color Any `texture` to bind as a `framebuffer` output.\n */\nexport const copyFrameDef = { color: null };\n\n/**\n * Default `texture.subimage` options, to bind a given `color`.\n *\n * @see {@link step.updateMerge}\n * @see {@link api.texture}\n * @see {@link api.subimage}\n *\n * @prop {true} copy Indicates `texture.subimage` should copy data from the\n *   currently-bound `framebuffer`.\n */\nexport const copyImageDef = { copy: true };\n","/**\n * Default `gpgpu` vertex shader.\n *\n * @see [@epok.tech/gl-screen-triangle/uv-texture.vert.glsl](https://github.com/keeffEoghan/gl-screen-triangle/tree/master/uv-texture.vert.glsl)\n */\n\nprecision highp float;\n\n/**\n * Uses the default prefix namespace; replaced with any given prefix if this\n * shader's used during `toStep`.\n *\n * @see {@link const.preDef}\n * @see {@link step.toStep}\n */\nattribute vec2 gpgpu_position;\n\nvarying vec2 uv;\n\nvoid main() {\n  // Texture coordinates, range `[0, 1]`, y-axis points upwards.\n  uv = (gpgpu_position*0.5)+0.5;\n  gl_Position = vec4(gpgpu_position, 0, 1);\n}\n","/**\n * The `gpgpu` maps of data for optimal inputs/outputs on a platform.\n *\n * These maps show how to make optimal use of a platform's supported features,\n * how to pack/unpack their data from `framebuffer`s/`texture`s, perform minimal\n * needed samples to retrieve any past values they must derive from, etc.\n *\n * Shaders may declare values they output, values they derive from, groupings of\n * in/dependent values - without handling how these concerns map to the\n * particular platform resources they're using.\n *\n * Platform limits/features/extensions are accounted for, to produce the most\n * efficient mappings available with the least I/O when it comes to drawing\n * (draw passes, `texture` samples, etc).\n *\n * @module\n * @category JS\n *\n * @todo Allow passes within/across `texture`s; separate data/`texture` shapes.\n */\n\nimport map from '@epok.tech/fn-lists/map';\nimport reduce from '@epok.tech/fn-lists/reduce';\nimport each from '@epok.tech/fn-lists/each';\n\nimport { valuesDef, channelsMaxDef, buffersMaxDef } from './const';\n\nconst { isInteger } = Number;\nconst { isArray } = Array;\n\n/**\n * Determines whether a given value is valid and can be stored within the\n * channels available.\n *\n * @param {number} value A value to validate.\n * @param {number} [channelsMax] The maximum channels available to store values.\n *\n * @returns {boolean} Whether the given `value` is valid.\n */\nexport const validValue = (value, channelsMax = channelsMaxDef) =>\n  ((1 <= value) || (value <= channelsMax) ||\n    !!console.error(`\\`gl-gpgpu\\`: the given value (${value}) exceeds the `+\n      `range of channels available, \\`[1, ${channelsMax}]\\` inclusive.`,\n      value, channelsMax));\n\n/**\n * Whether to use buffers to output state `values` in passes per-step, or no\n * output buffers in one pass as a side-effect not updating state `values`.\n *\n * @param {number|false} buffersMax Maximum `texture`s that may be bound as\n *   buffer outputs per-pass.\n *\n * @returns {boolean} Whether to use output buffers in passes, or no output\n *   buffers in one pass.\n */\nexport const useBuffers = (buffersMax) =>\n  isInteger(buffersMax) && (0 < buffersMax) && (buffersMax < Infinity);\n\n/**\n * Minimise resource usage, order `values` to pack into blocks of `channelsMax`;\n * interpreted as indexes into the given `values`.\n *\n * @see {@link mapGroups}\n *\n * @example ```\n *   packValues([1, 2, 3], 4, []); // =>\n *   [2, 0, 1];\n *\n *   packValues([3, 2, 1], 4, []); // =>\n *   [0, 2, 1];\n *\n *   packValues([4, 3, 2], 4, []); // =>\n *   [0, 1, 2];\n *\n *   packValues([1, 1, 4, 2], 4, []); // =>\n *   [2, 3, 0, 1];\n * ```\n *\n * @param {array.<number>} values Each entry is how many interdependent channels\n *   are grouped into one texture in one pass, separate entries may be across\n *   one or more textures/passes. See `mapGroups`.\n * @param {number} [channelsMax=channelsMaxDef] The maximum number of channels\n *   per texture. See `mapGroups`.\n * @param {array} [to=[]] An `array` to store the result; a new `array` if not\n *   given.\n *\n * @returns {array.<number>} `to` The indexes of the given `values`, reordered\n *   to pack into the fewest buckets of `channelsMax` size or less; stored in\n *   the given `to` array.\n */\nexport function packValues(values, channelsMax = channelsMaxDef, to = []) {\n  // Fill `to` with indexes of `values`, and ensure it's the same length.\n  map((_, i) => i, values, to).length = values.length;\n\n  /** Counts the number of empty channels in the current group. */\n  let channels = channelsMax;\n  /** How many values have already been packed. */\n  let packed = 0;\n  /** Tracks the value that best fits the free channels (fills it tightest). */\n  let fitIndex = 0;\n  let fitSize = Infinity;\n\n  for(let i = 0; packed < values.length;) {\n    const v = packed+i;\n    const value = values[to[v]];\n\n    if(!validValue(value, channelsMax)) { return to; }\n\n    // Check how value fits the channels - valid is >= 0, perfect is 0.\n    const fit = channels-value;\n\n    if((fit >= 0) && (fit < fitSize)) {\n      fitSize = fit;\n      fitIndex = v;\n    }\n\n    // Not a perfect fit and can keep searching for better fits - continue.\n    if((fitSize !== 0) && (v < values.length-1)) { ++i; }\n    else {\n      // Got a perfect fit or the search ended - swap in best fit value.\n      const pack = to[fitIndex];\n\n      to[fitIndex] = to[packed];\n      to[packed] = pack;\n\n      // Reduce the free channels by the best value, reset if needed.\n      ((channels -= values[pack]) > 0) || (channels = channelsMax);\n      // Start the search again over the remaining unpacked entries.\n      fitIndex = ++packed;\n      fitSize = Infinity;\n      i = 0;\n    }\n  }\n\n  return to;\n}\n\n/**\n * Groups the `values` of `gpgpu` data across draw passes and data textures.\n *\n * @see {@link packValues}\n * @see {@link data.toData}\n *\n * @example ```\n *   const x = 2;\n *   const y = 4;\n *   const z = 1;\n *   const maps = { values: [x, y, z], channelsMax: 4 };\n *\n *   // No optimisations - values not packed, single texture output per pass.\n *   mapGroups({ ...maps, buffersMax: 1, packed: false }); // =>\n *   {\n *     ...maps, packed: false,\n *     textures: [[0], [1], [2]], // length === 3\n *     passes: [[0], [1], [2]], // length === 3\n *     valueToTexture: [0, 1, 2], valueToPass: [0, 1, 2],\n *     textureToPass: [0, 1, 2]\n *   };\n *\n *   // Automatically packed values - values across fewer textures/passes.\n *   mapGroups({ ...maps, buffersMax: 1 }); // =>\n *   {\n *     ...maps, packed: [1, 0, 2],\n *     textures: [[1], [0, 2]], // length === 2\n *     passes: [[0], [1]], // length === 2\n *     valueToTexture: [1, 0, 1], valueToPass: [1, 0, 1],\n *     textureToPass: [0, 1]\n *   };\n *\n *   // Can bind more texture outputs per pass - values across fewer passes.\n *   mapGroups({ ...maps, buffersMax: 4 }); // =>\n *   {\n *     ...maps, packed: [1, 0, 2],\n *     textures: [[1], [0, 2]], // length === 2\n *     passes: [[0, 1]], // length === 1\n *     valueToTexture: [1, 0, 1], valueToPass: [0, 0, 0],\n *     textureToPass: [0, 0]\n *   };\n *\n *   // Custom packed values - fuller control.\n *   mapGroups({ ...maps, buffersMax: 4, packed: [0, 2, 1] }); // =>\n *   {\n *     ...maps, packed: [0, 2, 1],\n *     textures: [[0, 2], [1]], // length === 2\n *     passes: [[0, 1]], // length === 1\n *     valueToTexture: [0, 1, 0], valueToPass: [0, 0, 0],\n *     textureToPass: [0, 0]\n *   };\n *\n *   // Merge dependent values - fuller control, but no map for merged values.\n *   mapGroups({ ...maps, values: [x+z, y], buffersMax: 4 }); // =>\n *   {\n *     ...maps, packed: [1, 0],\n *     textures: [[1], [0]], // length === 2\n *     passes: [[0, 1]], // length === 1\n *     valueToTexture: [1, 0], valueToPass: [0, 0],\n *     textureToPass: [0, 0]\n *   };\n * ```\n *\n * @param {object} [maps=\\{\\}] Initial maps settings; new `object` if not given.\n *\n * @param {array.<number>} [maps.values=valuesDef()] An `array` where each\n *   `number` denotes how many value channels are grouped into one data-texture\n *   in one draw pass (where any value map logic isn't handled here); each\n *   separate number may be computed across one or more data-textures/passes.\n *\n *   Each value denotes the number of dependent channels to compute together;\n *   separate values denote channels that are independent, and may be drawn in\n *   the same or separate passes, depending on settings/support.\n *\n *   The order may affect the number of textures/passes needed; can maintain\n *   order as-is, or use a more efficient `packed` order. See `packValues`.\n *\n * @param {number} [maps.channelsMax=channelsMaxDef] Maximum channels\n *   per-`texture`.\n * @param {number|false} [maps.buffersMax=buffersMaxDef] Maximum `texture`s that\n *   may be bound as buffer outputs per-pass. Maps multiple passes per-step to\n *   output all `values` if they're spread across more `textures` than this\n *   `number`. Uses one pass and binds no output if given `false`y; useful for\n *   side-effects with no state outputs, like rendering. See `toData`.\n * @param {array.<number>} [maps.packed] An `array` of indexes into `values`\n *   packed into an order that best fits into blocks of `channelsMax` to\n *   minimise resources; or `false`y to use `values` in their given order; uses\n *   `packValues` if not given.\n * @param {object} [to=maps] An `object` to contain the results; modifies `maps`\n *   if not given.\n *\n * @returns {object} `to` The given `to` `object`; how `values` are grouped\n *   per-texture per-pass per-step, meta information, and given parameters.\n * @returns {array.<array.<number>>} `to.passes` Textures grouped into passes,\n *   as `arrays` corresponding to `framebuffer`s in separate draw passes; whose\n *   values are indexes into `to.textures`.\n * @returns {array.<array.<number>>} `to.textures` Values grouped into\n *   textures, as `array`s corresponding to `framebuffer` attachments, into\n *   which `values` are drawn; whose values are indexes into `to.values`.\n * @returns {array.<number>} `to.values` The `values`, as given.\n * @returns {number} `to.buffersMax` Maximum `texture`s that may be bound as\n *   buffer outputs per-pass, as given.\n * @returns {number} `to.channelsMax` Maximum channels per-`texture`, as given.\n * @returns {array.<number>} `to.valueToTexture` Inverse map from each index of\n *   `to.values` to the index of the data-texture containing it.\n * @returns {array.<number>} `to.valueToPass` Inverse map from each index of\n *   `to.values` to the index of the pass containing it.\n * @returns {array.<number>} `to.textureToPass` Inverse map from each index of\n *   `to.textures` to the index of the pass containing it.\n */\nexport function mapGroups(maps = {}, to = maps) {\n  const {\n      values = valuesDef(),\n      buffersMax = buffersMaxDef, channelsMax = channelsMaxDef,\n      // Pack `values` into blocks of `channelsMax` to minimise resources.\n      packed = packValues(values, channelsMax)\n    } = maps;\n\n  // Ensure any properties changed are included.\n  to.values = values;\n  to.buffersMax = buffersMax;\n  to.channelsMax = channelsMax;\n  to.packed = packed;\n\n  const passes = to.passes = [[]];\n  const textures = to.textures = [[]];\n  const valueToTexture = to.valueToTexture = [];\n  const valueToPass = to.valueToPass = [];\n  const textureToPass = to.textureToPass = [];\n\n  /** Whether to use output buffers in passes, or no buffers in one pass. */\n  const output = !!buffersMax;\n  /** Counts the number of channels written in a single draw pass. */\n  let channels = 0;\n  /** Get the index, via any `packed`, from `values`. */\n  const getIndex = ((packed)? ((i) => packed[i]) : ((i) => i));\n  /** Get the value, via any `packed`, from `values`. */\n  const getValue = ((packed)? ((_, i) => values[i]) : ((v) => v));\n\n  return reduce((to, v, i) => {\n      const index = getIndex(i);\n      const value = getValue(v, index);\n\n      if(!validValue(value, channelsMax)) { return to; }\n\n      let p = passes.length-1;\n      let pass = passes[p];\n      let t = textures.length-1;\n      let texture = textures[t];\n\n      if((channels += value) > channelsMax) {\n        channels = value;\n        t = textures.push(texture = [])-1;\n        output && (pass.length >= buffersMax) && (p = passes.push(pass = [])-1);\n        pass.push(t);\n        textureToPass.push(p);\n      }\n      else if(pass.length === 0) {\n        pass.push(t);\n        textureToPass.push(p);\n      }\n\n      texture.push(index);\n      valueToTexture[index] = t;\n      valueToPass[index] = p;\n\n      return to;\n    },\n    values, to);\n}\n\n/**\n * Maps the minimal set of texture reads to derive the next state of values from\n * a past state of values they depend upon.\n *\n * @see {@link mapGroups}\n *\n * @example ```\n *   const maps = mapGroups({\n *     // See `mapGroups` examples for resulting maps.\n *     values: [2, 4, 1], channelsMax: 4, buffersMax: 1, packed: false,\n *     // Derived step/value indexes, per-value; sample entries include:\n *     derives: [\n *       // Single...\n *       2,\n *       // Empty...\n *       ,\n *       // Multiple...\n *       [\n *         // Defined step...\n *         { value: 1, step: 0 },\n *         // All values at any given level/step...\n *         true\n *       ]\n *     ]\n *   });\n *\n *   mapSamples(maps); // =>\n *   {\n *     ...maps,\n *     // Minimum texture samples for values; nested per-pass, per-value.\n *     // Deepest arrays are step/texture index pairs into `maps.textures`.\n *     samples: [\n *       [[0, 2]],\n *       null,\n *       [[1, 0], [0, 0], [0, 1], [0, 2]]\n *     ],\n *     // Value indexes into `to.samples`; nested per-pass, per-value.\n *     // Map from a value index to data it needs in the minimal samples.\n *     reads: [\n *       [[0]],\n *       null,\n *       [null, null, [0, 1, 2, 3]]\n *     ]\n *   };\n * ```\n *\n * @param {object} maps How values are grouped per-`texture` per-pass per-step.\n *   See `mapGroups`.\n *\n * @param {derives} [maps.derives] How the next output state `values` derive\n *   from any past input `values`. If given no `derives`, or a\n *   `false`y-non-integer, no samples are mapped, `to` is returned unchanged.\n *\n * @param {array.<array.<number>>} maps.passes Textures grouped into passes. See\n *   `mapGroups`.\n * @param {array.<array.<number>>} maps.textures Values grouped into textures. See\n *   `mapGroups`.\n * @param {array.<number>} maps.valueToTexture Inverse map from each value index\n *   to the data texture index containing it.\n * @param {object} [to=maps] The object to store the result in; `maps` if not\n *   given.\n *\n * @returns {object} `to` The given `to` object, with resulting maps added for\n *   any given `maps.derives`.\n * @returns {array.<array.<array.<number>>>} `[to.samples]` Map of the minimum\n *   set of indexes into `maps.textures` that need to be sampled per-pass,\n *   to get all `derives` needed for each value of `maps.values` of each\n *   pass of `maps.passes`.\n * @returns {array.<array.<array.<number>>>} `[to.reads]` Sparse map from\n *   each value of `derives` to its step and texture indexes in `to.samples`.\n * @returns {derives} `[to.derives]` How new values derive from past values, as\n *   given.\n */\nexport function mapSamples(maps = {}, to = maps) {\n  const { derives, passes, textures, valueToTexture } = maps;\n\n  if(!derives && (derives !== 0)) { return to; }\n\n  const reads = to.reads = [];\n  const cache = {};\n\n  const allStepSamples = (step) =>\n    cache[step] ??= map((t, value) => ({ step, value }), valueToTexture);\n\n  const getAddSample = (pass, valueNext) => function add(set, derive, d) {\n    /** The past step to derive from. */\n    let step = 0;\n    /** The past value to derive from. */\n    let dp = derive;\n\n    // Derive from any specified `value` and `step` nested properties.\n    (derives !== true) && !isInteger(derives) &&\n      ({ value: dp = dp, step = step } = derive);\n\n    // Derive from all samples at the given or most recent step if given `true`.\n    if(dp === true) { return reduce(add, allStepSamples(step), set); }\n\n    // Derive from the given sample.\n    const texture = valueToTexture[dp];\n\n    if(!(isInteger(step) && isInteger(texture))) {\n      return console.error('`mapSamples`: invalid map for sample',\n        derives, maps, pass, valueNext, derive, d, step, texture, dp);\n    }\n\n    // Create the set if not already created.\n    const to = (set || []);\n    // Check for any existing matching step/texture read in the set.\n    const i = to.findIndex(([s, t]) => (s === step) && (t === texture));\n\n    // Add the read for this next value in this pass; creating any needed maps.\n    ((reads[pass] ??= [])[valueNext] ??= [])\n      // A new read as needed, or any existing matching read.\n      .push((i < 0)? to.push([step, texture])-1 : i);\n\n    return to;\n  };\n\n  const getAddSamples = (pass) => (set, valueNext) => {\n    /** Derive next output value from any given past input values. */\n    const dn = ((isArray(derives))? derives[valueNext] : derives);\n\n    return (((!dn && (dn !== 0))? set\n      : (((dn !== derives) && isArray(dn))?\n        reduce(getAddSample(pass, valueNext), dn, set)\n      : getAddSample(pass, valueNext)(set, dn))));\n  }\n\n  to.samples = map((pass, p) => reduce((set, texture) =>\n        reduce(getAddSamples(p), textures[texture], set),\n      pass, null),\n    passes, []);\n\n  return to;\n}\n\n/**\n * Maps a full step, creates maps grouping given values per-`texture` per-pass\n * per-step, and minimal samples and reads if new values derive from past ones.\n *\n * @see {@link mapGroups}\n * @see {@link mapSamples}\n *\n * @param {object} [maps] Input value maps and settings.\n * @param {object} [to=maps] An `object` to contain the results; modifies `maps`\n *   if not given.\n *\n * @returns {object} `to` The given `to` object; how `values` are grouped\n *   per-`texture` per-pass per-step, meta information, and given parameters;\n *   and minimal samples and reads for any given `maps.derives`.\n */\nexport const mapStep = (maps, to = maps) => mapSamples(mapGroups(maps, to), to);\n\n/**\n * @typedef {derive|array.<derive|array.<derive>>>} derives\n * Denotes how next output `values` derive from any past input `values`.\n *\n * A nested hierarchy of the form\n * `all-next-from-past[any-next-from-past[any-next-from-any-past]]`; each\n * nesting level denotes how to derive:\n * 0. `all-next-from-past`: to all next `values`, from one/all past `value`/s.\n * 1. `any-next-from-past`: to any given next `values` (by sparse `array`\n *   indexes in `values` order), from one/all past `value`/s.\n * 2. `any-next-from-any-past`: to any given next `values` (by its `array` index\n *   in parent level 1), from any past `value`/s in this level 2 `array`.\n *\n * The `array`s are sparse, with empty or `false`y-non-integer entries ignored.\n *\n * See `derive` for how to denote past input `values`.\n *\n * **See**\n *\n * - {@link derive}\n */\n\n/**\n * @typedef {true|number|{value:true|number,step?:number}} derive\n * Denotes any past input `values` (and optional past `step`), that next output\n * `values` derive from.\n *\n * A nested hierarchy of the form `any-value-past[any-value-step-past]`,\n * indexing `values`, each nesting level denotes how to derive from:\n * 0. `any-value-past`: any/all past input `value`/s, at 1st `step` past.\n * 1. `any-value-step-past`: any/all past input `value`/s, at any given `step`\n *   past.\n *\n * The `value`/s to derive from may be given as:\n * - `true`: derives from all `values`.\n * - `number`: derives from the given `values` index.\n *\n * If given a `true` or `number` (denoting `value`/s but no `step`), the next\n * output `value` derives from the given `values` at the 1st `step` past.\n *\n * To specify a different `step`, pass an `object` denoting both the `value` (as\n * above) along with a `step`; in the form `{value:true|number,step?:number}`,\n * to derive from the `value` at any given `step` past (or the 1st `step` past\n * if not given).\n *\n * Any omitted `values` are ignored.\n *\n * See `derives` for more on how these are derived by the next output `values`.\n *\n * **See**\n *\n * - {@link derives}\n */\n\nexport default mapStep;\n","/**\n * @module\n * @category JS\n */\n\nimport map from '@epok.tech/fn-lists/map';\nimport range from '@epok.tech/fn-lists/range';\n\nconst { isFinite, isInteger } = Number;\n\n/**\n * Returns the given width, for various properties in order of precedence.\n *\n * @see {@link data.toData}\n *\n * @param {object} value Size (width) `number`, or an `object` containing it.\n * @param {number} [value.width] Width; supersedes further aliases.\n * @param {number} [value.w] Alias of `width`; supersedes further aliases.\n * @param {number} [value.x] Alias of `width`; supersedes further aliases.\n * @param {object} [value.shape] Shape (width) `number`, or an `object`\n *   containing it; supersedes further aliases.\n * @param {object} [value.size] Size (width) `number`, or an `object`\n *   containing it; supersedes further aliases.\n * @param {number} [value.side] Width and height; supersedes further aliases.\n * @param {number} [value.ʼ0ʼ] Alias of `width`; supersedes `value` itself.\n *\n * @returns {number} The width as given in one of the expected properties, or\n *   any given `value` number, or `null`ish if no width could be resolved.\n */\nexport function getWidth(value) {\n  const { width, w, x, shape, size, side, 0: v0 } = value;\n\n  return width ?? w ?? x ??\n    (shape && getWidth(shape)) ?? (size && getWidth(size)) ??\n    side ?? v0 ?? ((isFinite(value))? value : null);\n}\n\n/**\n * Returns the given height, for various properties in order of precedence.\n *\n * @see {@link data.toData}\n *\n * @param {object} value Size (height) `number`, or an `object` containing it.\n * @param {number} [value.height] Height; supersedes further aliases.\n * @param {number} [value.h] Alias of `height`; supersedes further aliases.\n * @param {number} [value.y] Alias of `height`; supersedes further aliases.\n * @param {object} [value.shape] Shape (height) `number`, or an `object`\n *   containing it; supersedes further aliases.\n * @param {object} [value.size] Size (height) `number`, or an `object`\n *   containing it; supersedes further aliases.\n * @param {number} [value.side] Width and height; supersedes further aliases.\n * @param {number} [value.ʼ1ʼ] Alias of `height`; supersedes `value` itself.\n *\n * @returns {number} The height as given in one of the expected properties, or\n *   any given `value` number, or `null`ish if no height could be resolved.\n */\nexport function getHeight(value) {\n  const { height, h, y, shape, size, side, 1: v1 } = value;\n\n  return height ?? h ?? y ??\n    (shape && getHeight(shape)) ?? (size && getHeight(size)) ??\n    side ?? v1 ?? ((isFinite(value))? value : null);\n}\n\n/**\n * Gives the number of entries to draw a full state, for various parameters.\n * Effectively equivalent to `gl_VertexID` in `WebGL2`.\n *\n * @see {@link getWidth}\n * @see {@link getHeight}\n * @see {@link data.toData}\n *\n * @param {object} [size=1] Size `number` of data resources, or an `object`\n *   containing it; width if `height` is given as a second parameter.\n *   See `getWidth` and `getHeight`.\n * @param {number} [size.entries] The `number` of entries of data resources.\n * @param {object} [height=1] Height `number` of data resources, or an `object`\n *   containing it.\n *\n * @returns {number} The number of entries needed to draw a full state; each\n *   entry of a data-texture (its area, equivalent to `state.size.entries`).\n */\nexport const countDrawEntries = (size = 1, height = 1) =>\n  size?.entries ?? (getWidth(size) ?? 1)*(getHeight(height) ?? 1);\n\n/**\n * Gives the `array` of indexes needed to draw a full state.\n *\n * @param {object} size The `number` of entries in each data-`texture`; or an\n *   `object` of size/type of data resources.\n *\n * @returns {array.<number>} An `array` of indexes for drawing all\n *   data-`texture` entries, numbered `0` to `size-1`.\n */\nexport const getDrawIndexes = (size) =>\n  map((_, i) => i, range(isInteger(size)? size : countDrawEntries(size)), 0);\n\n/**\n * 2 raised to the given numeric power, or `null` if not given.\n *\n * @param {number} [scale] The power to raise 2 to.\n *\n * @returns 2 raised to the given numeric power, or `null` if not given.\n */\nexport const getScaled = (scale) => ((isFinite(scale))? 2**scale : null);\n","/**\n * The `gpgpu` state and `GL` data resources.\n *\n * Handles `framebuffer`s, `texture`s; and the main meta info.\n *\n * @module\n * @category JS\n *\n * @todo Allow passes into or across `texture`s; separate shapes of data and\n *   `texture`s.\n * @todo In-place updates of complex resources and meta info.\n */\n\nimport range from '@epok.tech/fn-lists/range';\nimport map from '@epok.tech/fn-lists/map';\nimport reduce from '@epok.tech/fn-lists/reduce';\n\nimport { getWidth, getHeight, getScaled } from './size';\n\nimport {\n    widthDef, heightDef, stepsDef, valuesDef, channelsMinDef, buffersMaxDef,\n    typeDef, minDef, magDef, wrapDef, depthDef, stencilDef\n  } from './const';\n\nconst { isInteger } = Number;\n\n/**\n * Whether all states merge into one data-`texture` or remain separate by\n * default, according to the number of `steps` and `textures` to be tracked.\n *\n * Uses separate data-`texture`s when the `steps` and `textures` are few enough\n * to allow it without issue on all platforms; otherwise merges data-`texture`s.\n *\n * @param {number} [steps] How many `steps` of state to track.\n * @param {number} [textures] How many data-`textures` to track per-step.\n *\n * @returns {boolean} Whether to merge states to one data-`texture` by default.\n */\nconst mergeDef = (steps, textures) => ((steps > 2) && (textures > 1));\n\n/**\n * Set up the `gpgpu` resources and meta info for a state of a number data.\n *\n * @example ```\n *   const api = {\n *     framebuffer: ({ depth, stencil, width, height, color }) => null,\n *     texture: ({ type, min, mag, wrap, width, height, channels }) => null\n *   };\n *\n *   // Example with `webgl_draw_buffers` extension support, for 4 buffers.\n *   let maps = mapGroups({ values: [1, 2, 3], buffersMax: 4, packed: 0 });\n *   let state = { steps: 2, side: 10, maps };\n *\n *   const s0 = toData(api, state, {}); // =>\n *   {\n *     ...state,\n *     size: {\n *       steps: 2, passes: 2, textures: 4,\n *       width: 10, height: 10, shape: [10, 10], entries: 100\n *     },\n *     steps: [[s0.passes[0][0].framebuffer], [s0.passes[1][0].framebuffer]],\n *     // This setup results in fewer passes, as more buffers can be bound.\n *     passes: [\n *       [\n *         {\n *           framebuffer: api.framebuffer(s0.passes[0][0]),\n *           color: [s0.textures[0][0].texture, s0.textures[0][1].texture],\n *           map: [0, 1], // maps.passes[0]\n *           entry: 0, index: 0, step: 0,\n *           depth: false, stencil: false, width: 10, height: 10\n *         }\n *       ],\n *       [\n *         {\n *           framebuffer: api.framebuffer(s0.passes[1][0]),\n *           color: [s0.textures[1][0].texture, s0.textures[1][1].texture],\n *           map: [0, 1], // maps.passes[0]\n *           entry: 1, index: 0, step: 1,\n *           depth: false, stencil: false, width: 10, height: 10\n *         }\n *       ]\n *     ],\n *     textures: [\n *       [\n *         {\n *           texture: api.texture(s0.textures[0][0]),\n *           map: [0, 1], // maps.textures[0]\n *           entry: 0, index: 0, step: 0, pass: 0,\n *           type: 'float', width: 10, height: 10, channels: 4,\n *           min: 'nearest', mag: 'nearest', wrap: 'clamp'\n *         },\n *         {\n *           texture: api.texture(s0.textures[0][1]),\n *           map: [2], // maps.textures[1]\n *           entry: 1, index: 1, step: 0, pass: 0,\n *           type: 'float', width: 10, height: 10, channels: 4,\n *           min: 'nearest', mag: 'nearest', wrap: 'clamp'\n *         }\n *       ],\n *       [\n *         {\n *           texture: api.texture(s0.textures[1][0]),\n *           map: [0, 1], // maps.textures[0]\n *           entry: 2, index: 0, step: 1, pass: 0,\n *           type: 'float', width: 10, height: 10, channels: 4,\n *           min: 'nearest', mag: 'nearest', wrap: 'clamp'\n *         },\n *         {\n *           texture: api.texture(s0.textures[1][1]),\n *           map: [2], // maps.textures[1]\n *           entry: 3, index: 1, step: 1, pass: 0,\n *           type: 'float', width: 10, height: 10, channels: 4,\n *           min: 'nearest', mag: 'nearest', wrap: 'clamp'\n *         }\n *       ]\n *     ]\n *   };\n *\n *   // Example with no `webgl_draw_buffers` extension support, only 1 buffer.\n *   maps = mapGroups({ values: [1, 2, 3], buffersMax: 1, packed: 0 });\n *   state = { type: 'uint8', steps: 2, scale: 5, maps };\n *\n *   const s1 = toData(api, state, {}); // =>\n *   {\n *     ...state,\n *     size: {\n *       steps: 2, passes: 4, textures: 4,\n *       width: 32, height: 32, shape: [32, 32], entries: 1024\n *     },\n *     steps: [\n *       [s1.passes[0][0].framebuffer, s1.passes[0][1].framebuffer],\n *       [s1.passes[1][0].framebuffer, s1.passes[1][1].framebuffer]\n *     ],\n *     // This setup results in more passes, as fewer buffers can be bound.\n *     passes: [\n *       [\n *         {\n *           framebuffer: api.framebuffer(s1.passes[0][0]),\n *           color: [s1.textures[0][0].texture],\n *           map: [0], // maps.passes[0]\n *           entry: 0, index: 0, step: 0,\n *           depth: false, stencil: false, width: 32, height: 32\n *         },\n *         {\n *           framebuffer: api.framebuffer(s1.passes[0][1]),\n *           color: [s1.textures[0][1].texture],\n *           map: [1], // maps.passes[1]\n *           entry: 1, index: 1, step: 0,\n *           depth: false, stencil: false, width: 32, height: 32\n *         }\n *       ],\n *       [\n *         {\n *           framebuffer: api.framebuffer(s1.passes[1][0]),\n *           color: [s1.textures[1][0].texture],\n *           map: [0], // maps.passes[0]\n *           entry: 2, index: 0, step: 1,\n *           depth: false, stencil: false, width: 32, height: 32\n *         },\n *         {\n *           framebuffer: api.framebuffer(s1.passes[1][1]),\n *           color: [s1.textures[1][1].texture],\n *           map: [1], // maps.passes[1]\n *           entry: 3, index: 1, step: 1,\n *           depth: false, stencil: false, width: 32, height: 32\n *         }\n *       ]\n *     ],\n *     textures: [\n *       [\n *         {\n *           texture: api.texture(s1.textures[0][0]),\n *           map: [0, 1], // maps.textures[0]\n *           entry: 0, index: 0, step: 0, pass: 0,\n *           type: 'uint8', width: 32, height: 32, channels: 4,\n *           min: 'nearest', mag: 'nearest', wrap: 'clamp'\n *         },\n *         {\n *           texture: api.texture(s1.textures[0][1]),\n *           map: [2], // maps.textures[1]\n *           entry: 1, index: 1, step: 0, pass: 1,\n *           type: 'uint8', width: 32, height: 32, channels: 4,\n *           min: 'nearest', mag: 'nearest', wrap: 'clamp'\n *         }\n *       ],\n *       [\n *         {\n *           texture: api.texture(s1.textures[1][0]),\n *           map: [0, 1], // maps.textures[0]\n *           entry: 2, index: 0, step: 1, pass: 0,\n *           type: 'uint8', width: 32, height: 32, channels: 4,\n *           min: 'nearest', mag: 'nearest', wrap: 'clamp'\n *         },\n *         {\n *           texture: api.texture(s1.textures[1][1]),\n *           map: [2], // maps.textures[1]\n *           entry: 3, index: 1, step: 1, pass: 1,\n *           type: 'uint8', width: 32, height: 32, channels: 4,\n *           min: 'nearest', mag: 'nearest', wrap: 'clamp'\n *         }\n *       ]\n *     ]\n *   };\n * ```\n *\n * @todo Example using `merge`.\n *\n * @see {@link api.texture}\n * @see {@link api.framebuffer}\n * @see {@link maps.mapGroups}\n * @see {@link maps.mapSamples}\n * @see {@link maps.useBuffers}\n * @see {@link step.toStep}\n * @see {@link macros.macroSamples}\n * @see {@link macros.macroTaps}\n * @see {@link macros.macroPass}\n * @see {@link size.getWidth}\n * @see {@link size.getHeight}\n * @see {@link size.getScaled}\n *\n * @see [`sampler array index must be a literal expression`](https://stackoverflow.com/a/60110986/716898)\n * @see [`sampler2DArray`](https://github.com/WebGLSamples/WebGL2Samples/blob/master/samples/texture_2d_array.html)\n * @see [`sampler3D`](https://github.com/WebGLSamples/WebGL2Samples/blob/master/samples/texture_3d.html)\n *\n * @param {object} api The API for `GL` resources.\n * @param {texture} [api.texture] Function creating `GL` `texture`s.\n * @param {framebuffer} [api.framebuffer] Function creating `GL` `framebuffer`s.\n * @param {object} [state=\\{\\}] The state parameters.\n *\n * @param {number} [state.width=widthDef] Data width, aliases follow in order\n *   of precedence. See `getWidth`.\n * @param {number} [state.w] Alias of `state.width`. See `getWidth`.\n * @param {number} [state.x] Alias of `state.width`. See `getWidth`.\n * @param {number} [state.ʼ0ʼ] Alias of `state.width`. See `getWidth`.\n *\n * @param {number} [state.height=heightDef] Data height, aliases follow in order\n *   of precedence. See `getHeight`.\n * @param {number} [state.h] Alias of `state.height`. See `getHeight`.\n * @param {number} [state.y] Alias of `state.height`. See `getHeight`.\n * @param {number} [state.ʼ1ʼ] Alias of `state.height`. See `getHeight`.\n * @param {number} [state.shape] Data size. See `getWidth` and `getHeight`.\n * @param {number} [state.size] Data size. See `getWidth` and `getHeight`.\n * @param {number} [state.side] Data size of width/height.\n *   See `getWidth` and `getHeight`.\n * @param {number} [state.scale=scaleDef] Data size of width/height as a square\n *   power-of-two size, 2 raised to this power. See `getScaled`.\n *\n * @param {number|array} [state.steps=stepsDef] How many steps of state to\n *   track, or the list of states if already set up.\n * @param {object} [state.maps] How `state.maps.values` are grouped\n *   per-`texture` per-pass per-step. See `mapGroups`.\n * @param {array.<number>} [state.maps.values=valuesDef()] How `values` of each\n *   data item may be grouped into `texture`s across passes; set up here if not\n *   given. See `mapGroups`.\n * @param {number} [state.maps.channelsMin=channelsMinDef] The minimum allowed\n *   channels for `framebuffer` attachments; allocates unused channels as needed\n *   to reach this limit.\n * @param {number|false} [maps.buffersMax=buffersMaxDef] Maximum `texture`s that\n *   may be bound as buffer outputs per-pass. Binds no output `framebuffer`s if\n *   given `false`y; useful for side-effects with no state outputs, like\n *   rendering. See `mapGroups`.\n * @param {number} [state.maps.textures] How `values` are grouped into\n *   data-`texture`s. See `mapGroups`.\n * @param {number} [state.maps.passes] How data-`textures` are grouped into\n *   separate `framebuffer` passes. See `mapGroups`.\n *\n * @param {string} [state.type=typeDef] Any `texture` data type value.\n * @param {string} [state.min=minDef] Any `texture` minification filter value.\n * @param {string} [state.mag=magDef] Any `texture` magnification filter value.\n * @param {string} [state.wrap=wrapDef] Any `texture` wrap mode value.\n * @param {object} [state.depth=depthDef] Any `framebuffer` depth attachment, or\n *   a flag for whether it should be created.\n * @param {object} [state.stencil=stencilDef] Any `framebuffer` stencil\n *   attachment, or a flag for whether it should be created.\n *\n * @param {object} [state.merge=mergeDef(state.maps)] Whether to merge states\n *   into one data-`texture`; `true`y handles merging here, with any given\n *   properties used as-is (the merged data-`texture` already set up); `false`y\n *   uses un-merged `array`s of `texture`s.\n *\n *   Merging allows shaders to access past steps by non-constant lookups; e.g:\n *   attributes cause `\"sampler array index must be a literal expression\"` on\n *   `GLSL3` spec and some platforms (e.g: `D3D`); but takes more work to copy\n *   the last pass's bound `texture`/s to merge into the past `texture`, so\n *   should be used to variably access past steps or avoid limits of `array`s of\n *   `texture`s.\n *   Only this merged past `texture` and those bound in an active pass are\n *   created, as upon each pass the output will be copied to the past `texture`,\n *   and bound `texture`s reused in the next pass.\n *   If not merging, all state is as output by its pass in its own one of the\n *   `array`s of `texture`s.\n *\n *   The default merged `texture` is laid out as `[texture, step]` on the\n *   `[x, y]` axes, respectively; if other layouts are needed, the merge\n *   `texture` can be given here to be used as-is, and the merging/copying and\n *   lookup logic in their respective hooks. See `toStep` and `macroTaps`.\n *   If a merge `texture` is given, size information is interpreted in a similar\n *   way and precedence as it is from `state`. See `getWidth` and `getHeight`.\n *\n * @param {number} [state.merge.width] Merged data width, aliases follow in\n *   order of precedence. See `state`.\n * @param {number} [state.merge.w] Alias of `state.merge.width`. See `state`.\n * @param {number} [state.merge.x] Alias of `state.merge.width`. See `state`.\n * @param {number} [state.merge.ʼ0ʼ] Alias of `state.merge.width`. See `state`.\n * @param {number} [state.merge.height] Merged data height, aliases follow in\n *   order of precedence. See `state`.\n * @param {number} [state.merge.h] Alias of `state.merge.height`. See `state`.\n * @param {number} [state.merge.y] Alias of `state.merge.height`. See `state`.\n *   See `state`.\n * @param {number} [state.merge.ʼ1ʼ] Alias of `state.merge.height`. See `state`.\n * @param {number} [state.merge.shape] Merged data size. See `state`.\n * @param {number} [state.merge.size] Merged data size. See `state`.\n * @param {number} [state.merge.side] Merged data size of width/height.\n * @param {number} [state.merge.scale] Merged data size of width/height as a\n *   square power-of-two size, 2 raised to this power. See `state`.\n *\n * @param {object} [to=state] The state object to set up. Modifies the given\n *   `state` object by default.\n *\n * @returns {object} `to` The state object, set up with the data resources and\n *   meta information, for use with `toStep` and drawing:\n * @returns {object.<number,array.<number,array.<number>>>} `to.maps` Any given\n *   `state.maps`. See `mapGroups`.\n * @returns {array.<array.<object.<texture,string,number,array.<number>>>>}\n *   `to.textures` The `texture`s per-step, as `array`s of objects of `texture`s\n *   and meta info. See `to.maps.textures`.\n * @returns {array.<array.<object.<framebuffer,number,array.<number>>>>}\n *   `to.passes` Passes per step, as `array`s of objects of `framebuffer`s,\n *   referencing `to.textures`, and meta info. See `to.maps.passes`.\n * @returns {array.<framebuffer<array.<texture>>>} `to.steps`\n *   Hierarchy of steps of state, as an `array` of `framebuffer`s from\n *   `to.passes`, with `array`s of `texture`s from `to.textures`, and meta\n *   information; set up here, or the given `state.steps` if it's an `array`.\n *   State data may be drawn into the `framebuffer`s accordingly.\n *   See `mapGroups` and `toStep`.\n * @returns {object|undefined} `[to.merge]` If merging, a given or new merged\n *   `texture` and copier `framebuffer`, with meta info. See `toStep` and\n *   `macroTaps`.\n * @returns {object.<texture,string,number>|undefined} `[to.merge.all]` Any\n *   given `state.merge.all`, or newly-created merged `texture` and meta info.\n * @returns {object.<framebuffer,string,number>|undefined} `[to.merge.next]` Any\n *   given `state.merge.next`, or newly-created `framebuffer` and meta info; for\n *   copying each pass's data into the `merge`d `texture`.\n * @returns {object} `to.size` Size/type information of the created resources.\n * @returns {string} `to.size.type` Data type of `framebuffer`s and `texture`s.\n * @returns {boolean} `to.size.depth` Whether `framebuffer`s attach depth.\n * @returns {boolean} `to.size.stencil` Whether `framebuffer`s attach stencil.\n * @returns {number} `to.size.channelsMin` Minimum channels in any `texture`.\n * @returns {number} `to.size.steps` Number of `to.steps` in the main flow.\n * @returns {number} `to.size.passes` Number of `to.passes` in `to.steps`.\n * @returns {number} `to.size.framebuffers` Number of `framebuffer`s created.\n * @returns {number} `to.size.textures` Number of `to.textures` in `to.passes`.\n * @returns {number} `to.size.colors` Number of `texture`s created.\n * @returns {number} `to.size.width` Width of `framebuffer`s and `texture`s.\n * @returns {number} `to.size.height` Height of `framebuffer`s and `texture`s.\n * @returns {array.<number>} `to.size.shape` Shape of `framebuffer`s and\n *   `texture`s, as `[to.size.width, to.size.height]`.\n * @returns {number} `to.size.entries` Number of entries in each `texture`.\n * @returns {object.<number,string,array.<number>>|undefined} `[to.size.merge]`\n *   Any size/type information about any created or given `merge`d `texture`.\n */\nexport function toData({ texture, framebuffer }, state = {}, to = state) {\n  const {\n      maps, scale, steps = stepsDef,\n      // Resource format settings.\n      type = typeDef, min = minDef, mag = magDef, wrap = wrapDef,\n      depth = depthDef, stencil = stencilDef\n    } = state;\n\n  const scaled = getScaled(scale);\n  const width = Math.floor(getWidth(state) ?? scaled ?? widthDef);\n  const height = Math.floor(getHeight(state) ?? scaled ?? heightDef);\n\n  const {\n      values = (maps.values = valuesDef),\n      channelsMin = (maps.channelsMin = channelsMinDef),\n      buffersMax = (maps.buffersMax = buffersMaxDef),\n      textures: texturesMap, passes: passesMap\n    } = maps;\n\n  const stepsL = steps.length ?? steps;\n  const { merge = mergeDef(stepsL, texturesMap.length) } = state;\n\n  // Ensure any properties changed are included.\n  to.steps = steps;\n  to.merge = merge;\n  to.type = type;\n  to.min = min;\n  to.mag = mag;\n  to.wrap = wrap;\n  to.depth = depth;\n  to.stencil = stencil;\n  to.width = width;\n  to.height = height;\n\n  /** Whether to use output buffers in passes, or no buffers in one pass. */\n  const output = buffersMax || null;\n\n  /**\n   * All `framebuffer` attachments need the same number of channels; enough to\n   * hold all values a pass holds, or all passes hold if merging and reusing.\n   */\n  const passChannels = (pass, min) =>\n    reduce((min, t) =>\n        Math.max(min, reduce((sum, v) => sum+values[v], texturesMap[t], 0)),\n      pass, min);\n\n  /**\n   * If merging past `texture`s and reusing `texture` attachments in each pass's\n   * `framebuffer`, pre-compute the minimum channels for a reusable pool of\n   * `texture` attachments that can hold any pass's values; since all a\n   * `framebuffer`'s attachments also need the same number of channels, this is\n   * also the same number of channels across all passes.\n   */\n  const mergeChannels = ((!merge)? null\n    : reduce((min, p) => passChannels(p, min), passesMap, channelsMin));\n\n  /** Size of the created resources. */\n  const size = to.size = {\n    type, depth, stencil, channelsMin: mergeChannels ?? channelsMin,\n    steps: stepsL, passes: 0, framebuffers: 0, textures: 0, colors: 0,\n    width, height, shape: [width, height], entries: width*height\n  };\n\n  /** The `texture`s created for the `step`/`pass` render flow. */\n  const textures = to.textures = [];\n  /** The passes created for the `step`/`pass` render flow. */\n  const passes = to.passes = [];\n  /** The `texture`s bound to the next pass; reused if merging. */\n  let colorPool;\n\n  /**\n   * Add a `texture` attachment and meta info to `texture`s if applicable; to\n   * return its new `texture` or a reused one to bind to a pass in `passes`.\n   */\n  const addTexture = (channels, w, h, step, pass) => (index, c, _, color) => {\n    /** Properties passed for `texture` creation, then meta info. */\n    const to = { channels, width: w, height: h, type, min, mag, wrap };\n\n    // Resources.\n\n    /**\n     * Add/reuse `texture` color attachments as needed; add minimal `texture`s.\n     * If merging, passes may reuse any pass's existing `texture` attachments;\n     * otherwise, each pass has its own dedicated `texture` attachments.\n     */\n    let entry = c;\n    let t = color?.[entry];\n\n    // Only create new `texture`s if existing ones can't be reused.\n    if(!t) {\n      t = texture?.(to);\n      entry = size.textures++;\n    }\n\n    // Add meta info.\n\n    /** Check if this is bound to a pass. */\n    const s = isInteger(step);\n    const p = isInteger(pass);\n    const i = isInteger(index);\n\n    /** Denotes attached `texture`; if merging, `texture`s are reused. */\n    to.texture = t;\n    /** Denotes attached `texture` entry; if merging, `texture`s are reused. */\n    to.entry = entry;\n\n    s && (to.step = step);\n\n    if(p) {\n      /** Denotes `framebuffer` attachments; may reuse underlying `texture`s. */\n      to.color = size.colors++;\n      to.pass = pass;\n    }\n\n    i && (to.map = texturesMap[to.index = index]);\n\n    // Check whether this `texture` is part of the `step`/`pass` render flow.\n    // If so, add to `textures`, return its `texture` to bind to a pass.\n    // If not, return the entire object.\n    return ((s && p && i)? ((textures[step] ??= [])[index] = to).texture : to);\n  };\n\n  /**\n   * Add a pass to `passes`, with its `texture`s bound; to return its\n   * `framebuffer` to one of `steps`.\n   */\n  const addPass = (step, color) => (pass, index) => {\n    /**\n     * All a `framebuffer`'s attachments need the same number of channels;\n     * superseded by any given `color`'s value.\n     */\n    const channels = color ?? mergeChannels ??\n      ((pass)? passChannels(pass, channelsMin) : channelsMin);\n\n    // Resources.\n\n    /** Properties passed for `framebuffer` creation, then meta info. */\n    const to = {\n      depth, stencil, width, height,\n      /** Map the pass's `texture` color attachments and their meta info. */\n      color: color ??\n        map(addTexture(channels, width, height, step, index), pass,\n          // Reuse any existing color attachments if merging; otherwise make\n          // dedicated color attachments for each pass.\n          ((merge)? (colorPool ??= []) : []))\n    };\n\n    /**\n     * The `framebuffer` for this pass; don't create or bind if `buffersMax`\n     * is `false`y.\n     */\n    to.framebuffer = output && framebuffer?.(to);\n\n    // Add meta info.\n\n    /** Denotes any attached `framebuffer` entry. */\n    to.entry = output && size.framebuffers++;\n\n    if(pass) {\n      to.map = pass;\n      to.pass = size.passes++;\n    }\n\n    const s = isInteger(step);\n    const i = isInteger(index);\n\n    s && (to.step = step);\n    i && (to.index = index);\n\n    // Check whether this pass is part of the `step`/`pass` render flow.\n    // If so, add to `passes`, return its `framebuffer` for its step.\n    return ((pass && s && i)? ((passes[step] ??= [])[index] = to).framebuffer\n        // If not, return the entire object.\n      : to);\n  };\n\n  /**\n   * Set up resources needed to store data per-`texture` per-pass per-step.\n   * Use any given steps/passes or create new ones.\n   */\n  to.steps = map((passes, step) => passes || map(addPass(step), passesMap),\n    ((isInteger(steps))? range(steps) : steps), 0);\n\n  // Finish here if merge is disabled.\n  if(!merge) { return to; }\n\n  // Set up the `texture` for states to be merged into.\n\n  const { scale: mScale, all: mAll, next: mNext } = merge;\n  /** Use any size info given in `merge`, as with `state` above. */\n  const mScaled = getScaled(mScale);\n  /** Use any given size info, or merge along `[texture, step]` axes. */\n  const mw = getWidth(merge) ?? mScaled ?? texturesMap.length*width;\n  const mh = getHeight(merge) ?? mScaled ?? stepsL*height;\n\n  to.merge = {\n    /** New merge `texture` and info, or use any given merge `texture`. */\n    all: mAll ?? addTexture(mergeChannels, mw, mh)(),\n    /** Empty `framebuffer`, to copy data from each `texture` of each pass. */\n    next: mNext ?? addPass(null, false)()\n  };\n\n  size.merge = { width: mw, height: mh, shape: [mw, mh], entries: mw*mh };\n\n  return to;\n}\n\nexport default toData;\n","/**\n * The `gpgpu` inputs for `GL` `uniform`s.\n *\n * @module\n * @category JS\n */\n\nimport { setC2, setC4 } from '@thi.ng/vectors/setc';\nimport each from '@epok.tech/fn-lists/each';\nimport wrap from '@epok.tech/fn-lists/wrap';\n\nimport { boundDef, preDef } from './const';\n\n/**\n * Sets up `GL` `uniform` inputs for `gpgpu` calls, such as in `toStep`.\n *\n * The `uniform`s are defined as callback hooks to be called on each render pass\n * with global context and local state `object`s, allowing the use of different\n * `GL` APIs or author-defined hooks.\n *\n * Handles inputs of states as `array`s of data-`texture`s, or merged into one\n * data-`texture`; for `array`s of `texture`s, this arranges them on each step\n * so `GLSL` can dynamically sample the flattened `array` of `texture`s by a\n * constant step index; otherwise the single merged `texture` is bound once, and\n * `GLSL` can use a dynamic step index to sample states.\n *\n * @example ```javascript\n * const state = { pre: '', steps: 2, maps: mapStep({ values: [1, 2, 3] }) };\n * const api = {};\n *\n * toUniforms(toData(api, { ...state, merge: false }, {})); // =>\n * {\n *   stepNow: (context, state) => {},\n *   stateShape: (context, state) => {},\n *   viewShape: (context, state) => {},\n *   // Separate state data-`texture`s in an `array` (e.g: `sampler2D[]`).\n *   // State data-`texture`s for the 1st step ago, not bound as outputs.\n *   'states[0]': (context, state) => {},\n *   'states[1]': (context, state) => {},\n *   // Merged `texture` not used.\n *   states: (context, state) => null\n * };\n *\n * toUniforms(toData(api, { ...state, steps: 3, merge: false }, {})); // =>\n * {\n *   stepNow: (context, state) => {},\n *   stateShape: (context, state) => {},\n *   viewShape: (context, state) => {},\n *   // Separate state data-`texture`s in an `array` (e.g: `sampler2D[]`).\n *   // State data-`texture`s for the 1st step ago, not bound as outputs.\n *   'states[0]': (context, state) => {},\n *   'states[1]': (context, state) => {}\n *   // State data-`texture`s for the 2nd step ago, not bound as outputs.\n *   'states[2]': (context, state) => {},\n *   'states[3]': (context, state) => {},\n *   // Merged `texture` not used.\n *   states: (context, state) => null\n * };\n *\n * toUniforms(toData(api, { ...state, merge: true }, {})); // =>\n * {\n *   stepNow: (context, state) => {},\n *   stateShape: (context, state) => {},\n *   viewShape: (context, state) => {},\n *   // Merged states in one data-`texture` upon every pass (e.g: `sampler2D`,\n *   // or `sampler3D`/`sampler2DArray` where supported).\n *   states: (context, state) => {},\n *   // Separate data-`texture`s not used.\n *   'states[0]': (context, state) => null,\n *   'states[1]': (context, state) => null\n * };\n * ```\n *\n * @see {@link step.toStep}\n * @see {@link data.toData}\n * @see {@link maps.mapGroups}\n * @see {@link macros.macroSamples}\n * @see {@link macros.macroTaps}\n *\n * @param {object} state The `gpgpu` state. See `toData` and `mapGroups`.\n * @param {array|number} state.steps The `array` of steps, or number of steps.\n *   See `toData`.\n * @param {{textures?:number[][]}} state.maps How values are grouped into\n *   data-`texture`s (per-pass per-step). See `mapGroups`.\n * @param {string} [state.pre=preDef] Namespace prefix; `preDef` if not given.\n * @param {{all?:{texture?:object}}} [state.merge] Any merged state `texture`;\n *   uses separate state data-`texture`s if not given. See `toData`.\n *\n * @param {{shape?:number[],merge?:{shape?:number[]}}} [state.size] Any size of\n *   `state` data-`texture`s (as `vec2(width, height)`); with:\n *   - `shape`: Any `state` shape.\n *   - `merge.shape`: Any merged `states` shape, otherwise `state` shape.\n *\n *   See `toData`.\n *\n * @param {number} [state.bound=boundDef] Number of steps bound for output, not\n *   used for input; for platforms preventing read/write of the same `texture`.\n * @param {uniforms|object} [state.uniforms] Any `object` to merge the new\n *   `uniforms` into. See `to`.\n * @param {uniforms|object} [to=state.uniforms] Any `object` to contain the\n *   `uniform` hooks; modifies any `state.uniforms`, or a new `object` if not\n *   given. See `state.uniforms` and `uniforms`.\n *\n * @returns {{\n *     stepNow:(c,state:{stepNow:number})=>number,\n *     stateShape:(c,state:{size:{number}})=>[number,number,number,number],\n *     viewShape:(\n *       context:{drawingBufferWidth:number,drawingBufferHeight:number},s?\n *     )=>[number,number],\n *     states:()=>([])\n *   }}\n *\n * @param {{\n *     stepNow?:number,\n *     bound?:number,\n *     merge?:{texture:object},\n *     textures:{texture:object}[][]\n *   }} state Local properties (the `gpgpu` `state`); with:\n *   - `stepNow`: The current step of the `gpgpu` `state`.\n *   - `bound`: Number of steps bound to output; can't be bound as inputs.\n *   - `merge`: Any `object` containing merged data-`texture`.\n *     - `texture`: Any merged data-`texture`.\n *   - `textures`: Textures per-step, as `array`s of `object`s with a `texture`\n *     property. See `toData`.\n *\n *   The `to` set up with `uniform` callback hooks for the given `state`, to\n *   be called on each render pass for the latest `uniform` values; with:\n *   - `stepNow`: Gives any current step. See `toStep`.\n *   - `stateShape`: Gives any shape of any data-`texture`s; as\n *     `vec4(vec2(width, height), vec2(width, height))`; channels are `null`ish\n *     if there's no valid shape; with:\n *     - Any `state` shape; in `xy` channels.\n *     - Any merged `states` shape, otherwise `state` shape; in `zw` channels.\n *   - `viewShape`: Gives the `GL` viewport shape; as `vec2(width, height)`;\n *     given a `context` parameter with:\n *     - `drawingBufferWidth`: Current `GL` viewport width in pixels.\n *     - `drawingBufferHeight`: Current `GL` viewport height in pixels.\n *   - `states`: Gives the past steps data-`texture`s; as either:\n *     - Any merged data-`texture` as a single `GLSL` `sampler` (e.g: `2D`/\n *       `2DArray`/`3D`; up to to the `GL` API for `texture`); otherwise `null`.\n *     - Any separate data-`texture`s as a `GLSL` `array` of `sampler`s (e.g:\n *       `sampler2D[]`), each part/all of a `gpgpu` step's data and accessible\n *       by constant index (steps ago); otherwise `null`.\n *\n *   These property names may be prefixed with any given `state.pre`.\n *   See `toData` and `toStep`.\n */\nexport function toUniforms(state = {}, to = state.uniforms ??= {}) {\n  const { steps, maps, pre: n = preDef, bound = boundDef } = state;\n  const { textures } = maps;\n  const stepsL = steps.length ?? steps;\n  const texturesL = textures.length;\n  // Local caches.\n  const stateShape = [];\n  const viewShape = [];\n\n  /** Gives any current step. */\n  to[n+'stepNow'] = (_, s) => s.stepNow;\n\n  /** Gives any shape of `state` and any merged `states` data-`texture`s. */\n  to[n+'stateShape'] = (_, { size: { shape: s, merge: m } }) =>\n    ((s)? setC4(stateShape, ...s, ...(m?.shape ?? s)) : setC4(stateShape));\n\n  /** Gives the shape of the `GL` viewport. */\n  to[n+'viewShape'] = ({ drawingBufferWidth: w, drawingBufferHeight: h }) =>\n    setC2(viewShape, w, h);\n\n  /**\n   * Gives all `states` merged in one `texture`, if using `merge`;\n   * otherwise gives `null`.\n   */\n  to[n+'states'] = (_, s) => s.merge?.all?.texture ?? null;\n\n  /**\n   * Past steps, each some steps `ago`, from the current active step at `0`, as\n   * `[0,... stepsL-1-bound]`.\n   */\n  const addTextures = (ago) =>\n    /**\n     * Hooks to pull a given `texture` by the active pass `state`; lets `GLSL`\n     * access the `array` of `texture`s by constant index (steps ago).\n     * Only returns a value if not using a `merge`d `texture`; otherwise `null`.\n     */\n    each((_, t) => to[n+`states[${(ago*texturesL)+t}]`] =\n        (_, { merge: m, stepNow: s, bound: b = bound, textures: ts }) =>\n          ((m)? null : wrap(s-b-ago, ts)?.[t]?.texture),\n      textures);\n\n  /** Flatten all input `texture`s, as `uniform`s are kept in flat `array`s. */\n  for(let ago = 0, pl = stepsL-bound; ago < pl; ++ago) { addTextures(ago); }\n\n  return to;\n}\n\n/**\n * @todo [Fix `@callback`/`@typedef`](https://github.com/TypeStrong/typedoc/issues/1896):\n *   nested `@param`; omits `@return`/`@see`/`@this`\n *\n * @callback getUniform\n * A `function` hook to update a `GL` `uniform` value for a render pass.\n *\n * **See**\n * - {@link toUniforms}\n * - {@link data.toData}\n * - {@link api.texture}\n *\n * **Returns**\n * A `GL` uniform to be bound via a `GL` API.\n *\n * @param {{\n *     drawingBufferWidth:number,\n *     drawingBufferHeight:number\n *   }} context General or global properties; with:\n *   - `drawingBufferWidth`: Current `GL` viewport width in pixels.\n *   - `drawingBufferHeight`: Current `GL` viewport height in pixels.\n *\n * @param {{\n *     stepNow?:number,\n *     bound?:number,\n *     merge?:{texture:object},\n *     textures:{texture:object}[][]\n *   }} state Local properties (the `gpgpu` state); with:\n *   - `stepNow`: The current step of the `gpgpu` state.\n *   - `bound`: Number of steps bound to output; can't be bound as inputs.\n *   - `merge`: Any `object` containing merged data-`texture`.\n *     - `texture`: Any merged data-`texture`.\n *   - `textures`: Textures per-step, as `array`s of `object`s with a `texture`\n *     property. See `toData`.\n *\n * @returns {number|number[]|texture|object}\n */\n","const [{ length: start}, { length: end }] = '[object {type}]'.split('{type}');\n\n/**\n * Gives the type of a given input.\n *\n * @see https://stackoverflow.com/a/17772086/716898\n *\n * @param {*} x Any input to test.\n *\n * @returns {string} The type of `x`.\n */\nexport const type = (x) => toString.call(x).slice(start, -end);\n\nexport default type;\n","/**\n * The `GLSL` preprocessor macros for working with the `gpgpu` state and maps.\n *\n * Each set of different macros will result in new shader compilations - for\n * optimal performance, the fewest macros possible should be created, one per\n * each given set of inputs, ideally; caches here can be used for efficiency.\n *\n * @module\n * @category JS\n *\n * @todo Redo examples, especially `macroTaps` and `macroPass`.\n * @todo Ensure the `output_N` in `macroOutput` can work with `WebGL2`; look at\n *   using `layout(location=attach_N) out data_N`, not `gl_FragData[attach_N]`.\n *   - [SO: Multiple output textures from the same program](https://stackoverflow.com/questions/51793336/multiple-output-textures-from-the-same-program)\n *   - [SO: GL FragData must be constant zero](https://stackoverflow.com/questions/46740817/gl-fragdata-must-be-constant-zero)\n *   - [SO: How are layout qualifiers better than getAttribLocation in WebGL2](https://stackoverflow.com/questions/50258822/how-are-layout-qualifiers-better-than-getattriblocation-in-webgl2)\n */\n\nimport reduce from '@epok.tech/fn-lists/reduce';\nimport map from '@epok.tech/fn-lists/map';\nimport { type } from '@epok.tech/is-type/type';\n\nimport { preDef, boundDef } from './const';\n\n/** Escaped line-feed for easier reading. */\nexport const lineFeed = ' \\\\\\n';\nconst lf = lineFeed;\n\n/** The channels denoted for texture input/output. */\nexport const rgba = 'rgba';\n/** Simple shared cache for temporary or reusable objects. */\nexport const cacheDef = {};\n/** Gives cache keys from simple plain `object` inputs. */\nconst id = JSON.stringify;\n\n/** Names for each part of the macro handling process available to hooks. */\nexport const hooks = {\n  /** The full set of macros. */\n  macroPass: '',\n  /** Each part of the set of macros. */\n  macroValues: 'values', macroOutput: 'output',\n  macroSamples: 'samples', macroTaps: 'taps'\n};\n\n/**\n * Whether handling macros here; or the result of a given hook to handle it.\n *\n * Allows macros of the given key to be handled by external named hooks, to\n * replace any part of the functionality here in overall or granular ways.\n *\n * The macro names checked in this module are found in `hooks`.\n *\n * @example ```javascript\n * // Macros to be handled here, the default.\n * [hasMacros(), hasMacros({}), hasMacros({ macros: true })]]\n *   .every((m) => m == null);\n *\n * // Macros to be handled here, with prefix `'pre_'` instead of `'preDef'`.\n * hasMacros({ pre: 'pre_' }) == null;\n *\n * // Macros not created.\n * [hasMacros({ macros: false }), hasMacros({ macros: 0 })]\n *   .every((m) => m === '');\n *\n * // Macros for `'a'` handled by external `string` hook, not here.\n * hasMacros({ macros: { a: '//A\\n', b: () => '//B\\n' } }, 'a') === '//A\\n';\n * // Macros for `'b'` handled by external `function` hook, not here.\n * hasMacros({ macros: { a: '//A\\n', b: () => '//B\\n' } }, 'b') === '//B\\n';\n * // Macros specified `on` a `'frag'` not created.\n * hasMacros({ macros: { frag: 0, values_vert: 0 } }, '', 'frag') === '';\n * // Macros specified `on` a `'vert'` handled here.\n * hasMacros({ macros: { frag: 0, values_vert: 0 } }, '', 'vert') == null;\n * // Macros of `'values'`/`hooks.values` handled here.\n * hasMacros({ macros: { frag: 0, values_vert: 0 } }, 'values', '') == null;\n * // Macros of `'values'`/`hooks.values` specified `on` a `'vert'` not created.\n * hasMacros({ macros: { frag: 0, values_vert: 0 } }, 'values', 'vert') === '';\n * ```\n *\n * @see hooks\n *\n * @param {object} [state] Any `object` whose properties may handle macros.\n * @param {string} [key] Any name to check granularly within `macros`. See `hooks`.\n * @param {string} [on=''] Any further macro name specifier; if given, `key`\n *   itself and with this specifier are checked (i.e: `key` then `key+'_'+on`).\n *\n * @param {false|string|((...)=>string|null)|{}} [macros=state.macros] How\n *   macros should be handled, according to their type, in order of precedence:\n *   - `null`ish: macros to be handled here, `null`ish returned.\n *   - `true`: macros to be handled here, `null`ish returned.\n *   - `false`y: no macros to be handled here, empty `''` `string` returned.\n *   - `string`: no macros to be handled here, this hook value's used instead.\n *   - `function`: external `hasMacros`-like `function` hook, called with\n *     `macros(state, key, on, macros)`, the returned value used as shown here.\n *   - `object`: recurses with any value at the given `key`, with\n *     `hasMacros(state, key, on, macros[key])`.\n *   - Otherwise, macros to be handled here, `null`ish returned.\n *\n * @returns {null|string} Either the result of the macros handled elsewhere,\n *   or `null`ish if macros should be handled here.\n */\nexport function hasMacros(state, key, on = '', macros = state?.macros) {\n  if((macros ?? true) === true) { return null; }\n  else if(!macros) { return ''; }\n\n  const t = type(macros);\n\n  return ((t === 'String')? macros\n    : ((t === 'Function')?\n      hasMacros(state, key, on, macros(state, key, on, macros))\n    : (((macros instanceof Object) && (key in macros))?\n      hasMacros(state, key, on, macros[key])\n    : ((on)? hasMacros(state, ((key)? key+'_'+on : on), '', macros)\n    : null))));\n}\n\n/**\n * Generates an `array`-like declaration, as a `GLSL` syntax `string` compatible\n * with versions 1-3.\n *\n * Works around the lack of `const` `array`s in `GLSL` < 3. Used as the base for\n * the other `GLSL` version list types, ensuring a common standard while\n * offering further language features where available.\n *\n * @example ```javascript\n * getGLSLListBase('float', 'list', [0, 1, 2], 'const'); // =>\n * 'const int list_l = 3;'+lf+\n * 'const int list_0 = float(0);'+lf+\n * 'const int list_1 = float(1);'+lf+\n * 'const int list_2 = float(2);';\n * ```\n *\n * @param {string} type The `GLSL` list data-type.\n * @param {string} name The name of the `GLSL` list variable.\n * @param {array.<number,number[]>} a The list of `GLSL` values.\n * @param {string} [qualify=''] A `GLSL` qualifier, if needed.\n * @param {string} [init=type] A data-type initialiser, `type` by default.\n *\n * @returns {string} The `GLSL1` array-like declaration string.\n */\nexport const getGLSLListBase = (type, name, a, qualify = '', init = type) =>\n  `const int ${name}_l = ${a.length};`+\n  reduce((s, v, i) =>\n      s+lf+(qualify && qualify+' ')+type+\n        ` ${name}_${i} = ${init}(${v.join?.(', ') ?? v});`,\n    a, '');\n\n/**\n * Generates an array-like declaration, as a `GLSL1` syntax string.\n *\n * Workaround for lack of `const` arrays in `GLSL` < 3. Adds a lookup macro\n * function; slow here, but standard.\n *\n * @see {@link getGLSLListBase}\n *\n * @example ```javascript\n * getGLSL1ListLike('float', 'list', [0, 1, 2], 'const'); // =>\n * 'const int list_l = 3;'+lf+\n * 'const int list_0 = float(0);'+lf+\n * 'const int list_1 = float(1);'+lf+\n * 'const int list_2 = float(2);\\n'+\n * '// Index macro `list_i` (e.g: `list_i(0)`) may be slow, `+\n *   'use name (e.g: `list_0`) if possible.\\n'+\n * '#define list_i(i) ((i == 2)? list_2 : ((i == 1)? list_1 : list_0))\\n';\n * ```\n *\n * @param {string} type The `GLSL` list data-type.\n * @param {string} name The name of the `GLSL` list variable.\n * @param {array.<number,array.<number>>} a The list of `GLSL` values.\n * @param {string} [qualify=''] A `GLSL` qualifier, if needed.\n * @param {string} [init=type] A data-type initialiser, `type` by default.\n *\n * @returns {string} The `GLSL1` array-like declaration string.\n */\nexport const getGLSL1ListLike = (type, name, a, qualify = '', init = type) =>\n  getGLSLListBase(type, name, a, qualify, init)+'\\n'+\n  // @todo Would ideally use the concatenation macro, but can't in GLSL 1.\n  // `#define ${name}_i(i) ${name}_##i`;\n  `// Index macro \\`${name}_i\\` (e.g: \\`${name}_i(0)\\`) may be slow, `+\n    `use name (e.g: \\`${name}_0\\`) if possible.\\n`+\n  `#define ${name}_i(i) ${reduce((s, v, i) =>\n      ((i)? `((i == ${i})? ${name}_${i} : ${s})` : `${name}_${i}`),\n    a, '')}\\n`;\n\n/**\n * Generates an array declaration, as a `GLSL1` syntax string.\n *\n * Lookup and meta macros are added for consistency with other versions.\n *\n * @see {@link getGLSLListBase}\n *\n * @example ```javascript\n * getGLSL1ListArray('vec3', 'list', [[1, 0, 0], [0, 2, 0], [0, 0, 3]]); // =>\n * 'const int list_l = 3;'+lf+\n * 'vec3 list_0 = vec3(1, 0, 0);'+lf+\n * 'vec3 list_1 = vec3(0, 2, 0);'+lf+\n * 'vec3 list_2 = vec3(0, 0, 3);'+lf+\n * 'vec3 list[list_l];'+lf+\n * 'list[0] = list_0;'+lf+\n * 'list[1] = list_1;'+lf+\n * 'list[2] = list_2;\\n'+\n * '#define list_i(i) list[i]\\n';\n * ```\n *\n * @param {string} type The `GLSL` list data-type.\n * @param {string} name The name of the `GLSL` list variable.\n * @param {array.<number,array.<number>>} a The list of `GLSL` values.\n * @param {string} [qualify=''] A `GLSL` qualifier, if needed.\n * @param {string} [init=type] A data-type initialiser, `type` by default.\n *\n * @returns {string} The `GLSL1` array declaration string.\n */\nexport const getGLSL1ListArray = (type, name, a, qualify = '', init = type) =>\n  getGLSLListBase(type, name, a, qualify, init)+lf+\n  (qualify && qualify+' ')+type+` ${name}[${name}_l];`+\n  reduce((s, _, i) => s+lf+name+`[${i}] = ${name}_${i};`, a, '')+'\\n'+\n  `#define ${name}_i(i) ${name}[i]\\n`;\n\n/**\n * Generates an array declaration, as a `GLSL3` syntax string.\n *\n * Lookup and meta macros are added for consistency with other versions.\n *\n * @see {@link getGLSLListBase}\n *\n * @example ```javascript\n * getGLSL3List('int', 'list', [0, 1, 2], 'const'); // =>\n * 'const int list_l = 3;'+lf+\n * 'const int list_0 = int(0);'+lf+\n * 'const int list_1 = int(1);'+lf+\n * 'const int list_2 = int(2);'+lf+\n * 'const int list[list_l] = int[list_l](list_0, list_1, list_2);\\n'+\n * '#define list_i(i) list[i]\\n';\n * ```\n *\n * @param {string} type The `GLSL` list data-type.\n * @param {string} name The name of the `GLSL` list variable.\n * @param {array.<number,array.<number>>} a The list of `GLSL` values.\n * @param {string} [qualify=''] A `GLSL` qualifier, if needed.\n * @param {string} [init=type] A data-type initialiser, `type` by default.\n *\n * @returns {string} The `GLSL3` array declaration string.\n */\nexport const getGLSL3List = (type, name, a, qualify = '', init = type) =>\n  getGLSLListBase(type, name, a, qualify, init)+lf+\n  (qualify && qualify+' ')+type+` ${name}[${name}_l] = ${init}[${name}_l](${\n    reduce((s, _, i) => (s && s+', ')+name+'_'+i, a, '')});\\n`+\n  `#define ${name}_i(i) ${name}[i]\\n`;\n\n/**\n * Creates a `GLSL` definition of an array, and initialises it with the given\n * values, type, and variable name.\n *\n * The initialisation is valid `GLSL1` or greater syntax; but is written with\n * escaped new-lines so it may be used in a single-line (e.g: for preprocessor\n * macros).\n *\n * For a `qualify` of `const` on any `GLSL` < 3, falls back to using non-array\n * variables with the index appended to `name`, since `const` arrays aren't\n * supported before `GLSL3`.\n *\n * @see {@link getGLSL3List}\n * @see {@link getGLSL1ListLike}\n * @see {@link getGLSL1ListArray}\n *\n * @example ```javascript\n * getGLSLList('int', 'test', [0, 1]); // =>\n * 'const int test_l = 2;'+lf+\n * 'int test_0 = int(0);'+lf+\n * 'int test_1 = int(1);'+lf+\n * 'int test[test_l];'+lf+\n * 'test[0] = test_0;'+lf+\n * 'test[1] = test_1;\\n'+\n * '#define test_i(i) test[i]\\n';\n *\n * getGLSLList('ivec2', 'vecs', [[1, 0], [0, 1]], 'const', 3); // =>\n * 'const int vecs_l = 2;'+lf+\n * 'ivec2 vecs_0 = ivec2(1, 0);'+lf+\n * 'ivec2 vecs_1 = ivec2(0, 1);'+lf+\n * 'const ivec2 vecs[vecs_l] = ivec2[vecs_l](vecs_0, vecs_1);\\n'+\n * '#define vecs_i(i) vecs[i]\\n';\n *\n * getGLSLList('int', 'listLike', [0, 1], 'const', 1); // =>\n * 'const int listLike_l = 2;'+lf+\n * 'const int listLike_0 = int(0);'+lf+\n * 'const int listLike_1 = int(1);\\n'+\n * '// Index macro `listLike_i` (e.g: `listLike_i(0)`) may be slow, `+\n *   'use name (e.g: `listLike_0`) if possible.\\n'+\n * '#define listLike_i(i) ((i == 1)? listLike_1 : listLike_0)\\n';\n * ```\n *\n * @param {string} type The `GLSL` list data-type.\n * @param {string} name The name of the `GLSL` list variable.\n * @param {array.<number,array.<number>>} a The list of `GLSL` values.\n * @param {string} [qualify=''] A `GLSL` qualifier, if needed (e.g: `const`).\n * @param {number} [glsl=1] The `GLSL` version to target, if specified.\n * @param {string} [init] A data-type initialiser.\n *\n * @returns {string} The `GLSL` (1 or 3) array or array-like declaration string.\n */\nexport const getGLSLList = (type, name, a, qualify = '', glsl = 1, init) =>\n  ((glsl >= 3)? getGLSL3List\n  : ((qualify.trim() === 'const')? getGLSL1ListLike : getGLSL1ListArray))\n    (type, name, a, qualify, init);\n\n/**\n * Defines the values within textures per-step, as `GLSL` preprocessor macros.\n *\n * These macros define mappings from values to their textures and channels.\n * Caches the result if `macros` generation is enabled, to help reuse shaders.\n *\n * @see {@link hasMacros}\n * @see {@link maps.mapGroups}\n * @see {@link data.toData}\n * @see {@link cacheDef}\n *\n * @example ```javascript\n * const state = { pre: '', steps: 2 };\n * const maps = { values: [2, 4, 1], channelsMax: 4 };\n *\n * // No optimisations - values not packed, single texture output per pass.\n * state.maps = mapGroups({ ...maps, buffersMax: 1, packed: 0 });\n * macroValues(state); // =>\n * '#define texture_0 0\\n'+\n * '#define channels_0 rg\\n'+\n * '\\n'+\n * '#define texture_1 1\\n'+\n * '#define channels_1 rgba\\n'+\n * '\\n'+\n * '#define texture_2 2\\n'+\n * '#define channels_2 r\\n'+\n * '\\n'+\n * '#define textures 3\\n'+\n * '#define passes 3\\n'+\n * '#define stepsPast 1\\n'+\n * '#define steps 2\\n'+\n * '\\n';\n *\n * // Automatically packed values - values across fewer textures/passes.\n * state.maps = mapGroups({ ...maps, buffersMax: 1 });\n * state.size = { entries: 2**5 };\n * macroValues(state); // =>\n * '#define texture_1 0\\n'+\n * '#define channels_1 rgba\\n'+\n * '\\n'+\n * '#define texture_0 1\\n'+\n * '#define channels_0 rg\\n'+\n * '\\n'+\n * '#define texture_2 1\\n'+\n * '#define channels_2 b\\n'+\n * '\\n'+\n * '#define entries 32\\n'+\n * '#define textures 2\\n'+\n * '#define passes 2\\n'+\n * '#define stepsPast 1\\n'+\n * '#define steps 2\\n'+\n * '\\n';\n *\n * // Can bind more texture outputs per pass - values across fewer passes.\n * state.maps = mapGroups({ ...maps, buffersMax: 4 });\n * macroValues(state); // =>\n * '#define texture_1 0\\n'+\n * '#define channels_1 rgba\\n'+\n * '\\n'+\n * '#define texture_0 1\\n'+\n * '#define channels_0 rg\\n'+\n * '\\n'+\n * '#define texture_2 1\\n'+\n * '#define channels_2 b\\n'+\n * '\\n'+\n * '#define entries 32\\n'+\n * '#define textures 2\\n'+\n * '#define passes 1\\n'+\n * '#define stepsPast 1\\n'+\n * '#define steps 2\\n'+\n * '\\n';\n * ```\n *\n * @param {object} state Properties used to generate the macros. See `toData`.\n * @param {string} [on] Any further macro `hooks` specifier; if given, both\n *   the hook key and this specifier are checked (e.g: `key` and `key_on`).\n * @param {string|function|object|false} [state.macros] How macros are handled\n *   or prefixed. See `hasMacros`.\n * @param {string} [state.pre=preDef] Macros prefix; `preDef` if not given.\n * @param {object} state.maps How values are grouped per-`texture` per-pass\n *   per-step.\n * @param {array.<number>} state.maps.values How values of each data item are\n *   grouped into `texture`s. See `mapGroups`.\n * @param {array.<array.<number>>} state.maps.textures The groupings of values\n *   into `texture`s. See `mapGroups`.\n * @param {array} state.maps.passes Passes drawn per-step. See `mapGroups`.\n * @param {array|number} state.steps States drawn across frames. See `toData`.\n * @param {number} [state.bound=boundDef] How many steps are bound as outputs,\n *   unavailable as inputs.\n * @param {object} [state.size] Any size information about the GL resources.\n * @param {number} [state.size.entries] The number of data entries per state,\n *   if given. See `toData`.\n * @param {object|false} [state.cache=cacheDef] Any object to cache any inputs'\n *   results in, `false`y to skip caching; uses `cacheDef` if not given.\n *\n * @returns {string} The `GLSL` preprocessor macros defining the maps from\n *   values to `texture`s and channels.\n */\nexport function macroValues(state, on) {\n  const key = hooks.macroValues;\n  let to = hasMacros(state, key, on);\n\n  if(to != null) { return to; }\n\n  const {\n      maps, steps, bound = boundDef, size, pre: n = preDef,\n      cache = cacheDef\n    } = state;\n\n  const { values, textures, passes: { length: passesL } } = maps;\n  const stepsL = steps.length ?? steps;\n  const entries = size?.entries;\n\n  const c = cache &&\n    `macro@${key}@${n\n      }|${bound}|${id(values)}|${id(textures)}|${stepsL}|${passesL}|${entries}`;\n\n  to = cache?.[c] ??\n    reduce((s, texture, t, _, i = 0) => reduce((s, v) =>\n          s+`#define ${n}texture_${v} ${t}\\n`+\n          `#define ${n}channels_${v} ${rgba.slice(i, i += values[v])}\\n\\n`,\n        texture, s),\n      textures, '')+\n    ((entries)? `#define ${n}entries ${entries}\\n` : '')+\n    `#define ${n}textures ${textures.length}\\n`+\n    `#define ${n}passes ${passesL}\\n`+\n    `#define ${n}stepsPast ${stepsL-bound}\\n`+\n    `#define ${n}steps ${stepsL}\\n`+\n    `#define ${n}bound ${bound}\\n\\n`;\n\n  return ((cache)? cache[c] = to : to);\n}\n\n/**\n * Defines the outputs being drawn to per-pass, as `GLSL` preprocessor macros.\n *\n * These macros define mappings from values to their outputs, if bound.\n * Caches the result if `macros` generation is enabled, to help reuse shaders.\n *\n * @see {@link hasMacros}\n * @see {@link maps.mapGroups}\n * @see {@link data.toData}\n * @see {@link cacheDef}\n *\n * @example ```javascript\n * const maps = { values: [2, 4, 1], channelsMax: 4 };\n *\n * // No optimisations - values not packed, single texture output per pass.\n * const state = {\n *   pre: '', passNow: 0,\n *   maps: mapGroups({ ...maps, buffersMax: 1, packed: 0 })\n * };\n *\n * macroOutput(state); // =>\n * '#define passNow 0\\n'+\n * '\\n'+\n * '#define bound_0 0\\n'+\n * '#define attach_0 0\\n'+\n * '#define output_0 gl_FragData[attach_0].rg\\n'+\n * '\\n';\n *\n * // Automatically packed values - values across fewer textures/passes.\n * state.maps = mapGroups({ ...maps, buffersMax: 1 });\n * macroOutput(state); // =>\n * '#define passNow 0\\n'+\n * '\\n'+\n * '#define bound_1 0\\n'+\n * '#define attach_1 0\\n'+\n * '#define output_1 gl_FragData[attach_1].rgba\\n'+\n * '\\n';\n *\n * // Next pass in this step.\n * ++state.passNow;\n * macroOutput(state); // =>\n * '#define passNow 1\\n'+\n * '\\n'+\n * '#define bound_0 1\\n'+\n * '#define attach_0 0\\n'+\n * '#define output_0 gl_FragData[attach_0].rg\\n'+\n * '\\n'+\n * '#define bound_2 1\\n'+\n * '#define attach_2 0\\n'+\n * '#define output_2 gl_FragData[attach_2].b\\n'+\n * '\\n';\n *\n * // Can bind more texture outputs per pass - values across fewer passes.\n * state.maps = mapGroups({ ...maps, buffersMax: 4 });\n * state.passNow = 0;\n * macroOutput(state); // =>\n * '#define passNow 0\\n'+\n * '\\n'+\n * '#define bound_1 0\\n'+\n * '#define attach_1 0\\n'+\n * '#define output_1 gl_FragData[attach_1].rgba\\n'+\n * '\\n'+\n * '#define bound_0 1\\n'+\n * '#define attach_0 1\\n'+\n * '#define output_0 gl_FragData[attach_0].rg\\n'+\n * '\\n'+\n * '#define bound_2 1\\n'+\n * '#define attach_2 1\\n'+\n * '#define output_2 gl_FragData[attach_2].b\\n'+\n * '\\n';\n * ```\n *\n * @param {object} state Properties for generating the macros. See `toData`:\n * @param {string} [on] Any further macro `hooks` specifier; if given, both\n *   the hook key and this specifier are checked (e.g: `key` and `key_on`).\n * @param {string|function|object|false} [state.macros] How macros are handled.\n *   See `hasMacros`.\n * @param {string} [state.pre=preDef] Macros prefix; `pre` if not given.\n * @param {number} state.passNow The index of the currently active pass.\n * @param {object} state.maps How values are grouped per-texture per-pass\n *   per-step. See `mapGroups`.\n * @param {array.<number>} state.maps.values How values of each data item may be\n *   grouped into textures across passes. See `mapGroups`.\n * @param {array.<array.<number>>} state.maps.textures The groupings of values\n *   into textures. See `mapGroups`.\n * @param {array.<array.<number>>} state.maps.passes The groupings of textures\n *   into passes. See `mapGroups`.\n * @param {object|false} [state.cache=cacheDef] Any object to cache any inputs'\n *   results in, `false`y to skip caching; uses `cacheDef` if not given.\n *\n * @returns {string} `GLSL` preprocessor macros for the pass's bound outputs.\n */\nexport function macroOutput(state, on) {\n  const key = hooks.macroOutput;\n  let to = hasMacros(state, key, on);\n\n  if(to != null) { return to; }\n\n  const { passNow: p, maps, pre: n = preDef, cache = cacheDef } = state;\n  const { values, textures, passes } = maps;\n  const pass = passes[p];\n\n  const c = cache &&\n    `macro@${key}@${n}|${p}|${id(values)}|${id(textures)}|${id(passes)}`;\n\n  to = cache?.[c] ??\n    `#define ${n}passNow ${p}\\n`+\n    reduce((s, texture, bound, _, i = 0) => reduce((s, v) =>\n          s+'\\n'+\n          `#define ${n}bound_${v} ${texture}\\n`+\n          `#define ${n}attach_${v} ${bound}\\n`+\n          `#define ${n}output_${v} gl_FragData[${n}attach_${v}].${\n            rgba.slice(i, i += values[v])}\\n`,\n        textures[texture], s),\n      pass, '')+'\\n';\n\n  return ((cache)? cache[c] = to : to);\n}\n\n/**\n * Defines the texture samples/reads per-pass, as `GLSL` preprocessor macros.\n *\n * The macros define the mapping between the values and those they derive from,\n * as step/texture locations in a `samples` list, and indexes to read values\n * from sampled data in a `reads` list (once sampled into a `data` list, as in\n * `macroTaps` or similar).\n *\n * They're set up as function-like macros that may be called from the shader to\n * initialise the mappings arrays with a given name.\n * Caches the result if `macros` generation is enabled, to help reuse shaders.\n *\n * @see {@link macroTaps}\n * @see {@link hasMacros}\n * @see {@link getGLSLList}\n * @see {@link maps.mapStep}\n * @see {@link data.toData}\n * @see {@link cacheDef}\n *\n * @example ```javascript\n * const values = [2, 4, 1];\n * const derives = [2, , [[1, 0], true]];\n * const maps = { values, derives, channelsMax: 4 };\n *\n * // No optimisations - values not packed, single texture output per pass.\n * const state =\n *   { pre: '', maps: mapStep({ ...maps, buffersMax: 1, packed: 0 }) };\n *\n * // Uses the first pass by default.\n * macroSamples(state); // =>\n * '#define useSamples'+lf+\n *   'const int samples_l = 1;'+lf+\n *   'const ivec2 samples_0 = ivec2(0, 2);\\n'+\n * '// Index macro `samples_i` (e.g: `samples_i(0)`) may be slow, '+\n *   'use name (e.g: `samples_0`) if possible.\\n'+\n * '#define samples_i(i) samples_0\\n'+\n * '\\n'+\n * '#define useReads_0'+lf+\n *   'const int reads_0_l = 1;'+lf+\n *   'const int reads_0_0 = int(0);\\n'+\n * '// Index macro `reads_0_i` (e.g: `reads_0_i(0)`) may be slow, '+\n *   'use name (e.g: `reads_0_0`) if possible.\\n'+\n * '#define reads_0_i(i) reads_0_0\\n'+\n * '\\n';\n *\n * // Next pass in this step - no derives, no samples nor reads.\n * state.passNow = 1;\n * macroSamples(state); // =>\n * '';\n *\n * // Next pass in this step.\n * ++state.passNow;\n * macroSamples(state); // =>\n * '#define useSamples'+lf+\n *   'const int samples_l = 4;'+lf+\n *   'const ivec2 samples_0 = ivec2(1, 0);'+lf+\n *   'const ivec2 samples_1 = ivec2(0, 0);'+lf+\n *   'const ivec2 samples_2 = ivec2(0, 1);'+lf+\n *   'const ivec2 samples_3 = ivec2(0, 2);\\n'+\n * '// Index macro `samples_i` (e.g: `samples_i(0)`) may be slow, '+\n *   'use name (e.g: `samples_0`) if possible.\\n'+\n * '#define samples_i(i) ((i == 3)? samples_3 : ((i == 2)? samples_2 '+\n *   ': ((i == 1)? samples_1 : samples_0)))\\n'+\n * '\\n'+\n * '#define useReads_2'+lf+\n *   'const int reads_2_l = 4;'+lf+\n *   'const int reads_2_0 = int(0);'+lf+\n *   'const int reads_2_1 = int(1);'+lf+\n *   'const int reads_2_2 = int(2);'+lf+\n *   'const int reads_2_3 = int(3);\\n'+\n * '// Index macro `reads_2_i` (e.g: `reads_2_i(0)`) may be slow, '+\n *   'use name (e.g: `reads_2_0`) if possible.\\n'+\n * '#define reads_2_i(i) ((i == 3)? reads_2_3 : ((i == 2)? reads_2_2 '+\n *   ': ((i == 1)? reads_2_1 : reads_2_0)))\\n'+\n * '\\n';\n *\n * // Automatically packed values - values across fewer textures/passes.\n * // Can bind more texture outputs per pass - values across fewer passes.\n * // Also fewer samples where values share derives or textures.\n * state.maps = mapGroups({ ...maps, buffersMax: 4 });\n * state.passNow = 0;\n * macroSamples(state); // =>\n * '#define useSamples'+lf+\n *   'const int samples_l = 3;'+lf+\n *   'const ivec2 samples_0 = ivec2(0, 1);'+lf+\n *   'const ivec2 samples_1 = ivec2(1, 1);'+lf+\n *   'const ivec2 samples_2 = ivec2(0, 0);\\n'+\n * '// Index macro `samples_i` (e.g: `samples_i(0)`) may be slow, '+\n *   'use name (e.g: `samples_0`) if possible.\\n'+\n * '#define samples_i(i) '+\n *   '((i == 2)? samples_2 : ((i == 1)? samples_1 : samples_0))\\n'+\n * '\\n'+\n * '#define useReads_0'+lf+\n *   'const int reads_0_l = 1;'+lf+\n *   'const int reads_0_0 = int(0);\\n'+\n * '// Index macro `reads_0_i` (e.g: `reads_0_i(0)`) may be slow, '+\n *   'use name (e.g: `reads_0_0`) if possible.\\n'+\n * '#define reads_0_i(i) reads_0_0\\n'+\n * '\\n'+\n * '#define useReads_2'+lf+\n *   'const int reads_2_l = 4;'+lf+\n *   'const int reads_2_0 = int(1);'+lf+\n *   'const int reads_2_1 = int(0);'+lf+\n *   'const int reads_2_2 = int(2);'+lf+\n *   'const int reads_2_3 = int(0);\\n'+\n * '// Index macro `reads_2_i` (e.g: `reads_2_i(0)`) may be slow, '+\n *   'use name (e.g: `reads_2_0`) if possible.\\n'+\n * '#define reads_2_i(i) ((i == 3)? reads_2_3 : ((i == 2)? reads_2_2 '+\n *   ': ((i == 1)? reads_2_1 : reads_2_0)))\\n'+\n * '\\n';\n * ```\n *\n * @param {object} state Properties used to generate the macros. See `toData`.\n * @param {string} [on] Any further macro `hooks` specifier; if given, both the\n *   hook key and this specifier are checked (e.g: `key` and `key_on`).\n * @param {string|function|object|false} [state.macros] How macros are handled.\n *   See `hasMacros`.\n * @param {string} [state.pre=preDef] Macros prefix; `preDef` if not given.\n * @param {number} [state.passNow=0] The index of the currently active pass;\n *   uses the first pass if not given.\n * @param {object} state.maps  How `values` are grouped per-texture per-pass\n *   per-step. See `mapGroups`.\n * @param {array.<array.<array.<number>>>} [state.maps.samples] The minimal set\n *   of texture samples to use. See `mapSamples`.\n * @param {array.<array.<array.<number>>>} [state.maps.reads] The mappings from\n *   values to the corresponding `state.samples`. See `mapSamples`.\n * @param {number} [state.glsl=1] The `GLSL` language version.\n *   See `getGLSLList`.\n * @param {object|false} [state.cache=cacheDef] Any object to cache any inputs'\n *   results in, `false`y to skip caching; uses `cacheDef` if not given.\n *\n * @returns {string} `GLSL` preprocessor macros defining the mappings for\n *   samples and reads, for each value.\n */\nexport function macroSamples(state, on) {\n  const key = hooks.macroSamples;\n  let to = hasMacros(state, key, on);\n\n  if(to != null) { return to; }\n\n  const {\n      passNow: p = 0, maps, glsl, pre: n = preDef, cache = cacheDef\n    } = state;\n\n  const { samples, reads } = maps;\n  const passSamples = samples?.[p];\n  const passReads = reads?.[p];\n\n  const c = cache &&\n    `macro@${key}@${n}|${p}|${id(passSamples)}|${id(passReads)}|${glsl}`;\n\n  to = cache?.[c] ??\n    ((!passSamples)? ''\n    : `#define ${n}useSamples${lf+\n        getGLSLList('ivec2', n+'samples', passSamples, 'const', glsl)}\\n`)+\n    ((!passReads)? ''\n    : reduce((s, reads, v) =>\n          `${s}#define ${n}useReads_${v}${lf+\n            getGLSLList('int', n+'reads_'+v, reads, 'const', glsl)}\\n`,\n        passReads, ''));\n\n  return ((cache)? cache[c] = to : to);\n}\n\n/**\n * Defines the samples of textures per-pass, as `GLSL` preprocessor macros.\n *\n * The macros define the minimal sampling of textures for the data the active\n * pass's values derive from; creates a `data` list containing the samples; the\n * `samples` list variable names are required as created by `macroSamples`.\n *\n * Handles sampling states in a flat array of textures, or merged in one texture\n * (in both `sampler2D`, and `sampler3D`/`sampler2DArray` where supported).\n * Merging allows shaders to access past steps by non-constant lookups; e.g:\n * attributes cause `sampler array index must be a literal expression` on\n * `GLSL3` spec and other platforms (e.g: `D3D`); note these need texture repeat\n * wrapping.\n *\n * They're set up as function-like macros that may be called from the shader to\n * initialise the mappings arrays with a given name.\n * Caches the result if `macros` generation is enabled, to help reuse shaders.\n *\n * @see [`sampler array index must be a literal expression`](https://stackoverflow.com/a/60110986/716898)\n * @see [`sampler2DArray`](https://github.com/WebGLSamples/WebGL2Samples/blob/master/samples/texture_2d_array.html)\n * @see [`sampler3D`](https://github.com/WebGLSamples/WebGL2Samples/blob/master/samples/texture_3d.html)\n *\n * @see {@link macroSamples}\n * @see {@link hasMacros}\n * @see {@link getGLSLList}\n * @see {@link maps.mapStep}\n * @see {@link data.toData}\n * @see {@link inputs.toUniforms}\n * @see {@link cacheDef}\n *\n * @example ```javascript\n * const values = [2, 4, 1];\n * const derives = [2, , [[1, 0], true]];\n * const maps = { values, derives, channelsMax: 4 };\n *\n * // No optimisations - values not packed, single texture output per pass.\n * const state =\n *   { pre: '', maps: mapStep({ ...maps, buffersMax: 1, packed: 0 }) };\n *\n * // Uses the first pass by default.\n * macroTaps(state); // =>\n * '@todo';\n *\n * // Next pass in this step - no derives, no samples nor reads.\n * state.passNow = 1;\n * macroTaps(state); // =>\n * '';\n *\n * // Next pass in this step.\n * ++state.passNow;\n * macroTaps(state); // =>\n * '@todo';\n *\n * // Automatically packed values - values across fewer textures/passes.\n * // Can bind more texture outputs per pass - values across fewer passes.\n * // Also fewer samples where values share derives or textures.\n * state.maps = mapGroups({ ...maps, buffersMax: 4 });\n * state.passNow = 0;\n * macroTaps(state); // =>\n * '@todo';\n * ```\n *\n * @param {object} state Properties used to generate the macros. See `toData`.\n * @param {string} [on] Any further macro `hooks` specifier; if given, both\n *   the hook key and this specifier are checked (e.g: `key` and `key_on`).\n * @param {string|function|object|false} [state.macros] How macros are handled.\n *   See `hasMacros`.\n * @param {string} [state.pre=preDef] Macros prefix; `preDef` if not given.\n * @param {number} [state.passNow=0] The index of the currently active pass;\n *   uses the first pass if not given.\n * @param {object} state.maps  How `values` are grouped per-texture per-pass\n *   per-step. See `mapGroups`.\n * @param {array.<array.<array.<number>>>} [state.maps.samples] The minimal set\n *   of texture samples to use. See `mapSamples`.\n * @param {object} [state.merge] Any merged state texture; uses separate state\n *   textures if not given. See `toData`.\n * @param {number} [state.glsl=1] The `GLSL` language version.\n *   See `getGLSLList`.\n * @param {object|false} [state.cache=cacheDef] Any object to cache any inputs'\n *   results in, `false`y to skip caching; uses `cacheDef` if not given.\n *\n * @returns {string} The `GLSL` preprocessor macros defining the minimal\n *   sampling of textures, to suit how states are stored (array of textures, or\n *   all merged into one texture) and supported `GLSL` language features.\n */\nexport function macroTaps(state, on) {\n  const key = hooks.macroTaps;\n  let to = hasMacros(state, key, on);\n\n  if(to != null) { return to; }\n\n  const {\n      passNow: p = 0, maps, merge, glsl, pre: n = preDef,\n      cache = cacheDef\n    } = state;\n\n  const passSamples = maps.samples?.[p];\n  const index = !merge;\n\n  const c = cache &&\n    `macro@${key}@${n}|${p}|${id(passSamples)}|${index}|${glsl}`;\n\n  if((to = cache?.[c]) != null) { return to; }\n\n  const glsl3 = (glsl >= 3);\n  /** Which texture sampling function is available. */\n  const texture = 'texture'+((glsl3)? '' : '2D');\n  /** Short and common names for functions and parameters. */\n  const f = n+'tapState';\n  const tap = '#define '+f;\n  /** Common parameters, passed as `(..., stepBy, textureBy)` */\n  const by = `stepBy, textureBy`;\n  /** Aliases default names for brevity, main functions offer more control. */\n  const aka = `#define ${f}(uv)`+lf+f;\n  const akaBy = `#define ${f}By(uv, ${by})`+lf+f;\n  /** The current `sample`, as `[step, texture]`. */\n  const st = n+'samples_';\n  /** Prefix for private temporary variables. */\n  const t = '_'+n;\n  /** A temporary `array` to pass to `getGLSLList`. */\n  const tapsSamples = cache[key+':tapsSamples'] ??= [];\n  const tapsL = tapsSamples.length = passSamples?.length ?? 0;\n\n  /** The main `texture`-sampling logic. */\n  to = ((index)? '' : `#define ${n}mergedStates\\n\\n`)+\n    ((!tapsL)? ''\n    : ((index)?\n      /** Separate un-merged `texture`s accessed by constant index. */\n      '// States in a `sampler2D[]`; looks up 1D index and 2D `uv`; '+lf+\n        'past steps go later in the list.\\n'+\n      `// Pass constant array index values; \\`textures\\`.\\n`+\n      `// Use \\`${n}data\\` list; ignore temporary \\`${t}\\` names.\\n`+\n      tap+`s(uv, states, textures)`+lf+\n        // Compute before the loop for lighter work.\n        `const int ${t}tlI = int(textures);`+lf+\n        `vec2 ${t}uvI = vec2(uv);`+lf+\n        // Sample into the `data` output list.\n        getGLSLList('vec4', n+'data',\n          map((_, i) => texture+\n              // Offset step, `texture`.\n              `(states[(int(${st+i}.s)*${t}tlI)+int(${st+i}.t)], ${t}uvI)`,\n            passSamples, tapsSamples),\n          '', glsl)+'\\n'+\n      '// States may also be sampled by shifted step/texture.\\n'+\n      `// Pass constant array index values; \\`textures, ${by}\\`.\\n`+\n      `// Use \\`${n}data\\` list; ignore temporary \\`${t}\\` names.\\n`+\n      tap+`sBy(uv, states, textures, ${by})`+lf+\n        // Compute before the loop for lighter work.\n        `const int ${t}tlIB = int(textures);`+lf+\n        `ivec2 ${t}byIB = ivec2(${by});`+lf+\n        `vec2 ${t}uvIB = vec2(uv);`+lf+\n        // Sample into the `data` output list.\n        getGLSLList('vec4', n+'data',\n          map((_, i) =>\n              texture+'(states['+\n                  // Offset step.\n                  `((int(${st+i}.s)+${t}byIB.s)*${t}tlIB)+`+\n                  // Offset `texture`.\n                  `int(${st+i}.t)+${t}byIB.t`+\n                `], ${t}uvIB)`,\n            passSamples, tapsSamples),\n          '', glsl)+'\\n'+\n      '// Preferred aliases: index suits states array constant access.\\n'+\n      aka+`s(uv, ${n}states, ${n}textures)\\n`+\n      akaBy+`sBy(uv, ${n}states, ${n}textures, ${by})\\n`\n    : /** Merged 2D `texture`. */\n      '// States merged to a `sampler2D`, scales 2D `uv` over '+\n        '`[textures, steps]`.\\n'+\n      '// Step from now into the past going upwards in the texture.\\n'+\n      `// Use \\`${n}data\\` list; ignore temporary \\`${t}\\` names.\\n`+\n      tap+`2(uv, states, stepNow, steps, textures)`+lf+\n        // Compute before the loop for lighter work.\n        `vec2 ${t}l2 = vec2(textures, steps);`+lf+\n        `vec2 ${t}uv2 = vec2(uv)/${t}l2;`+lf+\n        // Steps advance in reverse, top-to-bottom.\n        `vec2 ${t}s2 = vec2(1, -1)/${t}l2;`+lf+\n        // Offset `texture`, step.\n        // Each step stored in `texture` top downward at `-stepNow`.\n        // Most recent step to look up is at `-stepNow+1`.\n        `vec2 ${t}i2 = vec2(0, 1)-vec2(0, stepNow);`+lf+\n        // Sample into the `data` output list.\n        getGLSLList('vec4', n+'data',\n          // Would repeat wrap; but `WebGL1` needs power-of-2.\n          map((_, i) =>\n              texture+`(states, `+\n                // Offset `texture`, step.\n                `fract(${t}uv2+fract((vec2(${st+i}).ts+${t}i2)*${t}s2)))`,\n            passSamples, tapsSamples),\n          '', glsl)+'\\n'+\n      '// States may also be sampled by shifted step/texture.\\n'+\n      `// Use \\`${n}data\\` list; ignore temporary \\`${t}\\` names.\\n`+\n      tap+`2By(uv, states, stepNow, steps, textures, ${by})`+lf+\n        // Compute before the loop for lighter work.\n        `vec2 ${t}l2B = vec2(textures, steps);`+lf+\n        `vec2 ${t}uv2B = vec2(uv)/${t}l2B;`+lf+\n        // Steps advance in reverse, top-to-bottom.\n        `vec2 ${t}s2B = vec2(1, -1)/${t}l2B;`+lf+\n        // Offset `texture`, step.\n        // Each step stored in `texture` top downward at `-stepNow`.\n        // Most recent step to look up is at `-stepNow+1`.\n        `vec2 ${t}i2B = vec2(${by}).ts+vec2(0, 1)-vec2(0, stepNow);`+lf+\n        // Sample into the `data` output list.\n        getGLSLList('vec4', n+'data',\n          // Would repeat wrap; but `WebGL1` needs power-of-2.\n          map((_, i) =>\n              texture+`(states, `+\n                // Offset `texture`, step.\n                `fract(${t}uv2B+fract((vec2(${st+i}).ts+${t}i2B)*${t}s2B)))`,\n            passSamples, tapsSamples),\n          '', glsl)+'\\n'+\n      ((!glsl3)?\n        '// Preferred aliases: 2D suits merged texture in GLSL < 1.\\n'+\n        aka+`2(uv, ${n}states, ${n}stepNow, ${n}steps, ${n}textures)\\n`+\n        akaBy+\n          `2By(uv, ${n}states, ${n}stepNow, ${n}steps, ${n}textures, ${by})\\n`\n      : /**\n         * Merged 3D `texture` types, supported from `GLSL3`.\n         * @todo Check and finish this.\n         */\n        '// States merged to `sampler3D` or `sampler2DArray`; 2D `uv` '+\n          'to 3D; scales `x` over `textures`, `z` over `steps` as:\\n'+\n        '// - `sampler3D`: the number of steps; depth, `[0, 1]`.\\n'+\n        '// - `sampler2DArray`: `1` or less; layer, `[0, steps-1]`.\\n'+\n        `// Use \\`${n}data\\` list; ignore temporary \\`${t}\\` names.\\n`+\n        tap+`3(uv, states, stepNow, steps, textures)`+lf+\n          /** @see `...2()` above. */\n          // Compute before the loop for lighter work.\n          `vec2 ${t}l3 = vec2(textures, steps);`+lf+\n          `vec2 ${t}uv3 = vec2(uv)/${t}l3;`+lf+\n          // Offset `texture`.\n          `float ${t}sx3 = 1.0/${t}l3.x;`+lf+\n          // Offset step.\n          `float ${t}s3 = -float(stepNow);`+lf+\n          `float ${t}sz3 = -1.0/${t}l3;`+lf+\n          // Sample into the `data` output list.\n          getGLSLList('vec4', n+'data',\n            // Would repeat wrap; but `sampler2DArray` layer can't.\n            map((_, i) =>\n                texture+'(states, fract(vec3('+\n                  // Offset `texture`.\n                  `${t}uv3.x+(float(${st+i}.t)*${t}sx3), ${t}uv3.y, `+\n                  // Offset step: `sampler3D` depth, `[0, 1]`;\n                  // `sampler2DArray` layer, `[0, steps-1]`.\n                  `(float(${st+i}.s)+${t}s3)*${t}sz3)))`,\n              passSamples, tapsSamples),\n            '', glsl)+'\\n'+\n        '// States may also be sampled by shifted step/`texture`.\\n'+\n        `// Use \\`${n}data\\` list; ignore temporary \\`${t}\\` names.\\n`+\n        tap+`3By(uv, states, stepNow, steps, textures, ${by})`+lf+\n          /** @see `...2By()` above. */\n          // Compute before the loop for lighter work.\n          `vec2 ${t}l3B = vec2(textures, steps);`+lf+\n          `vec2 ${t}uv3B = (vec2(uv)+vec2(textureBy, 0))/${t}l3B;`+lf+\n          // Offset `texture`.\n          `float ${t}sx3B = 1.0/${t}l3B.x;`+lf+\n          // Offset step.\n          `float ${t}s3B = float(stepBy)-float(stepNow);`+lf+\n          `float ${t}sz3B = -1.0/${t}l3B;`+lf+\n          // Sample into the `data` output list.\n          getGLSLList('vec4', n+'data',\n            // Would repeat wrap; but `sampler2DArray` layer can't.\n            map((_, i) =>\n                texture+'(states, fract(vec3('+\n                  // Offset `texture`.\n                  `${t}uv3B.x+(float(${st+i}.t)*${t}sx3B), ${t}uv3B.y, `+\n                  // Offset step: `sampler3D` depth, `[0, 1]`;\n                  // `sampler2DArray` layer, `[0, steps-1]`.\n                  `(float(${st+i}.s)+${t}s3B)*${t}sz3B)))`,\n              passSamples, tapsSamples),\n            '', glsl)+'\\n'+\n        '// Preferred aliases: 3D suits merged texture in `GLSL` 3+.\\n'+\n        aka+`3(uv, ${n}states, ${n}stepNow, ${n}steps, ${n}textures)\\n`+\n        akaBy+\n          `3By(uv, ${n}states, ${n}stepNow, ${n}steps, ${n}textures, ${by})\\n`\n      ))+'\\n');\n\n  return ((cache)? cache[c] = to : to);\n}\n\n/**\n * Defines all `GLSL` preprocessor macro values, `texture` samples, and outputs\n * for the active pass.\n *\n * The macros define the mapping between the active values, their `texture`s and\n * channels, bound outputs, and other macros useful for a draw pass.\n * Caches the result if `macros` generation is enabled, to help reuse shaders.\n *\n * @see {@link hasMacros}\n * @see {@link macroValues}\n * @see {@link macroOutput}\n * @see {@link macroTaps}\n * @see {@link macroSamples}\n * @see {@link maps.mapStep}\n * @see {@link data.toData}\n *\n * @example ```javascript\n * const values = [2, 4, 1];\n * const derives = [2, , [[1, 0], true]];\n *\n * // Automatically packed values - values across fewer `texture`s/passes.\n * // Only a single `texture` output per pass - values across more passes.\n * const state = {\n *   passNow: 0, steps: 2, size: { entries: 2**5 },\n *   maps: mapStep({ values, derives, channelsMax: 4, buffersMax: 1 })\n * };\n *\n * macroPass(state); // =>\n * '#define gpgpu_texture_1 0\\n'+\n * '#define gpgpu_channels_1 rgba\\n'+\n * '\\n'+\n * '#define gpgpu_texture_0 1\\n'+\n * '#define gpgpu_channels_0 rg\\n'+\n * '\\n'+\n * '#define gpgpu_texture_2 1\\n'+\n * '#define gpgpu_channels_2 b\\n'+\n * '\\n'+\n * '#define gpgpu_entries 32\\n'+\n * '#define gpgpu_textures 2\\n'+\n * '#define gpgpu_passes 2\\n'+\n * '#define gpgpu_stepsPast 1\\n'+\n * '#define gpgpu_steps 2\\n'+\n * '\\n'+\n * '#define gpgpu_passNow 0\\n'+\n * '\\n'+\n * '#define gpgpu_bound_1 0\\n'+\n * '#define gpgpu_attach_1 0\\n'+\n * '#define gpgpu_output_1 gl_FragData[gpgpu_attach_1].rgba\\n'+\n * '\\n';\n *\n * // Next pass and extra step.\n * ++state.steps;\n * ++state.passNow;\n * state.pre = '';\n * macroPass(state); // =>\n * '#define texture_1 0\\n'+\n * '#define channels_1 rgba\\n'+\n * '\\n'+\n * '#define texture_0 1\\n'+\n * '#define channels_0 rg\\n'+\n * '\\n'+\n * '#define texture_2 1\\n'+\n * '#define channels_2 b\\n'+\n * '\\n'+\n * '#define entries 32\\n'+\n * '#define textures 2\\n'+\n * '#define passes 2\\n'+\n * '#define stepsPast 2\\n'+\n * '#define steps 3\\n'+\n * '\\n'+\n * '#define passNow 1\\n'+\n * '\\n'+\n * '#define bound_0 1\\n'+\n * '#define attach_0 0\\n'+\n * '#define output_0 gl_FragData[attach_0].rg\\n'+\n * '\\n'+\n * '#define bound_2 1\\n'+\n * '#define attach_2 0\\n'+\n * '#define output_2 gl_FragData[attach_2].b\\n'+\n * '\\n'+\n * '#define useSamples'+lf+\n *   'const int samples_l = 3;'+lf+\n *   'const ivec2 samples_0 = ivec2(0, 1);'+lf+\n *   'const ivec2 samples_1 = ivec2(1, 1);'+lf+\n *   'const ivec2 samples_2 = ivec2(0, 0);\\n'+\n * '// Index macro `samples_i` (e.g: `samples_i(0)`) may be slow, '+\n *   'use name (e.g: `samples_0`) if possible.\\n'+\n * '#define samples_i(i)'+lf+\n *   '((i == 2)? samples_2 : ((i == 1)? samples_1 : samples_0))\\n'+\n * '\\n'+\n * '#define useReads_0'+lf+\n *   'const int reads_0_l = 1;'+lf+\n *   'const int reads_0_0 = int(0);\\n'+\n * '// Index macro `reads_0_i` (e.g: `reads_0_i(0)`) may be slow, '+\n *   'use name (e.g: `reads_0_0`) if possible.\\n'+\n * '#define reads_0_i(i) reads_0_0\\n'+\n * '\\n'+\n * '#define useReads_2'+lf+\n *   'const int reads_2_l = 4;'+lf+\n *   'const int reads_2_0 = int(1);'+lf+\n *   'const int reads_2_1 = int(0);'+lf+\n *   'const int reads_2_2 = int(2);'+lf+\n *   'const int reads_2_3 = int(0);\\n'+\n * '// Index macro `reads_2_i` (e.g: `reads_2_i(0)`) may be slow, '+\n *   'use name (e.g: `reads_2_0`) if possible.\\n'+\n * '#define reads_2_i(i) ((i == 3)? reads_2_3 : ((i == 2)? reads_2_2 '+\n *   ': ((i == 1)? reads_2_1 : reads_2_0)))\\n'+\n * '\\n'+\n * '// States in a `sampler2D[]`; looks up 1D index and 2D `uv`.\\n'+\n * '@todo';\n * ```\n *\n * @param {object} state Properties for generating the macros. See `toData`\n *   and `mapGroups`.\n * @param {string} [on] Any further macro `hooks` specifier; if given, both\n *   the hook key and this specifier are checked (e.g: `key` and `key_on`).\n *\n * @returns {string} The `GLSL` preprocessor macros defining the mappings for\n *   values, `texture`s, channels, bound outputs of the active pass, etc. See\n *   `macroValues`, `macroOutput`, and `macroSamples`.\n */\nexport const macroPass = (state, on) =>\n  hasMacros(state, hooks.macroPass, on) ??\n    macroValues(state, on)+macroOutput(state, on)+macroSamples(state, on)+\n    macroTaps(state, on);\n\nexport default macroPass;\n","/**\n * The `gpgpu` update step.\n *\n * Connects inputs to the `GL` state and renders an update step.\n *\n * @module\n * @category JS\n *\n * @todo [Fix `@callback`/`@typedef`](https://github.com/TypeStrong/typedoc/issues/1896):\n *   nested `@param`; omits `@return`/`@see`/`@this`\n */\n\nimport each from '@epok.tech/fn-lists/each';\nimport wrap from '@epok.tech/fn-lists/wrap';\n\nimport { macroPass } from './macros';\n\nimport {\n    vertDef, preDef, positionsDef, countDef, stepMaxDef,\n    clearPassDef, copyFrameDef, copyImageDef\n  } from './const';\n\n/**\n * Convenience to get the currently active `framebuffer`.\n *\n * @see {@link toStep}\n * @see {@link data.toData}\n *\n * @param {object} state The `gpgpu` state.\n * @param {object[][]} state.passes Passes per step. See `toData`.\n * @param {number} [state.stepNow] Any active state step index. See `toStep`.\n * @param {number} [state.passNow] Any active draw pass index. See `toStep`.\n *\n * @returns {object} Any active step's active pass object, of the given `state`.\n */\nexport const getPass = ({ passes: ps, stepNow: s, passNow: p }) =>\n  wrap(s, ps)?.[p];\n\n/**\n * Merged `texture` update, called upon each pass.\n *\n * Copies the active pass's output into the merged `texture`, from each of its\n * `framebuffer` attachments one by one (to support multiple draw buffers).\n * Matches the lookup logic defined in `macroTaps`.\n *\n * @todo Update docs.\n *\n * @see [SO reading from multiple `framebuffer`s](https://stackoverflow.com/a/34160982/716898)\n * @see {@link getPass}\n * @see {@link state.framebuffer}\n * @see {@link state.texture}\n * @see {@link data.toData}\n * @see {@link maps.mapGroups}\n * @see {@link macros.macroTaps}\n *\n * @param {object} state A `gpgpu` state of the active pass.\n * @param {{color:texture[],map:number[]}[][]} state.passes Passes per\n *   step; any active one's found via `getPass`, with:\n *   - `color`: `array` of data-`texture`s.\n *   - `map`: `array` of `number`s, showing how the `texture`s are grouped\n *     per-pass. See `getPass`, `toData`, and `mapGroups`.\n * @param {merge} state.merge The merged `texture` to update.\n * @param {number} [state.stepNow] The currently active state step, if any.\n *\n * @returns {texture} The merged `texture`, updated by the active pass's output;\n *   matches the lookup logic defined in `macroTaps`.\n */\nexport function updateMerge(state) {\n  const {\n      merge, stepNow: s, size,\n      copyFrame: cf = copyFrameDef, copyImage: ci = copyImageDef\n    } = state;\n\n  const { color, map: pass } = getPass(state);\n  const { all: { texture }, next: { framebuffer } } = merge;\n  const to = texture?.subimage;\n  let f = framebuffer;\n\n  // Silent exit if there's not enough info ready now to perform the update.\n  if(!(to && f && color && pass && (s || (s === 0)))) { return texture; }\n\n  /** Handle `object`s or `regl`-like extended `function`s. */\n  (f.call !== Function.call) && (f = f.call);\n\n  const { steps: sl, width: w, height: h } = size;\n  /** Start at the top of the `texture`, move down row-per-step and wrap. */\n  const y = (s%sl)*h;\n\n  /**\n   * Reusable `framebuffer` binds and copies each of the pass `texture`s along\n   * the merged `texture`.\n   */\n  each((c, i) =>\n      (cf.color = c) &&\n        f.call(f, cf).use.call(f, () => to.call(texture, ci, pass[i]*w, y)),\n    color);\n\n  return texture;\n}\n\n/**\n * Creates a `gpgpu` update step function, for use with a `gpgpu` state object.\n *\n * @todo Make this fully and consistently extensible; improve `pipeline`.\n * @todo Example.\n *\n * @see {@link buffer}\n * @see {@link command}\n * @see {@link subimage}\n * @see {@link onStep}\n * @see {@link onPass}\n * @see {@link getPass}\n * @see {@link data.toData}\n * @see {@link maps.mapGroups}\n * @see {@link macros.macroPass}\n * @see {@link inputs.toUniforms}\n *\n * @param {object} api An API for `GL` resources.\n * @param {buffer} [api.buffer] Function to set up a `GL` buffer.\n * @param {clear} [api.clear] Function to clear `GL` view or `framebuffer`.\n * @param {command} [api.command=api] Function to create a `GL` render pass,\n *   given options, to be called later with options; `api` if not given.\n * @param {object} state The `gpgpu` state to use. See `toData` and `mapGroups`.\n * @param {object} state.maps How values are grouped per-`texture` per-pass\n *   per-step. See `mapGroups`.\n * @param {number[][]} state.maps.passes How textures are grouped into passes.\n *   See `mapGroups`.\n * @param {object} [state.merge] Any merged state `texture`; uses separate state\n *   textures if not given.\n * @param {object} [state.merge.texture] Any `GL` `texture` of `state.merge`.\n * @param {subimage} [state.merge.texture.subimage] A function to update part of\n *   the merge `GL` `texture` object data. See `subimage`.\n * @param {function} [state.merge.update] Hook to update, if any; if not given,\n *   `state.merge.texture` is updated here with active states upon each pass.\n *\n *   The default merged `texture` is laid out as `[texture, step]` on the\n *   `[x, y]` axes, respectively; if other layouts are needed, this merge update\n *   hook can be given to use as-is, and the setup and lookup logic in their\n *   respective hooks.\n *\n *   See `toData` and `macroTaps`.\n * @param {string} [state.pre=preDef] The namespace prefix; `preDef` by default.\n * @param {string} [state.vert=vertDef] The step vertex shader `GLSL`; a\n *   simple flat screen shader if not given.\n * @param {string} state.frag The step fragment shader `GLSL`.\n * @param {object} [state.uniforms=toUniforms(state)] The step uniforms;\n *   modifies any given. See `toUniforms`.\n * @param {number[]|buffer} [state.positions=positionsDef()] The step position\n *   `attribute`s; 3 points of a large flat triangle if not given.\n * @param {number} [state.count=state.positions.length*0.5] The `number` of\n *   elements/`attribute`s to draw.\n * @param {object} [state.pipeline] Any `GL` command properties to mix in\n *   overriding those ones added here; all passed to `api.command`.\n * @param {string} [state.vert=vertDef] Vertex `GLSL` code to prepend `macro`s.\n * @param {string[]} [state.verts] Preprocesses and caches vertex `GLSL`\n *   code per-pass if given, otherwise processes just-in-time before each pass.\n * @param {string} [state.frag] Fragment `GLSL` to prepend `macro`s.\n * @param {string[]} [state.frags] Preprocesses and caches fragment `GLSL`\n *   code per-pass, otherwise processes just-in-time before each pass.\n * @param {onStep} [onStep] Callback upon each step.\n * @param {onPass} [onPass] Callback upon each pass.\n * @param {object} [to=state] The `object` to set up. Modifies the given `state`\n *   `object` by default.\n *\n * @returns {object} `to` The given `to` `object`; set up with a `gpgpu` step\n *   `function` and related properties, to use with the `gpgpu` state.\n * @returns {string} `to.vert` The given/new `state.vert` vertex shader `GLSL`.\n * @returns {string} `to.frag` The given `state.frag` fragment shader `GLSL`.\n * @returns {string[]} `[to.verts]` Any cached pre-processed vertex shaders\n *   `GLSL`, if `state.verts` was given.\n * @returns {string[]} `[to.frags]` Any cached pre-processed fragment shaders\n *   `GLSL`, if `state.verts` was given.\n * @returns {object} `to.uniforms` The given `state.uniforms`.\n * @returns {number} `to.count` The given or new `state.count`.\n * @returns {buffer} `to.positions` The given or new `state.positions`; via\n *   `api.buffer`.\n * @returns {command} `to.pass` A `GL` command `function` to draw a given pass;\n *   via `api`/`api.command`.\n * @returns {function} `to.step` The main `function` to perform all the draw\n *   pass `GL` commands for a given state step.\n */\nexport function toStep(api, state = {}, to = state) {\n  /** Handle `object`s or `regl`-like extended `function`s, for `command`. */\n  const { buffer, clear, command = api } = api;\n\n  const {\n      merge, pipeline, verts, frag, frags, uniforms, attributes, maps,\n      // Update any default vertex `shader` to use the given `pre`.\n      pre: n = preDef, vert = vertDef.replaceAll(preDef, n || ''),\n      // Any vertex `count`, and `positions` to be passed to `buffer`.\n      count = countDef, positions = positionsDef\n    } = state;\n\n  // Ensure any properties changed are included.\n  to.pre = n;\n  to.vert = vert;\n  to.count = count;\n  to.positions = buffer(positions);\n\n  // May pre-process and keep the `shader`s for all passes in advance.\n  if(verts || frags) {\n    // Keep the current pass.\n    const { passNow } = state;\n\n    verts && (to.verts = verts);\n    frags && (to.frags = frags);\n\n    each((pass, p) => {\n        // Create `macro`s for this pass in advance.\n        state.passNow = p;\n        // Specify a `'vert'` type `shader` for any per-`shader` `macro` hooks.\n        verts && (verts[p] ??= macroPass(state, 'vert')+vert);\n        // Specify a `'frag'` type `shader` for any per-`shader` `macro` hooks.\n        frags && (frags[p] ??= macroPass(state, 'frag')+frag);\n      },\n      maps.passes);\n\n    // Set the pass back to what it was.\n    state.passNow = passNow;\n  }\n\n  /** A `command` to render `pass` updates via a `GL` `pipeline` description. */\n  to.pass = command(to.pipeline = {\n    // Uses the full-screen vertex `shader` state by default.\n    vert(_, s) {\n      const { passNow: p, step: { vert: v = vert, verts: vs = verts } } = state;\n\n      // Specify a `'vert'` type `shader` for any per-`shader` `macro` hooks.\n      return vs?.[p] ?? macroPass(s, 'vert')+v;\n    },\n    frag(_, s) {\n      const { passNow: p, step: { frag: f = frag, frags: fs = frags } } = state;\n\n      // Specify a `'frag'` type `shader` for any per-`shader` `macro` hooks.\n      return fs?.[p] ?? macroPass(s, 'frag')+f;\n    },\n    /** Need an active `pass` with `framebuffer`, or may draw to the screen. */\n    framebuffer: (_, s) => getPass(s)?.framebuffer,\n    count, uniforms,\n    attributes: {\n      [n+'position']: (_, s) => s.positions,\n      ...attributes\n    },\n    depth: { enable: false },\n    /** Any `pipeline` properties shallow-override others of the same name. */\n    ...pipeline\n  });\n\n  /** Any merged `texture`'s update, set up if not already given. */\n  merge && ((to.merge = merge).update ??= updateMerge);\n\n  /** Executes the next step and all its passes. */\n  to.step = (state = to) => {\n    const {\n        steps, merge, pass, onPass, onStep,\n        stepMax = stepMaxDef, clearPass = clearPassDef\n      } = state;\n\n    let { stepNow = 0 } = state;\n\n    /** Guard for number overflow; set to 0 to ignore or handle in `GLSL`. */\n    stepNow = state.stepNow = (stepNow+1)%(stepMax || Infinity);\n\n    const mergeUpdate = merge?.update;\n    const stepProps = onStep?.(state, wrap(stepNow, steps)) ?? state;\n\n    each((p, i) => {\n        stepProps.passNow = i;\n\n        const passProps = onPass?.(stepProps, p) ?? stepProps;\n\n        /** @todo Remove `clear` call if unnecessary? */\n        ((clearPass.framebuffer = getPass(passProps)?.framebuffer) &&\n          clear(clearPass));\n\n        pass(passProps);\n        // Update any merged `texture` upon each pass.\n        mergeUpdate?.(passProps);\n      },\n      stepProps.maps.passes);\n\n    delete clearPass.framebuffer;\n\n    return state;\n  };\n\n  return to;\n}\n\n/**\n * @todo [Fix `@callback`/`@typedef`](https://github.com/TypeStrong/typedoc/issues/1896):\n *   nested `@param`; omits `@return`/`@see`/`@this`\n *\n * @callback onStep\n * Callback upon each step.\n *\n * **See**\n * - {@link toStep}\n * - {@link data.toData}\n * - {@link state.framebuffer}\n *\n * **Returns**\n * - A `stepProps` object to use for each of the step's next passes; or\n *   `null`ish to use the given `props`.\n *\n * @param {object} [props] The `props` passed to `run`.\n * @param {framebuffer[]} step The `framebuffer`s for `props.stepNow` from\n *   `props.steps`, where the next state step will be drawn. See `toData`.\n *\n * @returns {object}\n */\n\n/**\n * @todo [Fix `@callback`/`@typedef`](https://github.com/TypeStrong/typedoc/issues/1896):\n *   nested `@param`; omits `@return`/`@see`/`@this`\n *\n * @callback onPass\n * Callback upon each pass.\n *\n * **See**\n * - {@link toStep}\n * - {@link maps.mapGroups}\n *\n * **Returns**\n * - A `passProps` object to use for the render `command` call; or `null`ish to\n *   use the given `stepProps`.\n *\n * @param {object} [stepProps] The `props` passed to `run` via any `onStep`.\n * @param {number[]} pass The maps for the next pass. See `mapGroups`.\n *\n * @returns {object}\n */\n\n/** A wrapper around `updateMerge`, handy for testing. */\nfunction updateMergeTest(state, update = updateMerge, after = 2) {\n  const { color, map: pass } = getPass(state);\n  const { merge: { all, next }, stepNow: s, passNow: p, size, maps } = state;\n  const { channels } = all;\n  const { steps: sl, shape: [w, h], merge: { shape: [wl, hl] } } = size;\n  const tl = maps.textures.length;\n  const y = (s%sl)*h;\n  const lc = y*tl*w;\n  const to = update(state);\n  let f = next?.framebuffer;\n\n  /** Handle `object`s or `regl`-like extended `function`s. */\n  (f.call !== Function.call) && (f = f?.call);\n\n  console.warn(s, p, pass, ':');\n  console.warn('- l', 0, 'r', tl*w, 'w', w, 'wl', wl);\n  console.warn('- t', y, 'b', y+h, 'h', h, 'hl', hl);\n  console.warn('- c', channels, 'lc', lc*channels, 'rc', (lc+(w*h))*channels,\n    'sc', w*h*channels, 'slc', wl*hl*channels);\n\n  f.call(f, { color: to }).use.call(f, () =>\n    console.warn(Array.prototype.reduce.call(regl.read(), (o, v, i) =>\n        o+((i)? ',\\t' : '')+\n        ((!i)? ''\n        : ((i%(tl*w*h*channels) === 0)?\n            `\\n${'='.repeat(100)}step${'='.repeat(100)}\\n`\n        : ((i%(tl*w*channels) === 0)? '\\n'\n        : ((i%(w*channels) === 0)? ' || \\t'\n        : ((i%channels === 0)? ' / \\t' : '')))))+\n        (i*1e-3).toFixed(3).slice(2)+': '+((v)? v.toFixed(2) : '___'),\n      '\\n')));\n\n  if(s && after && s%(sl*after) === 0) { debugger; }\n\n  return to;\n}\n\nexport default toStep;\n","/**\n * **Main `index.js` - see [`readme`](..)**\n *\n * [![`gl-gpgpu` particles demo](media://demo-particles-regl-frames.png)](..)\n *\n * [GPGPU](https://en.wikipedia.org/wiki/General-purpose_computing_on_graphics_processing_units)\n * state-stepping - declaratively maps optimal draw passes, shaders, `GL`\n * resources, inputs, outputs - lets you focus on your logic, BYO-renderer.\n *\n * Decouples logic from rendering approach/engine.\n * Each module and hook may be used as given, or piecemeal, or overridden.\n *\n * @module (root)\n * @category Root\n * @category JS\n */\n\nimport './api';\nimport { glslRx } from './const';\nimport { mapStep } from './maps';\nimport { toData } from './data';\nimport { toUniforms } from './uniforms';\nimport { toStep } from './step';\n\nconst { isFinite } = Number;\n\n/**\n * Parse a `GLSL` version into a `number`.\n *\n * @see {@link const.glslRx}\n *\n * @param {string|number} version A `GLSL` version `string`, expected in a `GL`\n *   parameter `SHADING_LANGUAGE_VERSION` format to parse into a `number`, from\n *   any first found version number or the full given `string` otherwise; or a\n *   `number`, to use as-is.\n *\n * @returns {number} A `GLSL` version `number`, parsed from the given `version`.\n */\nexport const getGLSL = (version) =>\n  ((isFinite(version))? version\n  : parseFloat(version?.match?.(glslRx)?.[0] ?? version, 10));\n\n/**\n * Sets up all the maps, data, inputs, and commands for a `gpgpu` process.\n *\n * Hooks up each main part in order into the complete process. Each part may\n * also be used individually for more custom behaviour; see their documentation.\n *\n * @see {@link maps.mapStep}\n * @see {@link maps.mapGroups}\n * @see {@link maps.mapSamples}\n * @see {@link maps.useBuffers}\n * @see {@link data.toData}\n * @see {@link uniforms.toUniforms}\n * @see {@link step.toStep}\n * @see {@link macros.macroPass}\n *\n * @param {object} api An API for `GL` resources. See `toData` and `toStep`.\n * @param {object} [api.limits=api] A map of `GL` resource limits.\n * @param {number} [api.limits.maxDrawbuffers] The maximum number of `GL`\n *   `texture`s a `framebuffer` can bind in a single draw call.\n * @param {object} [state=\\{\\}] State properties to set up; a new `object` by\n *   default. See `toData`, `toUniforms`, and `toStep`.\n * @param {object} [state.maps] How values are grouped per-`texture` per-pass\n *   per-step. Sets up new maps if not given or missing its mapped properties.\n *   See `mapStep`.\n * @param {number|false} [state.maps.buffersMax=api.limits.maxDrawbuffers]\n *   Maximum `texture`s that may be bound as buffer outputs per-pass. Multiple\n *   passes per-step are needed to output all `values` if they're spread across\n *   more `textures` than this `number`. Uses one pass and binds no output if\n *   given `false`y; useful for side-effects with no state outputs, like\n *   rendering. See `useBuffers`, `mapGroups`, and `toData`.\n * @param {object} [to=state] The `object` to set up. Modifies the given `state`\n *   object by default.\n *\n * @returns {object} The given `to` data `object`; set up with data resources\n *   for a `gpgpu` process. See `mapStep`, `toData`, `toUniforms`, `toStep`.\n */\nexport function gpgpu(api, state = {}, to = state) {\n  const { maxDrawbuffers, glsl: apiGLSL } = api.limits ?? api;\n  const { maps = {}, glsl = apiGLSL } = state;\n  const { buffersMax } = maps;\n\n  /** The parsed `GLSL` version. */\n  to.glsl = getGLSL(glsl);\n\n  /**\n   * Temporary updates to set up `maps` then `state`.\n   * Any `maps.buffersMax` supersedes any `maxDrawbuffers` from the `api`.\n   */\n  maps.buffersMax ??= maxDrawbuffers;\n  state.maps = mapStep(maps, to.maps ??= {});\n\n  toData(api, state, to);\n  toUniforms(state, to.uniforms ??= {});\n  toStep(api, state, to);\n\n  // Undo any temporary changes made above to the given `maps` and `state`.\n  /** @todo Improve, this is awkward. */\n  (state.maps = maps).buffersMax = buffersMax;\n\n  return to;\n}\n\nexport default gpgpu;\n","/**\n * How many vertexes for a given form to cover each entry's steps of state:\n * - If 2 states or form are given, gives a setup of pairs for a line segment\n *   between each entry's steps of state using `gl.LINES`.\n * - If fewer than 2 states or form are given, gives a setup for a point at each\n *   entry's steps of state using `gl.POINTS`.\n *\n * Possibly useful for other forms too.\n *\n * Corresponds to the indexing logic in the `indexForms` `GLSL` function.\n *\n * @module\n * @category JS\n *\n * @see {@link index-forms/index-states.glsl!}\n * @see {@link index-forms/index-entries.glsl!}\n * @see [`gl.LINES`](https://webglfundamentals.org/webgl/lessons/webgl-points-lines-triangles.html)\n *\n * @param {number} [states=1] How many steps of state each entry has.\n * @param {number} [form=2] How many steps of state each form covers.\n * @param {number} [count=1] How many entries, if any; result to be multiplied\n *   externally if not given.\n *\n * @returns {number} The number of vertexes needed for the given `form` to cover\n *   all steps of `states`; over all `count` if given, to be multiplied\n *   externally if not given.\n *\n * @remarks [[include:src/index-forms/readme.md]]\n */\nexport const indexForms = (states = 1, form = 2, count = 1) =>\n  Math.max(1, (states-form)+1)*form*count;\n\nexport default indexForms;\n","import { EPS, HALF_PI, PI } from \"./api.js\";\n/**\n * Linear interpolation without clamping. Computes `a + (b - a) * t`\n *\n * @param a - start value\n * @param b - end value\n * @param t - interpolation factor [0..1]\n */\nexport const mix = (a, b, t) => a + (b - a) * t;\n/**\n * Bilinear interpolation of given values (`a`,`b`,`c`,`d`).\n *\n * @example\n * ```ts\n * c    d\n * +----+\n * |    |\n * +----+\n * a    b\n * ```\n *\n * @param a - BL value\n * @param b - BR value\n * @param c - TL value\n * @param d - TR value\n * @param u - 1st interpolation factor\n * @param v - 2nd interpolation factor\n */\nexport const mixBilinear = (a, b, c, d, u, v) => {\n    const iu = 1 - u;\n    const iv = 1 - v;\n    return a * iu * iv + b * u * iv + c * iu * v + d * u * v;\n};\n/**\n * Computes quadratic bezier interpolation for normalized value `t`.\n *\n * @param a\n * @param b\n * @param c\n * @param t\n */\nexport const mixQuadratic = (a, b, c, t) => {\n    const s = 1 - t;\n    return a * s * s + b * 2 * s * t + c * t * t;\n};\n/**\n * Computes cubic bezier interpolation for normalized value `t`.\n *\n * @param a\n * @param b\n * @param c\n * @param d\n * @param t\n */\nexport const mixCubic = (a, b, c, d, t) => {\n    const t2 = t * t;\n    const s = 1 - t;\n    const s2 = s * s;\n    return a * s2 * s + b * 3 * s2 * t + c * 3 * t2 * s + d * t2 * t;\n};\n/**\n * Returns hermite interpolation of `a, b, c, d` at normalized position `t`,\n * where `a` and `d` are used as predecessor/successor of `b` / `c` and only\n * inform the tangent of the interpolation curve. The interpolated result is\n * that of `b` and `c`.\n *\n * Assumes all inputs are uniformly spaced. If that's not the case, use\n * {@link mixCubicHermite} with one of the tangent generators supporting\n * non-uniform spacing of points.\n *\n * See: https://www.desmos.com/calculator/j4gf8g9vkr\n *\n * Source:\n * https://www.musicdsp.org/en/latest/Other/93-hermite-interpollation.html\n *\n * - {@link mixCubicHermite}\n * - {@link tangentCardinal}\n * - {@link tangentDiff3}\n *\n * @param a -\n * @param b -\n * @param c -\n * @param d -\n * @param t -\n */\nexport const mixHermite = (a, b, c, d, t) => {\n    const y1 = 0.5 * (c - a);\n    const y2 = 1.5 * (b - c) + 0.5 * (d - a);\n    return ((y2 * t + a - b + y1 - y2) * t + y1) * t + b;\n};\n/**\n * Computes cubic-hermite interpolation between `a` / `b` at normalized\n * time `t` and using respective tangents `ta` / `tb`.\n *\n * https://en.wikipedia.org/wiki/Cubic_Hermite_spline\n *\n * - {@link mixHermite}\n * - {@link tangentCardinal}\n * - {@link tangentDiff3}\n *\n * @param a -\n * @param ta -\n * @param b -\n * @param tb -\n * @param t -\n */\nexport const mixCubicHermite = (a, ta, b, tb, t) => {\n    const s = t - 1;\n    const t2 = t * t;\n    const s2 = s * s;\n    const h00 = (1 + 2 * t) * s2;\n    const h10 = t * s2;\n    const h01 = t2 * (3 - 2 * t);\n    const h11 = t2 * s;\n    return h00 * a + h10 * ta + h01 * b + h11 * tb;\n};\n/**\n * Similar to {@link mixCubicHermite}, but takes 4 control values (uniformly\n * spaced) and computes tangents automatically. Returns `b` iff `t=0` and `c`\n * iff `t=1.0`.\n *\n * @param a -\n * @param b -\n * @param c -\n * @param d -\n * @param t -\n */\nexport const mixCubicHermiteFromPoints = (a, b, c, d, t) => {\n    d *= 0.5;\n    const aa = -0.5 * a + 1.5 * b - 1.5 * c + d;\n    const bb = a - 2.5 * b + 2 * c - d;\n    const cc = -0.5 * a + 0.5 * c;\n    const dd = b;\n    const t2 = t * t;\n    return t * t2 * aa + t2 * bb + t * cc + dd;\n};\n/**\n * Bicubic interpolation of given 4x4 sample values (in row major order, i.e.\n * `s00..s03` = 1st row).\n *\n * @remarks\n * Result will not be clamped and might fall outside the total range of the\n * input samples.\n *\n * @param s00 -\n * @param s01 -\n * @param s02 -\n * @param s03 -\n * @param s10 -\n * @param s11 -\n * @param s12 -\n * @param s13 -\n * @param s20 -\n * @param s21 -\n * @param s22 -\n * @param s23 -\n * @param s30 -\n * @param s31 -\n * @param s32 -\n * @param s33 -\n * @param u -\n * @param v -\n */\nexport const mixBicubic = (s00, s01, s02, s03, s10, s11, s12, s13, s20, s21, s22, s23, s30, s31, s32, s33, u, v) => mixCubicHermiteFromPoints(mixCubicHermiteFromPoints(s00, s01, s02, s03, u), mixCubicHermiteFromPoints(s10, s11, s12, s13, u), mixCubicHermiteFromPoints(s20, s21, s22, s23, u), mixCubicHermiteFromPoints(s30, s31, s32, s33, u), v);\n/**\n * Helper function for {@link mixCubicHermite}. Computes cardinal tangents based\n * on point neighbors of a point B (not given), i.e. `a` (predecessor) and `c`\n * (successor) and their times (defaults to uniformly spaced). The optional\n * `tension` parameter can be used to scale the tangent where 0.0 produces a\n * Cardinal spline tangent and 1.0 a Catmull-Rom (opposite to the Wikipedia\n * ref).\n *\n * https://en.wikipedia.org/wiki/Cubic_Hermite_spline#Cardinal_spline\n *\n * @param prev -\n * @param next -\n * @param scale -\n * @param ta -\n * @param tc -\n */\nexport const tangentCardinal = (prev, next, scale = 0.5, ta = 0, tc = 2) => scale * ((next - prev) / (tc - ta));\n/**\n * Helper function for {@link mixCubicHermite}. Computes tangent for `curr`,\n * based on 3-point finite difference, where `prev` & `next` are `curr`'s\n * neighbors and the `tX` the three points' respective time values. The latter\n * are equally spaced by default (each 1.0 apart).\n *\n * Using this function with equal spacing of 1.0 and together with\n * {@link mixCubicHermite} will produce same results as the somewhat optimized\n * variant {@link mixHermite}.\n *\n * https://en.wikipedia.org/wiki/Cubic_Hermite_spline#Finite_difference\n *\n * @param prev -\n * @param curr -\n * @param next -\n * @param ta -\n * @param tb -\n * @param tc -\n */\nexport const tangentDiff3 = (prev, curr, next, ta = 0, tb = 1, tc = 2) => 0.5 * ((next - curr) / (tc - tb) + (curr - prev) / (tb - ta));\n/**\n * HOF interpolator. Takes a timing function `f` and interval `[from,to]`.\n * Returns function which takes normalized time (in [0,1] range) as single arg\n * and returns interpolated value.\n *\n * @param f -\n * @param from -\n * @param to -\n */\nexport const tween = (f, from, to) => (t) => mix(from, to, f(t));\n/**\n * Circular interpolation (ease out): `sqrt(1 - (1 - t)^2)`\n *\n * @remarks\n * Reference: https://www.desmos.com/calculator/tisoiazdrw\n *\n * @param t - interpolation factor [0..1]\n */\nexport const circular = (t) => {\n    t = 1 - t;\n    return Math.sqrt(1 - t * t);\n};\n/**\n * Inverse/flipped version of {@link circular} (ease in).\n *\n * @remarks\n * Reference: https://www.desmos.com/calculator/tisoiazdrw\n *\n * @param t - interpolation factor [0..1]\n */\nexport const invCircular = (t) => 1 - circular(1 - t);\n/**\n * Zoomlens interpolation with customizable lens position, behavior and\n * strength.\n *\n * @remarks\n * Lens position must be given in (0..1) interval. Lens strength must be in\n * [-1,1] range. If negative, the lens will be bundling values near `pos`, if\n * positive the lens has dilating characteristics and will spread values near\n * `pos` towards the edges.\n *\n * Also see {@link schlick} for an alternative approach.\n *\n * @example\n * ```ts\n * // interpolated position in [100..400] interval for given `t`\n * y = mix(100, 400, lens(0.5, 1, t));\n *\n * // or build tween function via `tween()`\n * f = tween(partial(lens, 0.5, 1), 100, 400);\n *\n * f(t)\n * ```\n *\n * @param pos - lens pos\n * @param strength - lens strength\n * @param t - interpolation factor [0..1]\n */\nexport const lens = (pos, strength, t) => {\n    const impl = strength > 0 ? invCircular : circular;\n    const tp = 1 - pos;\n    const tl = t <= pos ? impl(t / pos) * pos : 1 - impl((1 - t) / tp) * tp;\n    return mix(t, tl, Math.abs(strength));\n};\nexport const cosine = (t) => 1 - (Math.cos(t * PI) * 0.5 + 0.5);\nexport const decimated = (n, t) => Math.floor(t * n) / n;\nexport const bounce = (k, amp, t) => {\n    const tk = t * k;\n    return 1 - ((amp * Math.sin(tk)) / tk) * Math.cos(t * HALF_PI);\n};\n/**\n * Exponential easing.\n *\n * - `ease = 1` -> linear\n * - `ease > 1` -> ease in\n * - `ease < 1` -> ease out\n *\n * @param ease - easing behavior [0.0 .. ∞]\n * @param t -\n */\nexport const ease = (ease, t) => Math.pow(t, ease);\n/**\n * Impulse generator. Peaks at `t = 1/k`\n *\n * @param k - impulse width (higher values => shorter impulse)\n */\nexport const impulse = (k, t) => {\n    const h = k * t;\n    return h * Math.exp(1 - h);\n};\nexport const gain = (k, t) => t < 0.5 ? 0.5 * Math.pow(2 * t, k) : 1 - 0.5 * Math.pow(2 - 2 * t, k);\nexport const parabola = (k, t) => Math.pow(4.0 * t * (1.0 - t), k);\nexport const cubicPulse = (w, c, t) => {\n    t = Math.abs(t - c);\n    return t > w ? 0 : ((t /= w), 1 - t * t * (3 - 2 * t));\n};\n/**\n * Unnormalized Sinc function: sin(x)/x. Returns 1 for t=0.\n *\n * @remarks\n * https://en.wikipedia.org/wiki/Sinc_function\n *\n * @param k -\n * @param t -\n */\nexport const sinc = (t) => (t !== 0 ? Math.sin(t) / t : 1);\n/**\n * Normalized Sinc function, returns sinc(π*k*t).\n *\n * @remarks\n * https://en.wikipedia.org/wiki/Sinc_function\n *\n * @see {@link sinc}\n *\n * @param k -\n * @param t -\n */\nexport const sincNormalized = (k, t) => sinc(PI * k * t);\n/**\n * Lanczos filter. Returns `sinc(πt)sinc(πt/a)` iff `t` in (-a,a) interval, else\n * returns 0.\n *\n * @remarks\n * Interactive graph: https://www.desmos.com/calculator/pmypqgefle\n *\n * @param a -\n * @param t -\n */\nexport const lanczos = (a, t) => t !== 0 ? (-a < t && t < a ? sinc(PI * t) * sinc((PI * t) / a) : 0) : 1;\n/**\n * Sigmoid function for inputs arounds center bias.\n *\n * @remarks\n * Updated in v3.0.0 to add bias value to satisfy more use cases. Use\n * {@link sigmoid01} for old behavior.\n *\n * @param bias - center value (for which result = 0.5)\n * @param k - steepness\n * @param t - input value\n */\nexport const sigmoid = (bias, k, t) => t != bias ? 1 / (1 + Math.exp(-k * (t - bias))) : 0.5;\n/**\n * Sigmoid function for inputs in [0..1] interval. Center bias = 0.5.\n *\n * @param k - steepness\n * @param t - input value\n */\nexport const sigmoid01 = (k, t) => sigmoid(0.5, k, t);\n/**\n * Sigmoid function for inputs in [-1..+1] interval. Center bias = 0\n *\n * @param k -\n * @param t -\n */\nexport const sigmoid11 = (k, t) => sigmoid(0, k, t);\n/**\n * Generalized Schlick bias gain curve, based on:\n * https://arxiv.org/abs/2010.09714\n *\n * @remarks\n * Interactive graph:\n * https://www.desmos.com/calculator/u6bkm5rb7t\n *\n * @param a - curve strength. recommended (0..64]\n * @param b - pivot position [0..1]\n * @param t - input val [0..1]\n */\nexport const schlick = (a, b, t) => t <= b\n    ? (b * t) / (t + a * (b - t) + EPS)\n    : ((1 - b) * (t - 1)) / (1 - t - a * (b - t) + EPS) + 1;\n/**\n * Computes exponential factor to interpolate from `a` to `b` over\n * `num` steps. I.e. multiplying `a` with the returned factor will yield\n * `b` after `num` steps. All args must be > 0.\n *\n * @param a -\n * @param b -\n * @param num -\n */\nexport const expFactor = (a, b, num) => (b / a) ** (1 / num);\n/**\n * Computes gaussian bell curve for given center `bias` and `sigma` (spread).\n *\n * @remarks\n * Interactive graph: https://www.desmos.com/calculator/aq6hdzxprv\n *\n * @param bias -\n * @param sigma -\n * @param t -\n */\nexport const gaussian = (bias, sigma, t) => Math.exp(-((t - bias) ** 2) / (2 * sigma * sigma));\n","import { defOpS } from \"./compile/emit.js\";\nimport { ARGS_VNV, MATH2A_N, SARGS_VV } from \"./compile/templates.js\";\nexport const [maddNS, maddNS2, maddNS3, maddNS4] = defOpS(MATH2A_N(\"*\", \"+\"), ARGS_VNV, SARGS_VV);\n","import { defOpS } from \"./compile/emit.js\";\nimport { NEW_OUT, SARGS_V, SET } from \"./compile/templates.js\";\nexport const [setS, setS2, setS3, setS4] = defOpS(SET, \"o,a\", SARGS_V, \"o,a\", \"o\", NEW_OUT);\n","import { DEG2RAD, HALF_PI, INV_HALF_PI, PI, RAD2DEG, TAU } from \"./api.js\";\n/**\n * Returns vector of `[sin(theta)*n, cos(theta)*n]`.\n *\n * @param theta -\n * @param n -\n */\nexport const sincos = (theta, n = 1) => [\n    Math.sin(theta) * n,\n    Math.cos(theta) * n,\n];\n/**\n * Returns vector of `[cos(theta)*n, sin(theta)*n]`.\n *\n * @param theta -\n * @param n -\n */\nexport const cossin = (theta, n = 1) => [\n    Math.cos(theta) * n,\n    Math.sin(theta) * n,\n];\n/**\n * Projects `theta` into [0 .. 2π] interval.\n *\n * @param theta -\n */\nexport const absTheta = (theta) => ((theta %= TAU), theta < 0 ? TAU + theta : theta);\nexport const absInnerAngle = (theta) => ((theta = Math.abs(theta)), theta > PI ? TAU - theta : theta);\n/**\n * Returns smallest absolute angle difference between `a` and `b`.\n * Result will be in [0 .. π] interval.\n *\n * @param a -\n * @param b -\n */\nexport const angleDist = (a, b) => absInnerAngle(absTheta((b % TAU) - (a % TAU)));\n/**\n * Like `Math.atan2`, but always returns angle in [0 .. TAU) interval.\n *\n * @param y -\n * @param x -\n */\nexport const atan2Abs = (y, x) => absTheta(Math.atan2(y, x));\n/**\n * Returns quadrant ID (0-3) of given angle (in radians).\n *\n * @param theta -\n */\nexport const quadrant = (theta) => (absTheta(theta) * INV_HALF_PI) | 0;\n/**\n * Converts angle to degrees.\n *\n * @param theta - angle in radians\n */\nexport const deg = (theta) => theta * RAD2DEG;\n/**\n * Converts angle to radians.\n *\n * @param theta - angle in degrees\n */\nexport const rad = (theta) => theta * DEG2RAD;\n/**\n * Cosecant. Approaches `±Infinity` for `theta` near multiples of π.\n *\n * @param theta - angle in radians\n */\nexport const csc = (theta) => 1 / Math.sin(theta);\n/**\n * Secant. Approaches `±Infinity` for `theta` near π/2 ± nπ\n *\n * @param theta - angle in radians\n */\nexport const sec = (theta) => 1 / Math.cos(theta);\n/**\n * Cotangent. Approaches `±Infinity` for `theta` near multiples of π.\n *\n * @param theta - angle in radians\n */\nexport const cot = (theta) => 1 / Math.tan(theta);\n/**\n * Law of Cosines. Takes length of two sides of a triangle and the inner\n * angle (in radians) between them. Returns length of third side.\n *\n * @param a -\n * @param b -\n * @param gamma -\n */\nexport const loc = (a, b, gamma) => Math.sqrt(a * a + b * b - 2 * a * b * Math.cos(gamma));\n/**\n * Approximates cos(xπ) for x in [-1,1]\n *\n * @param x -\n */\nexport const normCos = (x) => {\n    const x2 = x * x;\n    return 1.0 + x2 * (-4 + 2 * x2);\n};\nconst __fastCos = (x) => {\n    const x2 = x * x;\n    return 0.99940307 + x2 * (-0.49558072 + 0.03679168 * x2);\n};\n/**\n * Fast cosine approximation using {@link normCos} (polynomial). Max. error\n * ~0.00059693\n *\n * In [0 .. 2π] interval, approx. 18-20% faster than `Math.cos` on V8.\n *\n * @param theta - in radians\n */\nexport const fastCos = (theta) => {\n    theta %= TAU;\n    theta < 0 && (theta = -theta);\n    switch ((theta * INV_HALF_PI) | 0) {\n        case 0:\n            return __fastCos(theta);\n        case 1:\n            return -__fastCos(PI - theta);\n        case 2:\n            return -__fastCos(theta - PI);\n        default:\n            return __fastCos(TAU - theta);\n    }\n};\n/**\n * {@link fastCos}\n *\n * @param theta - in radians\n */\nexport const fastSin = (theta) => fastCos(HALF_PI - theta);\n","const mi = -Infinity;\nconst mx = Infinity;\nexport const MIN2 = Object.freeze([mi, mi]);\nexport const MAX2 = Object.freeze([mx, mx]);\nexport const ONE2 = Object.freeze([1, 1]);\nexport const ZERO2 = Object.freeze([0, 0]);\nexport const X2 = Object.freeze([1, 0]);\nexport const Y2 = Object.freeze([0, 1]);\nexport const MIN3 = Object.freeze([mi, mi, mi]);\nexport const MAX3 = Object.freeze([mx, mx, mx]);\nexport const ONE3 = Object.freeze([1, 1, 1]);\nexport const ZERO3 = Object.freeze([0, 0, 0]);\nexport const X3 = Object.freeze([1, 0, 0]);\nexport const Y3 = Object.freeze([0, 1, 0]);\nexport const Z3 = Object.freeze([0, 0, 1]);\nexport const MIN4 = Object.freeze([mi, mi, mi, mi]);\nexport const MAX4 = Object.freeze([mx, mx, mx, mx]);\nexport const ONE4 = Object.freeze([1, 1, 1, 1]);\nexport const ZERO4 = Object.freeze([0, 0, 0, 0]);\nexport const X4 = Object.freeze([1, 0, 0, 0]);\nexport const Y4 = Object.freeze([0, 1, 0, 0]);\nexport const Z4 = Object.freeze([0, 0, 1, 0]);\nexport const W4 = Object.freeze([0, 0, 0, 1]);\n","import { cossin } from \"@thi.ng/math/angle\";\nimport { add2 } from \"./add.js\";\nimport { ZERO2, ZERO3 } from \"./api.js\";\nimport { setC3 } from \"./setc.js\";\nimport { vop } from \"./vop.js\";\nconst cos = Math.cos;\nconst sin = Math.sin;\n/**\n * Converts polar vector `v` to cartesian coordinates and adds optional\n * `offset`. See {@link polar} for reverse operation. If `out` is null,\n * modifies `v` in place.\n *\n * @param out -\n * @param v -\n * @param offset -\n */\nexport const cartesian = vop(1);\n/**\n * Converts 2D polar vector `v` to cartesian coordinates and adds\n * optional `offset`. See {@link polar} for reverse operation. If `out` is\n * null, modifies `v` in place.\n *\n * @param out -\n * @param v -\n * @param offset -\n */\nexport const cartesian2 = cartesian.add(2, (out, a, b = ZERO2) => add2(out || a, cossin(a[1], a[0]), b));\n/**\n * Converts 3D polar vector `v` to cartesian coordinates and adds\n * optional `offset`. See {@link polar} for reverse operation. If `out` is\n * null, modifies `v` in place.\n *\n * @param out -\n * @param v -\n * @param offset -\n */\nexport const cartesian3 = cartesian.add(3, (out, a, b = ZERO3) => {\n    const r = a[0];\n    const theta = a[1];\n    const phi = a[2];\n    const ct = cos(theta);\n    return setC3(out || a, r * ct * cos(phi) + b[0], r * ct * sin(phi) + b[1], r * sin(theta) + b[2]);\n});\n","import { setC2 } from '@thi.ng/vectors/setc';\n\nconst { sin, cos } = Math;\n\nexport const axis2 = (a, to = []) => setC2(to, cos(a), sin(a));\n\nexport default axis2;\n","import { mix } from '@thi.ng/math/mix';\nimport { maddNS2 } from '@thi.ng/vectors/maddns';\nimport { setS } from '@thi.ng/vectors/sets';\nimport { cartesian3 } from '@thi.ng/vectors/cartesian';\n\nimport { axis2 } from './axis2';\n\nconst { random, min, PI: pi, TAU: tau = pi*2 } = Math;\n\n/**\n * Shake a point around while idling; a wandering polar arc along the surface of\n * a sphere around the given position.\n *\n * @param {number[]} at The original given position.\n * @param {object} state The shake state.\n * @param {number[]} state.to The shaken output position.\n * @param {number[]} state.pole The `pole` axis from `at` to the surface; polar.\n * @param {number} state.radius How far from `at` the `pole` extends.\n * @param {number} state.turn The angle the sphere polar angles are turned by.\n * @param {number} state.yaw The angular speed that the `turn` can yaw by.\n * @param {number} state.spin The angular speed to `turn` the `pole` axis by.\n * @param {number} state.wait How long to idle before reaching `radius`.\n * @param {number} state.curve A power to curve the idling to reach `radius`.\n * @param {number} idle How long has been spent idling.\n * @param {number} dt The time elapsed since the last frame.\n *\n * @returns {number[]} The position shaken `to`, or the given `at` if it'd be\n *   the same.\n */\nexport function shake(at, state, idle, dt) {\n  const {\n      radius, yaw, spin, turn, wait: w, curve = 5,\n      to = state.to = [], pole = state.pole = [0, random()*tau, random()*tau]\n    } = state;\n\n  if(!(pole[0] = w && idle && (min(idle/w, 1)**curve)*radius)) { return at; }\n\n  const t = state.turn = ((turn == null)? random()*tau\n    : (turn+(yaw && dt && mix(-pi, pi, random())*yaw*dt)%tau));\n\n  /** Scale `turn` direction by `spin` angular speed to add to `pole` angles. */\n  spin && dt && maddNS2(pole, axis2(t, to), spin*tau*dt, pole, 1, 0, 1);\n  cartesian3(to, pole, at);\n\n  const atl = at.length;\n\n  /** Just copy over any other values following the first position values. */\n  return (((to.length = atl) > 3)? setS(to, at, atl-3, 3, 3) : to);\n}\n\nexport default shake;\n","/** Demo implementation of 3D particle Verlet/Euler integration simulation. */\n\nimport getRegl from 'regl';\nimport { clamp } from '@thi.ng/math/interval';\nimport { fit, fitClamped } from '@thi.ng/math/fit';\nimport { identity44 } from '@thi.ng/matrices/identity';\nimport { rotationAroundAxis44 } from '@thi.ng/matrices/rotation-around-axis';\nimport { perspective } from '@thi.ng/matrices/perspective';\nimport { lookAt } from '@thi.ng/matrices/lookat';\nimport { concat } from '@thi.ng/matrices/concat';\nimport { mulM44 } from '@thi.ng/matrices/mulm';\nimport { mulV344 } from '@thi.ng/matrices/mulv';\nimport { invert44 } from '@thi.ng/matrices/invert';\nimport { mulN2 } from '@thi.ng/vectors/muln';\nimport { div2 } from '@thi.ng/vectors/div';\nimport { divN2 } from '@thi.ng/vectors/divn';\nimport { sub3 } from '@thi.ng/vectors/sub';\nimport { add3 } from '@thi.ng/vectors/add';\nimport { invert2 } from '@thi.ng/vectors/invert';\nimport { setC2, setC3 } from '@thi.ng/vectors/setc';\nimport { dist3 } from '@thi.ng/vectors/dist';\nimport { normalize3 } from '@thi.ng/vectors/normalize';\nimport { CGS } from 'gsl-const';\nimport timer from '@epok.tech/fn-time';\nimport reduce from '@epok.tech/fn-lists/reduce';\nimport map from '@epok.tech/fn-lists/map';\nimport each from '@epok.tech/fn-lists/each';\nimport range from '@epok.tech/fn-lists/range';\nimport wrap from '@epok.tech/fn-lists/wrap';\n\nimport gpgpu from '../../src';\n\nimport { extensionsFloat, extensionsHalfFloat, optionalExtensions }\n  from '../../src/const';\n\nimport { macroPass } from '../../src/macros';\nimport { mapStep } from '../../src/maps';\nimport { toUniforms } from '../../src/uniforms';\nimport { getDrawIndexes } from '../../src/size';\nimport indexForms from '../../src/index-forms';\n\nimport stepFrag from './step.frag.glsl';\nimport drawVert from './draw.vert.glsl';\nimport drawFrag from './draw.frag.glsl';\n\nimport { shake } from './shake';\n\nconst { GRAVITATIONAL_CONSTANT: ugc, GRAV_ACCEL: g } = CGS;\nconst { abs, floor, random, sin, cos, min, max, sqrt, log2, PI: pi } = Math;\nconst tau = pi*2;\n\nself.gpgpu = gpgpu;\nself.macroPass = macroPass;\nself.mapStep = mapStep;\nself.toUniforms = toUniforms;\nself.getDrawIndexes = getDrawIndexes;\nself.indexForms = indexForms;\n\nconst canvas = document.querySelector('canvas');\n\n// Scroll to the top.\nconst scroll = () => canvas.scrollIntoView(true);\nconst scrollDefer = () => setTimeout(scroll, 0);\n\nfunction toggleError(e) {\n  canvas.classList[(e)? 'add' : 'remove']('hide');\n  document.querySelector('.error').classList[(e)? 'remove' : 'add']('hide');\n  document.querySelector('aside').classList[(e)? 'add' : 'remove']('show');\n}\n\ntoggleError();\nscrollDefer();\n\n// Handle query parameters.\n\nconst getQuery = (search = location.search) => new URLSearchParams(search);\n\nfunction setQuery(entries, q = getQuery()) {\n  entries &&\n    each(([k, v = null]) => ((v === null)? q.delete(k) : q.set(k, v)), entries);\n\n  return q;\n}\n\nconst query = getQuery();\n\n// Check for any extensions that need to be applied.\nconst fragDepth = query.get('depth') === 'frag';\n\n// Set up GL.\n\nconst extend = {\n  required: extensionsHalfFloat,\n  optional: ((fragDepth)?\n      [...extensionsFloat, ...optionalExtensions, 'ext_frag_depth']\n    : [...extensionsFloat, ...optionalExtensions])\n};\n\nconst pixelRatio = max(devicePixelRatio, 1.5) || 1.5;\n\nconst regl = self.regl = getRegl({\n  canvas, pixelRatio,\n  extensions: extend.required, optionalExtensions: extend.optional,\n  onDone: toggleError\n});\n\nconsole.group('Extensions');\n\nconsole.log('required',\n  (extend.required &&\n    reduce((o, e) => o+(o && '; ')+e+': '+regl.hasExtension(e),\n      extend.required, '')));\n\nconsole.log('optional',\n  (extend.optional &&\n    reduce((o, e) => o+(o && '; ')+e+': '+regl.hasExtension(e),\n      extend.optional, '')));\n\nconsole.groupEnd();\n\n/**\n * How many state values (channels) are tracked independently of others.\n * The order here is the order used in the shaders and generated macros, but for\n * optimal lookups may be `packed` into channels/textures/passes differently.\n */\nconst valuesMap = (new Map())\n  // Position, uses 3 channels.\n  .set('position', 3)\n  // Motion, uses 3 channels.\n  .set('motion', 3)\n  // Life, uses 2 channels.\n  .set('life', 2);\n\nconst values = [];\nconst valuesIndex = {};\n\nvaluesMap.forEach((v, k) => valuesIndex[k] = values.push(v)-1);\nconsole.log(values, '`values`');\n\n/** Limits of this device and these `values`. */\nconst {\n    maxTextureUnits, maxTextureSize, lineWidthDims, pointSizeDims, depthBits\n  } = regl.limits;\n\n/**\n * Whether to merge states into one texture; separate textures if not given.\n * Merge by default for maximum platform compatibility.\n */\nconst merge = query.get('merge') !== 'false';\n\n/**\n * Better stay farther under maximum texture size, for errors/crashes.\n *\n * @todo Drawing issues with `scale` and `steps` both over 10.\n */\nconst limits = { scale: [0, log2(maxTextureSize)] };\n\n/** A scale that seems to work well from experimentation with `GL` limits. */\nconst niceScale = clamp(8, ...limits.scale);\n\n/** The data entries scale, from user input or default best-guess. */\nconst scale = clamp((parseFloat(query.get('scale') || niceScale, 10) || 0),\n  ...limits.scale);\n\n/** How many steps are used for output. */\nconst bound = 1;\n\n/** The steps of state to track. */\nlimits.steps = [\n  1+bound,\n  // Maximum steps must fit the maximum total texture size if merging.\n  floor((merge)? maxTextureSize/(2**scale)\n    // Maximum steps must fit the maximum total texture units if separate.\n    : (maxTextureUnits-bound)/reduce((s, v) => s+v, values)*4)\n];\n\nconsole.log('limits', limits, regl.limits);\n\n/**\n * 2 active states, as many others as can be bound; at least 2 past states\n * needed for Verlet integration, 1 for Euler integration.\n */\nconst steps = floor(clamp(parseFloat(query.get('steps'), 10) || 2+bound,\n  ...limits.steps));\n\n/** How many past steps (not bound to outputs) are in the GPGPU state. */\nconst stepsPast = steps-bound;\n/** Whether to allow Verlet integration; within available resource limits. */\nconst canVerlet = stepsPast > 1;\n\n/** Whether to prefill initial states before spawning, or start with all `0`. */\nconst prefill = query.get('prefill') !== 'false';\n\n/**\n * Form vertexes to draw; if not given, uses trails of 'lines' if there are\n * enough steps, or 'points' if not.\n */\nconst form = floor(parseFloat(query.get('form'), 10) || 0);\n\n/** How wide the `form` is; to be scaled by `viewScale`. */\nconst wide = parseFloat(query.get('wide') || 1e-3*pixelRatio, 10) || 0;\n\n/** The amount to spin the scene initially. */\nconst spin0 = parseFloat(query.get('spin-0') || 1e-2*pi, 10) || 0;\n/** The pace to spin the scene each frame. */\nconst spinPace = parseFloat(query.get('spin-pace') || 5e-5, 10) || 0;\n\n/** How much to scale the spout speeds. */\nconst spoutPace = parseFloat(query.get('spout-pace') || 1, 10) || 0;\n/** Offset on the z-axis from the origin to the source. */\nconst gapZ = parseFloat(query.get('gap-z') || 0.15, 10) || 0;\n/** How much to shake the source around while idling. */\nconst shakeSource = parseFloat(query.get('shake-source') || 2e-2, 10) || 0;\n/** How much to shake the sink around while idling. */\nconst shakeSink = parseFloat(query.get('shake-sink') || 2e-2, 10) || 0;\n\n/** How many older state positions to fizz around, and other inputs. */\nconst fizz = {\n  at: parseFloat(query.get('fizz') || clamp(steps, 5, 2e2), 10) || 0,\n  max: parseFloat(query.get('fizz-max') || fitClamped(steps, 5, 20, 2e-3, 4e-3),\n    10) || 0,\n  rate: parseFloat(query.get('fizz-rate') || 5e-4, 10) || 0,\n  curve: parseFloat(query.get('fizz-curve') || 1.7, 10) || 0\n};\n\n/** Hue range between 2 values. */\nconst hues = query.getAll('hue');\n\n// Parse any present hues, fill any missing hues, using only up to 2 hues.\nmap((h, i) => parseFloat(h || ((i)? hues[i-1]+(60/360) : 0), 10) || 0,\n  range(hues, null, hues.length, hues.length = 2), 0);\n\n/** Use lights, dark, or unlit. */\nconst lit = query.get('lit');\n/** How much particle speed lights them up. */\nconst paceLit = parseFloat(query.get('pace-lit') || 1, 10) || 0;\n\n/** The material's roughness. */\nconst rough = parseFloat(query.get('rough') || 0.7, 10) || 0;\n/** The material's albedo. */\nconst albedo = parseFloat(query.get('albedo') || 0.9, 10) || 0;\n/** The material's skin thickness. */\nconst skin = parseFloat(query.get('skin') || 1, 10) || 0;\n\n/**\n * Variable-step (delta-time) if given `false`y/`NaN`; fixed-step (add-step)\n * if given another number; uses default fixed-step if not given.\n */\nconst timeQuery = query.get('timestep');\n\nconst timestepDef = 1e3/60;\n/** Whether to use a fixed timestep or render variably as soon as possible. */\nconst timestep = parseFloat(timeQuery ?? timestepDef, 10) || null;\n/** Whether to primarily control the source or sink */\nconst flipPointer = query.get('flip-pointer') === 'true';\n/** Whether the guide is open by default. */\nconst guide = query.get('guide') !== 'false';\n\nconsole.log(location.search+':\\n', ...([...query.entries()].flat()), '\\n',\n  'merge:', merge, 'scale:', scale, 'steps:', steps, 'prefill:', prefill,\n  'timestep:', timestep, 'depth:', fragDepth, 'form:', form, 'wide:', wide,\n  'spin0:', spin0, 'spinPace:', spinPace, 'spoutPace:', spoutPace,\n  'gapZ:', gapZ, 'shakeSource:', shakeSource, 'shakeSink:', shakeSink,\n  'flipPointer:', flipPointer, 'fizz:', fizz, 'hues:', hues, 'lit:', lit,\n  'paceLit:', paceLit, 'rough:', rough, 'albedo:', albedo, 'skin:', skin,\n  'guide:', guide);\n\n// Set up the links.\n\nfunction setupLink(a, to) {\n  const { search, hash } = a;\n  const has = (search.length > 1) && getQuery(search).entries();\n\n  return a.href = '?'+\n    setQuery((has && to)? [...has, ...to] : ((has)? [...has] : to))+hash;\n}\n\nsetupLink(document.querySelector('#verlet'),\n  [['steps', 2+bound], ['scale', 9]]);\n\nsetupLink(document.querySelector('#euler'), [['steps', 1+bound], ['scale', 9]]);\nsetupLink(document.querySelector('#trail'), [['steps', 9+bound], ['scale', 8]]);\nsetupLink(document.querySelector('#trace'), [['steps', 3e2], ['scale', 4]]);\nsetupLink(document.querySelector('#bubbles'));\nsetupLink(document.querySelector('#molecular'));\nsetupLink(document.querySelector('#millions'));\n\nsetupLink(document.querySelector('#form'),\n  [['form', ((form)? ((form+1)%3 || null) : 1)]]);\n\nsetupLink(document.querySelector('#lit'),\n  [['lit', ((lit === 'dark')? false : ((lit === 'false')? null : 'dark'))]]);\n\nsetupLink(document.querySelector('#spin'),\n  [['spin-pace', ((spinPace)? 0 : null)]]);\n\nsetupLink(document.querySelector('#gap'), [['gap-z', ((gapZ)? 0 : null)]]);\n\nsetupLink(document.querySelector('#timestep'),\n  [['timestep', ((timeQuery == null)? '' : null)]]);\n\nsetupLink(document.querySelector('#merge'),\n  [['merge', ((merge)? false : null)]]);\n\nsetupLink(document.querySelector('#guide'),\n  [['guide', ((guide)? false : null)]]);\n\n/** Scroll back if links are clicked or change hash; just want highlights. */\nfunction hashScroll() {\n  const h = location.hash;\n\n  if(!document.querySelector(`.link-preset${h}, .link-tweak${h}`)) { return; }\n\n  scroll();\n  scrollDefer();\n}\n\neach((l) => l.addEventListener('click', hashScroll),\n  document.querySelectorAll('.link-preset, .link-tweak'));\n\naddEventListener('hashchange', hashScroll);\n\n// Toggle the guide according to query.\ndocument.querySelector('#flip-guide').checked = guide;\n\n// Set up state flow - read and write the `gl-gpgpu` state each step.\n\n/** Map how any next output `values` derive from any past input `values`. */\nconst derives = [];\n\n// Next `position` state `values` derive from past state `values`:\nderives[valuesIndex.position] = [\n  // `position`, 2nd `step` past.\n  { value: valuesIndex.position, step: wrap(1, stepsPast) },\n  // `position`, 1st `step` past.\n  valuesIndex.position,\n  // `motion`, 1st `step` past.\n  valuesIndex.motion,\n  // `life`, 1st `step` past.\n  valuesIndex.life\n];\n\n// Next `motion` state `values` derive from past state `values`:\nderives[valuesIndex.motion] = [\n  // `motion`, 1st `step` past.\n  valuesIndex.motion,\n  // `life`, 1st `step` past.\n  valuesIndex.life,\n  // `position`, 1st `step` past.\n  valuesIndex.position\n];\n\n// Next `life` state `values` derive from past state `values`:\nderives[valuesIndex.life] = [\n  // `life`, farthest `step` past.\n  { value: valuesIndex.life, step: wrap(-1, stepsPast) },\n  // `life`, 1st `step` past.\n  valuesIndex.life\n];\n\nconsole.log(derives, '`derives`');\n\n/** Shake around a position, via the `state.props`. */\nconst toShake = (k) => (_, { props: { [k]: s, timer: { idle, dt } } }) => {\n  const { to, at, shake: state } = s;\n\n  return shake(to ?? at, state, idle, dt);\n};\n\n/** The main `gl-gpgpu` state. */\nconst state = gpgpu(regl, {\n  // Logic given as state `values`, `gl-gpgpu` maps optimal inputs and outputs.\n  maps: {\n    // How many state `values` (channels) are tracked independently of others.\n    values,\n    // Map how next output `values` derive from any past input `values`.\n    derives\n  },\n  // How many steps of state to track.\n  steps,\n  // How many states are bound to frame-buffer outputs at any step.\n  bound,\n  // How many `entries` to track, here encoded as the power-of-2 size, per side\n  // of each data-`texture`: `(2**scale)**2`; can also be given in other ways.\n  scale,\n  // Whether to merge all states into one data-`texture`, or leave all\n  // data-`texture`s separate.\n  merge,\n  // Data type according to platform capabilities.\n  // @todo Seems to move differently with `'half float'` Verlet integration.\n  type: ((extensionsFloat.every(regl.hasExtension))? 'float' : 'half float'),\n  // Configure macro hooks, globally or per-shader.\n  macros: {\n    // No `macros` needed for the `vert` shader; all other `macros` generated.\n    vert: false\n  },\n  // A fragment shader to compute each state step, with `gl-gpgpu` macros.\n  // Vertex shaders can also be given.\n  frag: ((prefill)? '#define prefill\\n\\n' : '')+stepFrag,\n  // Cache in `frags` all `macros` prepended to `frag` shader per-pass.\n  frags: [],\n  // Custom `uniforms` to be passed to shaders, with those `gl-gpgpu` mixes in.\n  uniforms: {\n    dt: (_, { props: { timer: { dt, rate: r } } }) => dt*r,\n    dt0: (_, { props: { timer: { dts, rate: r } } }) => dts[0]*r,\n    dt1: (_, { props: { timer: { dts, rate: r } } }) => dts[1]*r,\n    time: (_, { props: { timer: { time: t, rate: r } } }) => t*r,\n    loop: (_, { props: { timer: { time: t, rate: r, loop: l } } }) =>\n      abs((((t*r)+l)%(l*2))-l),\n\n    // Shake the source around while idling.\n    source: toShake('source'),\n    // Shake the sink around while idling.\n    sink: toShake('sink'),\n\n    lifetime: regl.prop('props.lifetime'),\n    useVerlet: regl.prop('props.useVerlet'),\n    epsilon: regl.prop('props.epsilon'),\n    moveCap: regl.prop('props.moveCap'),\n    g: regl.prop('props.g'),\n    pace: regl.prop('props.pace'),\n\n    // One option in these arrays is used, by Euler/Verlet respectively.\n    spout: (_, { props: { spout: ss, useVerlet: u } }) => ss[+u],\n  },\n  // Custom properties, namespaced to avoid clashing with `gl-gpgpu` ones.\n  props: {\n    // Time control and state.\n    timer: timer({\n      // Fixed-step (add-step), or real-time (variable delta-time).\n      step: timestep || '-',\n      now: ((timestep)? undefined : () => regl.now()*1e3),\n      // Track past 2 time-differences for Verlet integration.\n      dts: range(2, 0),\n      // Amount of time without applicable user-interaction.\n      idle: 0,\n      // Speed up or slow down the passage of time.\n      rate: 1,\n      // Loop time over this period to avoid instability using unbounded `time`.\n      loop: 1e6\n    }),\n    // A particle's lifetime range, and whether it's allowed to spawn.\n    lifetime: [6e2, 6e3, +true],\n    // Whether to use Verlet (midpoint) or Euler (forward) integration.\n    useVerlet: +canVerlet,\n    // A small number greater than 0; avoids speeds exploding.\n    epsilon: 1e-5,\n    // How far a particle can move in any frame.\n    moveCap: 7e-3,\n    // Whether to primarily control the source or sink.\n    flipPointer,\n    // The position around which particles spawn.\n    source: {\n      // The initial source, may be transformed into a new property `to`.\n      at: [0, 0, gapZ],\n      // If shaken around while idling, transform `to` or `at` into `shaken`.\n      shake: { radius: shakeSource, yaw: 1e-2, spin: 3e-4, wait: 7e3 }\n    },\n    // Sink position, and universal gravitational constant.\n    sink: {\n      // The initial sink, may be transformed into a new property `to`.\n      at: [\n        // Sink position.\n        0, 0, 0,\n        // Universal gravitational constant (scaled).\n        ugc*2e7\n      ],\n      // If shaken around while idling, transform `to` or `at` into `shaken`.\n      shake: { radius: shakeSink, yaw: 1e-3, spin: 1e-3, wait: 5e3 }\n    },\n    // Constant acceleration of gravity; and whether to use it or the `sink`.\n    g: [\n      // Constant acceleration of gravity.\n      0, -g*1e-2, 0,\n      // Whether to use it or the `sink`.\n      +false\n    ],\n    // Speed scale. Exponent encoding `[b, p] => b*(10**p)` for numeric accuracy.\n    pace: [1, -8],\n\n    // One option in these arrays is used, by Euler/Verlet respectively.\n\n    // The distance from the `source`, and speed, that particles spawn with.\n    spout: [[0, 3e3*spoutPace], [0, 2e2*spoutPace]],\n  }\n});\n\nconsole.log(self.state = state);\n\nconsole.group('How `values` are `packed` to fit texture channels efficiently');\n\nconsole.log('`values` (numbers of channels used together):',\n  ...state.maps.values);\n\nconsole.log('`packed` (if any, indexes `values`):',\n  ...state.maps.packed);\n\nconsole.log('`textures` (indexes `values`, via any `packed` or directly):',\n  ...state.maps.textures);\n\nconsole.log('`valueToTexture` (indexes `textures` via `value` index):',\n  ...state.maps.valueToTexture);\n\nconsole.groupEnd();\n\nconsole.log('`entries` (total number of states of `values` updated per-step):',\n  state.size.entries);\n\n\n// Set up rendering - reading but not writing the `gl-gpgpu` state each frame.\n// For this demo, done separately, but sharing the same resources.\n\n/**\n * Draw all states with none bound as outputs.\n * @todo Errors without `merge`; why, if the framebuffer isn't bound?\n */\nconst drawBound = +(!merge);\n\nconst drawSteps = steps-drawBound;\nconst useLines = merge && (drawSteps > 1);\n\nconsole.log('drawSteps', drawSteps, 'useLines', useLines);\n\n/**\n * Vertex counts by `form`; how many steps a `form` covers, for all entries;\n * respectively for: none, points, lines.\n * Note `state.size.entries` equals the value returned by `countDrawIndexes`.\n */\nconst drawCounts = map((_, f) => indexForms(drawSteps, f, state.size.entries),\n  range(2+useLines), 0);\n\n/** Use `min` for contain, `max` for cover. */\nconst viewScale = min;\n\n/**\n * @see [glsl-aspect](https://github.com/keeffEoghan/glsl-aspect/blob/master/index.glsl)\n * @see [glsl-aspect/contain](https://github.com/keeffEoghan/glsl-aspect/blob/master/contain.glsl)\n */\nconst aspect = (size, ar) => invert2(ar, divN2(ar, size, viewScale(...size)));\n\n/** Reuse the `gl-gpgpu` state, mix in drawing-specific state. */\nconst drawState = {\n  ...state,\n  // Omit some properties unused in drawing for some clarity.\n  count: undefined, vert: undefined, frag: undefined, attributes: undefined,\n  // Override other properties for drawing.\n  bound: drawBound,\n  // Drawing, not updating data, so no `output` macros; no `frag` needed either.\n  macros: { output: 0, frag: 0 },\n  // Custom properties, namespaced to avoid clashing with `gl-gpgpu` ones etc.\n  drawProps: {\n    // Transformation matrices.\n    model: {\n      matrix: identity44([]), inverse: identity44([]),\n      // Continuous rotation.\n      rotation: identity44([]),\n      axis: [0, 1, 0],\n      angle: (timestep || timestepDef)*spinPace*tau,\n      angle0: spin0*tau\n    },\n    view: {\n      matrix: identity44([]), inverse: identity44([]),\n      // Look from the `eye` at the `target` while oriented `up`.\n      eye: [0, 0, 0.5], target: [0, 0, 0], up: [0, 1, 0],\n      // Ray origin and direction for casting.\n      ray: [[], []]\n    },\n    projection: { matrix: identity44([]), inverse: identity44([]) },\n    // Cached combined transformations.\n    transform: {\n      modelView: { matrix: identity44([]), inverse: identity44([]) },\n      // viewProjection: { matrix: identity44([]), inverse: identity44([]) },\n      modelViewProjection: { matrix: identity44([]), inverse: identity44([]) }\n    },\n    // View dimensions.\n    size: [1, 1],\n    // View aspect ratio scale, per x- and y-axes.\n    aspect: [1, 1],\n    light: {\n      ambient: range(3, ((lit === 'dark')? 0.1 : ((lit === 'false')? 1 : 0.4))),\n      // Point-lights: position (`at` transforms `to`); color, attenuate factor.\n      points: ((lit && (lit.search(/^(dark|false)$/g) === 0))? null : [\n        // A white spherical-light with radius `0.3` - see https://imdoingitwrong.wordpress.com/2011/01/31/light-attenuation/\n        { at: [0, 1, 0], color: [20, 20, 20], factor: [1, 2/0.3, 0.3**-2] },\n        // A cyan-ish point-light, higher linear attenuation.\n        {\n          at: [cos(0), -1, sin(0)],\n          color: [1, 9, 9], factor: [1, 9, 3]\n        },\n        // A magenta-ish point-light, higher quadratic attenuation.\n        {\n          at: [cos(tau*0.33), -1, sin(tau*0.33)],\n          color: [9, 1, 9], factor: [1, 3, 9]\n        },\n        // A yellow-ish point-light, even attenuation.\n        {\n          at: [cos(tau*0.66), -1, sin(tau*0.66)],\n          color: [9, 9, 1], factor: [1, 5, 5]\n        }\n      ])\n    },\n    // Material roughness, albedo, and skin thickness.\n    material: [rough, albedo, skin],\n    // Scale depths over near and far range, and precision (arbitrarily).\n    depths: [1e-2, 1, 5e-2/depthBits],\n    // Fog start offset, scale, exponent, maximum effect.\n    fog: [-1, 0.4, 1, 0.9],\n    // The clear and fog color.\n    clear: [0, 0, 0, 0],\n    // How many vertexes per form.\n    form: clamp(form || 2, 1, 1+useLines),\n    // Vertex counts, by form; how many steps a form covers, for all entries.\n    counts: drawCounts,\n    // Which primitives can be drawn, by form.\n    primitives: [, 'points', 'lines'],\n    // Which primitive dimensions can be drawn, by form.\n    widths: [, pointSizeDims, lineWidthDims],\n    // How wide the form is; to be scaled by `viewScale`.\n    wide,\n    // How many older state positions to fizz around, and other inputs.\n    fizz,\n    // Hue range to colour particles.\n    hues,\n\n    // One option in these arrays is used, by Euler/Verlet respectively.\n\n    // Speed-to-colour scaling, as `[multiply, power]`.\n    paceColor: [[paceLit*2e-9, 2], [paceLit*2e7, 2]]\n  },\n  // Map everything similarly to the `gl-gpgpu` step, `mapStep` can be reused to\n  // create new mappings with some additions for drawing.\n  maps: mapStep({\n    ...state.maps,\n\n    /**\n     * To ensure drawing happens in one pass, disregard buffers to prevent\n     * multiple passes (as happens in `state.step` to bind all `texture`s across\n     * limited buffer outputs).\n     */\n    buffersMax: null,\n\n    /**\n     * Read all past `values` to derive one value; that is, look up all states\n     * in one draw pass.\n     *\n     * This case creates `macros` of a `reads_${value}_i` list, where `value` is\n     * `0` and each entry in this list gives a `[step, value]` pair, here being\n     * `[0, 0]`, `[0, 1]`, `[0, 2]`, `[1, 0]`.\n     */\n    derives: [\n      // Entries of the first value's `derives` (`derives[0]`) `array` denote\n      // that it derives from:\n      [\n        // All `values` (denoted by `true`), 1st step past.\n        true,\n        // The `position` value, 2nd step past.\n        { value: valuesIndex.position, step: wrap(1, drawSteps) }\n      ]\n    ]\n  })\n};\n\n/** Hook up `gl-gpgpu` uniforms by extending them. */\nconst drawUniforms = toUniforms(drawState, {\n  ...drawState.uniforms,\n\n  modelView: regl.prop('drawProps.transform.modelView.matrix'),\n  projection: regl.prop('drawProps.projection.matrix'),\n  eye: regl.prop('drawProps.view.eye'),\n  aspect: regl.prop('drawProps.aspect'),\n  material: regl.prop('drawProps.material'),\n  depths: regl.prop('drawProps.depths'),\n  fog: regl.prop('drawProps.fog'),\n  clear: regl.prop('drawProps.clear'),\n  // How many vertexes per form.\n  form: regl.prop('drawProps.form'),\n  fizz: regl.prop('drawProps.fizz.at'),\n  fizzMax: regl.prop('drawProps.fizz.max'),\n  fizzRate: regl.prop('drawProps.fizz.rate'),\n  fizzCurve: regl.prop('drawProps.fizz.curve'),\n  hues: regl.prop('drawProps.hues'),\n  lightAmbient: regl.prop('drawProps.light.ambient'),\n\n  paceColor: (_, { drawProps: dp, props: p }) => dp.paceColor[+p.useVerlet],\n\n  wide: (_, { drawProps: { wide: w, widths: ws, form: f, size: s } }) =>\n    clamp(w*viewScale(...s), ...ws[f])\n});\n\n/** Convert point-lights from object-oriented to flat data-oriented. */\nconst lightPoints = drawState.drawProps.light.points;\n\nlightPoints && reduce((o, _, l) => {\n    const n = 'lightPoint';\n    const i = `[${l}]`;\n\n    o[n+'Positions'+i] = (_, p) => {\n      const { light, transform } = p.drawProps;\n      const lp = light.points[l];\n      const { at, to = lp.to = [] } = lp;\n\n      return mulV344(to, transform.modelView.matrix, at);\n    };\n\n    o[n+'Colors'+i] = regl.prop(`drawProps.light.points${i}.color`);\n    o[n+'Factors'+i] = regl.prop(`drawProps.light.points${i}.factor`);\n\n    return o;\n  },\n  lightPoints, drawUniforms);\n\n/** The `GL` render command pipeline state. */\nconst drawPipeline = {\n  // Use `gl-gpgpu` `macro` mappings by prepending `macro`s from a single pass.\n  vert: (_, p) => macroPass(p)+\n    `#define lightPointsL ${p.drawProps.light.points?.length ?? 0}\\n`+drawVert,\n\n  frag: (_, p) =>\n    `#define lightPointsL ${p.drawProps.light.points?.length ?? 0}\\n`+drawFrag,\n\n  // Maximum count here to set up buffers, can be partly used later.\n  attributes: { index: getDrawIndexes(max(...drawCounts)) },\n  uniforms: drawUniforms,\n  lineWidth: (_, { drawProps: { wide: w, size: s } }) =>\n    clamp(w*viewScale(...s), ...lineWidthDims),\n  // Vertex counts by form; how many steps a form covers, for all entries.\n  count: (_, { count: c, drawProps: { counts: cs, form: f } }) => c ?? cs[f],\n  blend: { enable: true, func: { src: 'one', dst: 'one minus src alpha' } },\n\n  primitive: (_, { drawProps: { primitive: p, primitives: ps, form: f } }) =>\n    p ?? ps[f]\n};\n\nconsole.log((self.drawState = drawState), (self.drawPipeline = drawPipeline));\n\n/** Function to execute the render command pipeline state every frame. */\nconst draw = regl(drawPipeline);\nconst clearView = { color: drawState.drawProps.clear, depth: 1 };\n\n/** Rotate the model by an angle; update the matrix and inverse. */\nfunction rotateModel(angle = drawState.drawProps.model.angle) {\n  if(!angle) { return; }\n\n  const { model } = drawState.drawProps;\n  const { rotation: r, axis, matrix: mm, inverse: mi } = model;\n\n  return invert44(mi, mulM44(mm, rotationAroundAxis44(r, axis, angle), mm));\n}\n\n/** Update the view matrix and inverse. */\nfunction updateView() {\n  const { eye, target, up, matrix: vm, inverse: vi } = drawState.drawProps.view;\n\n  return invert44(vi, lookAt(vm, eye, target, up));\n}\n\n/** Update the projection matrix and inverse. */\nfunction updateProjection() {\n  const { depths: [d0, d1], projection: p } = drawState.drawProps;\n  const { matrix: pm, inverse: pi } = p;\n\n  /** Aspect ratio is handled separately, so set to 1 in the projection. */\n  invert44(pi, perspective(pm, 40, 1, d0, d1));\n}\n\n/** Update each needed cached combined transformation matrix and inverse. */\nfunction updateTransform() {\n  const { transform: t, model, view, projection } = drawState.drawProps;\n  const { modelView: tmv, viewProjection: tvp, modelViewProjection: tmvp } = t;\n  const mm = model.matrix;\n  const vm = view.matrix;\n  const pm = projection.matrix;\n\n  tmv && invert44(tmv.inverse, concat(tmv.matrix, vm, mm));\n  tvp && invert44(tvp.inverse, concat(tvp.matrix, pm, vm));\n  tmvp && invert44(tmvp.inverse, concat(tmvp.matrix, pm, vm, mm));\n}\n\n/** Rotate the model to its starting angle. */\nrotateModel(drawState.drawProps.model.angle0);\n/** Initialise the view matrix. */\nupdateView();\n/** Initialise the projection matrix. */\nupdateProjection();\n\nfunction stopEvent(e) {\n  e.stopPropagation();\n  e.preventDefault();\n}\n\n/** Pause the spawning while pointer is held down. */\nlet hold;\n\n/** Pause particles spawning. */\ncanvas.addEventListener('contextmenu', (e) => {\n  // Whether a particle's allowed to spawn.\n  state.props.lifetime[2] = +false;\n  hold = false;\n  stopEvent(e);\n});\n\n/** Switch primary pointer control between source and sink. */\ncanvas.addEventListener((('onpointerup' in self)? 'pointerup'\n    : (('ontouchend' in self)? 'touchend' : 'mouseup')),\n  (e) => {\n    /** Unpause the spawning when pointer is released. */\n    const spawned = state.props.lifetime[2];\n    const held = hold;\n\n    // Whether a particle's allowed to spawn.\n    state.props.lifetime[2] = +true;\n    hold = false;\n\n    // Don't switch primary pointer control if pointer was being held down,\n    // particles weren't spawning, or any non-primary button was released.\n    if(held || !spawned || (e.button !== 0)) { return; }\n\n    // Switch primary pointer control if this wasn't press-held.\n    state.props.flipPointer = !state.props.flipPointer;\n    stopEvent(e);\n  });\n\n/** Move either the source or the sink, according to primary pointer. */\ncanvas.addEventListener((('onpointermove' in self)? 'pointermove'\n    : (('ontouchmove' in self)? 'touchmove' : 'mousemove')),\n  (e) => {\n    const { clientX: x, clientY: y, type, pointerType, isPrimary = true } = e;\n    const { top, right, bottom, left } = canvas.getBoundingClientRect();\n    const { source: i, sink: o, flipPointer, timer: t } = state.props;\n    const touch = ((type === 'touchmove') || (pointerType === 'touch'));\n    /** Move source or sink, switch by primary/other pointer/s in `xor` flip. */\n    const pick = ((isPrimary !== flipPointer)? o : i);\n    /** Transform from screen-space to world-space. */\n    const { at, to = pick.to = [] } = pick;\n    const { aspect: ar, transform, model, view } = drawState.drawProps;\n    const { eye, ray: [ro, rv] } = view;\n\n    /** Include any additional data. */\n    map((v) => v, at, to);\n    /** Screen-space pointer as a `ray` target. */\n    setC3(rv, fit(x, left, right, -1, 1), fit(y, top, bottom, 1, -1), 1);\n    /** Aspect ratio scale and un-project the `ray` target. */\n    mulV344(rv, transform.modelViewProjection.inverse, div2(rv, rv, ar));\n    /** Un-transform `eye` as `ray` origin, subtract `ray` target as vector. */\n    sub3(rv, rv, mulV344(ro, model.inverse, eye));\n    /** Cast along `ray` by the initial `eye` to `at` distance, as `to`. */\n    add3(to, ro, normalize3(rv, rv, dist3(eye, at)));\n\n    // For touch devices, don't pause spawn if touch moves while held down.\n    touch && (hold = true);\n    // Reset the idle time for any movement.\n    t.idle = 0;\n    document.body.classList.remove('idle');\n  });\n\n/** Toggle physics and graphics modes. */\ncanvas.addEventListener('dblclick', (e) => {\n  const { props: p, drawProps: d } = drawState;\n  const v = canVerlet && (p.useVerlet = 1-p.useVerlet);\n  const f = form || (d.form = 1+(useLines && ((canVerlet)? v : d.form%2)));\n\n  console.log('useVerlet', v, 'form', f,\n    // See how this derives other properties.\n    'count', drawPipeline.count(0, drawState),\n    'primitive', drawPipeline.primitive(0, drawState));\n});\n\n/** Toggle fullscreen by button. */\ndocument.querySelector('#fullscreen')?.addEventListener?.('click',\n  () => canvas.requestFullscreen());\n\n/** Toggle fullscreen by key-press. */\ndocument.addEventListener('keyup',\n  (e) => (e.key === 'f') && canvas.requestFullscreen());\n\n/** Scroll back up when fallback demo video loads. */\ndocument.querySelector('#fallback')?.addEventListener?.('load', scrollDefer);\n\n/** Resize the canvas and any dependent properties. */\nfunction resize() {\n  const { drawProps } = drawState;\n  const { size, aspect: ar } = drawProps;\n  const [w, h] = mulN2(size, setC2(size, innerWidth, innerHeight), pixelRatio);\n\n  canvas.width = w;\n  canvas.height = h;\n  aspect(size, ar);\n}\n\naddEventListener('resize', resize);\nresize();\n\nfunction stepTime(to) {\n  const { dt, dts } = timer(to);\n\n  dts[0] = dts[1];\n  to.idle += (dts[1] = dt);\n\n  return to;\n}\n\n/** Compute the next step of state for a frame. */\nfunction frameStep() {\n  try {\n    stepTime(state.props.timer);\n    state.step();\n  }\n  catch(e) { toggleError(e); }\n}\n\n// Whether to prefill initial states before spawning, or start with all `0`.\nfor(let p = prefill && stepsPast; p; --p) { frameStep(); }\n\nregl.frame(() => {\n  try {\n    frameStep();\n    // Update the draw state.\n    drawState.stepNow = (state.stepNow+1)-drawBound;\n    // Rotate the scene each frame.\n    rotateModel();\n    // Update the transformation matrices.\n    updateTransform();\n    // Clear and draw.\n    regl.clear(clearView);\n    draw(drawState);\n    // Update idle view.\n    (state.props.timer.idle > 3e3) && document.body.classList.add('idle');\n  }\n  catch(e) { toggleError(e); }\n});\n","/**\n * The update step for a GPGPU particle simulation.\n * Requires setup with preprocessor macros - see `macroPass`.\n * Executed in one or more passes; each chunk depending on a `gpgpu` macro may\n * be combined with others into one pass or separated into its own pass; `gpgpu`\n * preprocessor macros control the combination according to which `values` are\n * currently bound for `output` to the next `state`.\n *\n * @see {@link step.toStep}\n * @see {@link macros.macroPass}\n */\n\n#ifdef GL_EXT_draw_buffers\n  #extension GL_EXT_draw_buffers : require\n#endif\n\nprecision highp float;\n\n// Setting up the macros and aliases `gl-gpgpu` provides.\n\n// Note these `texture_${value}`/`channels_${value}`/`reads_${value}_${derive}`\n// indexes correspond to the `values` indexes via `gl-gpgpu`'s `array`s\n// `values`/`derives`; they're redefined here to match the structure with names.\n\n// The texture channels each of the `values` is stored in.\n#define positionChannels gpgpu_channels_0\n#define motionChannels gpgpu_channels_1\n#define lifeChannels gpgpu_channels_2\n\n/** Set up sampling logic via `gl-gpgpu` macro. */\ngpgpu_useSamples\n\n// Set up minimal texture reads logic; only read what a value with a currently\n// bound output `derives` from other `values` for its next state.\n// See `derives` for how each `reads_${value}_${derive}` is indexed\n// per-`derive`-per-`value`.\n#ifdef gpgpu_output_0\n  #define positionOutput gpgpu_output_0\n  gpgpu_useReads_0\n  #define positionReadPosition0 gpgpu_reads_0_0\n  #define positionReadPosition1 gpgpu_reads_0_1\n  #define positionReadMotion gpgpu_reads_0_2\n  #define positionReadLife gpgpu_reads_0_3\n#endif\n#ifdef gpgpu_output_1\n  #define motionOutput gpgpu_output_1\n  gpgpu_useReads_1\n  #define motionReadMotion gpgpu_reads_1_0\n  #define motionReadLife gpgpu_reads_1_1\n  #define motionReadPosition gpgpu_reads_1_2\n#endif\n#ifdef gpgpu_output_2\n  #define lifeOutput gpgpu_output_2\n  gpgpu_useReads_2\n  #define lifeReadLifeLast gpgpu_reads_2_0\n  #define lifeReadLife1 gpgpu_reads_2_1\n#endif\n\n// The main shader.\n\n/** States from `gl-gpgpu`, merged or separate. */\n#ifdef gpgpu_mergedStates\n  /** States from `gl-gpgpu` in one merged `texture`. */\n  uniform sampler2D gpgpu_states;\n#else\n  /** States from `gl-gpgpu` in separate `texture`/s. */\n  uniform sampler2D gpgpu_states[gpgpu_stepsPast*gpgpu_textures];\n#endif\n\n/** Current step from `gl-gpgpu`; needed for `tapStates` or `tapStatesBy`. */\nuniform float gpgpu_stepNow;\n\n// Common shader inputs and parts.\n\nuniform float dt1;\nuniform float loop;\n\nvarying vec2 uv;\n\n#pragma glslify: random = require(glsl-random)\n#pragma glslify: lt = require(glsl-conditionals/when_lt)\n#pragma glslify: le = require(glsl-conditionals/when_le)\n\n// Any shader inputs or parts can also be split up by usage in different passes.\n\n#ifdef positionOutput\n  uniform float moveCap;\n  uniform vec2 pace;\n  uniform vec3 source;\n\n  /** @todo Try Velocity Verlet integration. */\n  #pragma glslify: verlet = require(@epok.tech/glsl-verlet/p-p-a)\n#endif\n\n#ifdef motionOutput\n  uniform float epsilon;\n  /** Sink position, and universal gravitational constant. */\n  uniform vec4 sink;\n  /** Constant acceleration of gravity; and whether to use it or the `sink`. */\n  uniform vec4 g;\n#endif\n\n#ifdef lifeOutput\n  /** A particle's lifetime range, and whether it's allowed to respawn. */\n  uniform vec3 lifetime;\n\n  #pragma glslify: map = require(glsl-map)\n#endif\n\n#if defined(positionOutput) || defined(motionOutput)\n  uniform float dt0;\n  uniform float useVerlet;\n  uniform vec2 spout;\n\n  #pragma glslify: tau = require(glsl-constants/TAU)\n  #pragma glslify: onSphere = require(./on-sphere)\n#endif\n\nfloat canSpawn(float life) {\n  // Whether to prefill initial states before spawning, or start with all `0`.\n  #ifdef prefill\n    return lt(life, 0.0);\n  #else\n    return le(life, 0.0);\n  #endif\n}\n\nvoid main() {\n  /** Sample the desired state values - creates the `gpgpu_data` `array`. */\n  gpgpu_tapState(uv)\n\n  // Read values.\n\n  #ifdef positionOutput\n    vec3 position0 = gpgpu_data[positionReadPosition0].positionChannels;\n  #endif\n\n  // If reads all map to the same value sample, any of them will do.\n  #if defined(positionOutput) || defined(motionOutput)\n    #if defined(positionOutput)\n      #define readMotion positionReadMotion\n      #define readPosition positionReadPosition1\n    #elif defined(motionOutput)\n      #define readMotion motionReadMotion\n      #define readPosition motionReadPosition\n    #endif\n\n    vec3 position1 = gpgpu_data[readPosition].positionChannels;\n    vec3 motion = gpgpu_data[readMotion].motionChannels;\n  #endif\n\n  // If reads all map to the same value sample, any of them will do.\n  #if defined(positionOutput)\n    #define readLife positionReadLife\n  #elif defined(lifeOutput)\n    #define readLife lifeReadLife\n  #elif defined(motionOutput)\n    #define readLife motionReadLife\n  #endif\n\n  vec2 life = gpgpu_data[readLife].lifeChannels;\n\n  #ifdef lifeOutput\n    vec2 lifeLast = gpgpu_data[lifeReadLifeLast].lifeChannels;\n  #endif\n\n  // Update and output values.\n  // Note that the update/output logic components within each `#if` macro\n  // block from `gpgpu` are independent modules, as the `gpgpu` macros\n  // determine whether they're executed across one or more passes - they could\n  // also be coded in separate files called from here, however they're coded\n  // inline here for brevity, relevance, and easy access to shared variables.\n\n  /** Whether the particle is ready to respawn. */\n  float spawn = canSpawn(life.x);\n\n  #if defined(positionOutput) || defined(motionOutput)\n    // Workaround for switching Euler/Verlet; interpret `motion` data as\n    // acceleration/velocity, respectively.\n    vec3 velocity = motion;\n    vec3 acceleration = motion;\n\n    /** Spawn randomly on a sphere around the source, move in that direction. */\n    vec3 spoutSpawn = random((-uv.st*(0.6+loop))/(0.1+dt0))*\n      onSphere(random((uv.st*(0.3+loop))/(0.9+dt0))*tau,\n        mix(-1.0, 1.0, random((-uv.ts*(0.2+loop))/(0.8+dt1))));\n  #endif\n\n  #ifdef positionOutput\n    /** For numeric accuracy, encoded as exponent `[b, p] => b*(10**p)`. */\n    float speed = pace.s*pow(10.0, pace.t);\n\n    /**\n     * Constrain Verlet movement; handle here for better numerical accuracy.\n     * Any position changes below the movement cap remain the same; any\n     * bigger clamped towards current position, by the ratio over the limit.\n     */\n    vec3 back = mix(position0, position1,\n      clamp((distance(position1, position0)/moveCap)-1.0, 0.0, 1.0));\n\n    // Use either Euler integration...\n    vec3 positionTo = mix(position1+(velocity*dt1*speed),\n      // ... or Verlet integration...\n      verlet(back, position1, acceleration*speed, dt0, dt1),\n      // ... according to which is currently active.\n      useVerlet);\n\n    /** Spawn around the source. */\n    vec3 positionSpawn = source+(spout.x*spoutSpawn);\n\n    /** Output the next position value to its channels in the state texture. */\n    positionOutput = mix(positionTo, positionSpawn, spawn);\n  #endif\n  #ifdef motionOutput\n    /**\n     * Gravitate towards the sink point (simplified).\n     * @see [Wikipedia on gravitation](https://en.wikipedia.org/wiki/Newton%27s_law_of_universal_gravitation)\n     */\n    vec3 gravity = sink.xyz-position1;\n\n    gravity *= sink.w/max(dot(gravity, gravity), epsilon);\n\n    /** Use sink point, or constant acceleration due to gravity. */\n    acceleration = mix(gravity, g.xyz, g.w);\n\n    vec3 motionTo = mix(velocity+(acceleration*dt1), acceleration, useVerlet);\n    vec3 motionNew = spout.y*spoutSpawn;\n\n    /** Output the next motion value to its channels in the state texture. */\n    motionOutput = mix(motionTo, motionNew, spawn);\n  #endif\n  #ifdef lifeOutput\n    vec2 lifeTo = vec2(life.x-dt1, life.y);\n\n    vec2 lifeNew = vec2(map(random(uv*(1.0+loop)),\n      0.0, 1.0, lifetime.s, lifetime.t));\n\n    /** Whether the oldest state has faded. */\n    float faded = canSpawn(lifeLast.x);\n\n    /**\n     * Output the next life value to its channels in the state texture.\n     * Only spawn life once the oldest step reaches the end of its lifetime\n     * (past and current life are both 0), and if it's allowed to respawn.\n     */\n    lifeOutput = mix(lifeTo, lifeNew, spawn*faded*lifetime.z);\n  #endif\n}\n","/**\n * Drawing a GPGPU particle simulation.\n * Requires setup with preprocessor macros. See `macroPass` and `macroValues`.\n *\n * @see {@link macros.macroPass}\n * @see {@link macros.macroValues}\n */\n\nprecision highp float;\n\n// The texture channels each of the `values` is stored in.\n#define positionChannels gpgpu_channels_0\n#define motionChannels gpgpu_channels_1\n#define lifeChannels gpgpu_channels_2\n// Set up sampling logic.\ngpgpu_useSamples\n// Only the first value derives from all values, giving these minimal `reads`.\ngpgpu_useReads_0\n// These first `derives` are all in one pass for the `value` at `0`.\n// See `derives` for how each `reads_0_${derive}` is indexed per-`derive`.\n#define readPosition1 gpgpu_reads_0_0\n#define readMotion gpgpu_reads_0_1\n#define readLife gpgpu_reads_0_2\n// Additional `derives` are individually specified.\n#define readPosition0 gpgpu_reads_0_3\n\nattribute float index;\n\n/** States from `gl-gpgpu`, merged or separate. */\n#ifdef gpgpu_mergedStates\n  /** States from `gl-gpgpu` in one merged `texture`. */\n  uniform sampler2D gpgpu_states;\n#else\n  /** States from `gl-gpgpu` in separate `texture`/s. */\n  uniform sampler2D gpgpu_states[gpgpu_stepsPast*gpgpu_textures];\n#endif\n\n/** Current step from `gl-gpgpu`; needed for `tapStates` or `tapStatesBy`. */\nuniform float gpgpu_stepNow;\n/** Further `gl-gpgpu` uniforms. */\nuniform vec4 gpgpu_stateShape;\nuniform vec2 gpgpu_viewShape;\n\nuniform mat4 modelView;\nuniform mat4 projection;\nuniform vec2 aspect;\nuniform float wide;\nuniform float dt;\nuniform float loop;\nuniform vec2 paceColor;\nuniform float useVerlet;\nuniform float form;\nuniform vec2 hues;\n\nuniform float fizz;\nuniform float fizzMax;\nuniform float fizzRate;\nuniform float fizzCurve;\n\n/** View-space position. */\nvarying vec4 positionView;\n/** Center and radius for points or lines; only points have `gl_PointCoord`. */\nvarying vec3 sphere;\nvarying vec4 color;\nvarying vec3 emissive;\n\n#pragma glslify: gt = require(glsl-conditionals/when_gt)\n#pragma glslify: random = require(glsl-random)\n#pragma glslify: map = require(glsl-map)\n#pragma glslify: tau = require(glsl-constants/TAU)\n#pragma glslify: hsl2rgb = require(glsl-hsl2rgb)\n\n#pragma glslify: onSphere = require(./on-sphere)\n#pragma glslify: indexUV = require(../../src/lookup/index-uv)\n#pragma glslify: offsetUV = require(../../src/lookup/offset-uv)\n\n#if gpgpu_stepsPast > 1\n  // If multiple steps are given, shift into past steps.\n  // Lookups mostly equivalent; input and result iteration order differ.\n  #define indexFormsStates\n  #ifdef indexFormsStates\n    #pragma glslify: indexStates = require(../../src/index-forms/index-states)\n  #else\n    #pragma glslify: indexEntries = require(../../src/index-forms/index-entries)\n  #endif\n#endif\n\nconst vec4 hide = vec4(0);\n\nfloat triangleWave(float x) { return (abs(fract(x)-0.5)*4.0)-1.0; }\n\nvoid main() {\n  #if gpgpu_stepsPast > 1\n    // If multiple steps are given, find past step and entry.\n    // Lookups mostly equivalent; input and result iteration order differ.\n    #ifdef indexFormsStates\n      vec2 stepEntry = indexStates(index, gpgpu_stepsPast, form);\n    #else\n      vec2 stepEntry = indexEntries(index, gpgpu_entries, form);\n    #endif\n\n    float stepPast = stepEntry.s;\n    float entry = stepEntry.t;\n  #else\n    // If only 1 step is given, past step and entry are known.\n    float stepPast = 0.0;\n    float entry = index;\n  #endif\n\n  // Turn 1D index into 2D texture UV; offset to texel center, avoids errors.\n  vec2 st = offsetUV(indexUV(entry, gpgpu_stateShape.xy), gpgpu_stateShape.xy);\n\n  // Can also use the `reads` logic to take the minimum possible samples here.\n  // Sample the desired state values; creates the `gpgpu_data` `array`.\n  #if gpgpu_stepsPast > 1\n    // Shift into past steps.\n    gpgpu_tapStateBy(st, stepPast, 0)\n  #else\n    // No past steps, no shift.\n    gpgpu_tapState(st)\n  #endif\n\n  // Read values.\n  vec3 position0 = gpgpu_data[readPosition0].positionChannels;\n  vec3 position1 = gpgpu_data[readPosition1].positionChannels;\n  vec3 motion = gpgpu_data[readMotion].motionChannels;\n  vec2 life = gpgpu_data[readLife].lifeChannels;\n  float alive = gt(life.x, 0.0);\n  float ago = stepPast/max(float(gpgpu_stepsPast-1), 1.0);\n\n  /** Fizz randomly on a sphere around older positions. */\n  float fl = pow(clamp(stepPast/fizz, 0.0, 1.0), fizzCurve)*fizzMax;\n  float ft = loop*fizzRate*mix(-1.0, 1.0, mod(entry, 2.0))/(1.0+fl);\n  float fa = (random(position1.xy+entry)+ft)*tau;\n  float fd = triangleWave(random(vec2(position1.z, life.x)-entry)+ft);\n\n  positionView = modelView*vec4(position1+(fl*onSphere(fa, fd)), 1);\n  // positionView = vec4(mix(vec2(-0.5), vec2(0.5), st), 0.2, 1);\n\n  vec4 to = mix(hide, projection*positionView, alive);\n\n  to.xy *= aspect;\n  gl_Position = to;\n\n  float fade = clamp(pow(1.0-ago, 0.9), 0.0, 1.0)*\n    clamp(pow(life.x/life.y, 0.5), 0.0, 1.0);\n\n  float scale = clamp(pow(1.0-(life.x/life.y), 0.4), 0.0, 1.0);\n  float size = gl_PointSize = (wide*fade*scale)/to.w;\n\n  /**\n   * Convert vertex position to `gl_FragCoord` window-space.\n   * @see [SO](https://stackoverflow.com/a/7158573)\n   * @see [SO](https://stackoverflow.com/a/54237532/716898)\n   */\n  sphere = vec3(gpgpu_viewShape*(((to.xy/to.w)*0.5)+0.5), size*0.5);\n\n  float hue = fract(mix(hues.s, hues.t, entry/float(gpgpu_entries)));\n  vec3 velocity = mix(motion, (position1-position0)/dt, useVerlet);\n\n  color = vec4(hsl2rgb(hue, mix(1.0, 0.1, ago), 0.7), fade);\n\n  emissive = hsl2rgb(hue, 1.0,\n    clamp(pow(dot(velocity, velocity)*paceColor.s, paceColor.t), 0.0, 0.8));\n}\n","/**\n * Drawing a GPGPU particle simulation.\n * Requires setup with preprocessor macros. See `macroPass` and `macroValues`.\n *\n * @see {@link macros.macroPass}\n * @see {@link macros.macroValues}\n *\n * @todo Simple light shading.\n */\n\n#ifdef GL_EXT_frag_depth\n  #extension GL_EXT_frag_depth : enable\n#endif\n\nprecision highp float;\n\nuniform float wide;\n/** Scale depths over near and far range, and precision (arbitrarily). */\nuniform vec3 depths;\n/** Fog start offset, scale, exponent, maximum effect. */\nuniform vec4 fog;\n/** The clear and fog color. */\nuniform vec4 clear;\n/** Material roughness, albedo, and skin thickness. */\nuniform vec3 material;\nuniform vec3 lightAmbient;\n\n#ifndef lightPointsL\n  #define lightPointsL 0\n#elif lightPointsL > 0\n  uniform vec3 lightPointPositions[lightPointsL];\n  uniform vec3 lightPointColors[lightPointsL];\n  uniform vec3 lightPointFactors[lightPointsL];\n#endif\n\n/** View-space position. */\nvarying vec4 positionView;\n/** Center and radius for points or lines; only points have `gl_PointCoord`. */\nvarying vec3 sphere;\nvarying vec4 color;\nvarying vec3 emissive;\n\n#pragma glslify: map = require(glsl-map)\n#pragma glslify: lt = require(glsl-conditionals/when_lt)\n#pragma glslify: gt = require(glsl-conditionals/when_gt)\n#pragma glslify: diffuse = require(glsl-diffuse-oren-nayar)\n#pragma glslify: specular = require(glsl-specular-beckmann)\n\n/**\n * Point-light attenuation.\n *\n * @see [I'm Doing it Wrong - Light Attenuation](https://imdoingitwrong.wordpress.com/2011/01/31/light-attenuation/)\n *\n * @param d A vector of light position distance, [distance, distance squared].\n * @param a A vector of attenuation factors, [constant, linear, quadratic].\n *\n * @returns The attenuation of the point-light.\n */\nfloat attenuate(vec2 d, vec3 a) { return 1.0/dot(a, vec3(1, d)); }\nfloat attenuate(float d2, vec3 a) { return attenuate(vec2(sqrt(d2), d2), a); }\n\n/**\n * Spherical-light attenuation.\n *\n * @see [I'm Doing it Wrong - Light Attenuation](https://imdoingitwrong.wordpress.com/2011/01/31/light-attenuation/)\n *\n * @param d A vector of light position distance, [distance, distance squared].\n * @param r A vector of spherical-light radius, [radius, radius squared].\n *\n * @returns The attenuation of the spherical-light.\n */\nfloat attenuate(vec2 d, vec2 r) { return attenuate(d, vec3(1, vec2(2, 1)/r)); }\nfloat attenuate(vec2 d, float r2) { return attenuate(d, vec2(sqrt(r2), r2)); }\nfloat attenuate(float d2, vec2 r) { return attenuate(vec2(sqrt(d2), d2), r); }\n\nfloat attenuate(float d2, float r2) {\n  return attenuate(vec2(sqrt(d2), d2), r2);\n}\n\nvoid main() {\n  /**\n   * Distance to a sphere's surface, and resulting normal and depth.\n   *\n   * @see [SO](https://stackoverflow.com/a/31829666/716898)\n   * @see [SO](https://stackoverflow.com/questions/53271461/drawing-a-sphere-normal-map-in-the-fragment-shader)\n   * @see [Shadertoy](https://www.shadertoy.com/view/XsfXDr)\n   * @see [Figure 13.2. Circle Point Computation](https://nicolbolas.github.io/oldtut/Illumination/Tutorial%2013.html)\n   */\n  float r = sphere.b;\n  float r2 = r*r;\n  vec2 cf = gl_FragCoord.xy-sphere.xy;\n  float cfl2 = dot(cf, cf);\n  float isWide = gt(wide, 1.0);\n\n  // Don't round if maximum width isn't enough.\n  if(isWide*cfl2 > r2) { discard; }\n\n  /** Vector pointing from the `sphere`'s center towards the eye. */\n  vec3 axis = vec3(cf, sqrt(r2-cfl2));\n  vec3 normal = axis/r;\n  float sphereDepth = abs(axis.z/wide);\n\n  #ifdef GL_EXT_frag_depth\n    /** The `sphere`'s fragment depth; scaled (arbitrarily) into depth space. */\n    gl_FragDepthEXT = map(gl_FragCoord.z-(depths.b*sphereDepth),\n      depths.s, depths.t, 0.0, 1.0);\n  #endif\n\n  vec3 lit = lightAmbient;\n  vec3 pe = -positionView.xyz;\n  float peL = length(pe);\n\n  pe /= peL;\n\n  #if lightPointsL > 0\n    for(int l = 0; l < lightPointsL; ++l) {\n      vec3 lightPosition = lightPointPositions[l];\n      vec3 lightColor = lightPointColors[l];\n      vec3 lightFactor = lightPointFactors[l];\n      float rough = material.r;\n      float albedo = material.g;\n      vec3 pl = lightPosition-positionView.xyz;\n      vec2 plL = vec2(dot(pl, pl));\n\n      pl /= (plL.s = sqrt(plL.s));\n\n      lit += lightColor*attenuate(plL, lightFactor)*\n        (diffuse(pl, pe, normal, rough, albedo)+\n          specular(pl, pe, normal, rough));\n    }\n  #endif\n\n  // More transparent looking directly at thin material, if wide enough.\n  float thick = 1.0-abs(normal.z*(1.0-material.z)*isWide);\n  float foggy = min(pow(max(peL-sphereDepth-fog.x, 0.0)*fog.y, fog.z), fog.w);\n  vec3 shade = mix((color.rgb*lit)+emissive, clear.rgb, foggy);\n  float fade = color.a*thick;\n\n  gl_FragColor = vec4(shade*fade, fade);\n}\n"],"names":["$ec69c0cb2b6a31a1$export$7d15b64cf5a3a4c4","x","min","max","$ec69c0cb2b6a31a1$export$5c5ee632c52bc4a2","$5ff19e1f24619c14$export$1991ecd29cc92c6b","a","b","$5ff19e1f24619c14$export$1e044b7877db048c","c","d","$733715210d7ba91b$export$651a6eb01ea522f3","prefix","suffix","msg","undefined","_class","Error","constructor","super","$b0cf6985d1bf99ee$export$ab59e00737fb22e6","$b0cf6985d1bf99ee$export$98e633703a635f","$9e8cd13a24740a44$export$c37d18c23b2ea60c","dispatch","impls","Array","fallback","fn","args","g","length","add","dim","default","impl","$61f1b9869f9bc283$export$64da3195d9348dc4","Object","freeze","$61f1b9869f9bc283$export$74d08f64010bdae6","$61f1b9869f9bc283$export$fd634c4b89e45776","$61f1b9869f9bc283$export$80c2f4851e95e22e","$5b4630f3c3581096$export$772aa0961a81b065","$5b4630f3c3581096$export$9f1b9fbfe882200d","n","$d4fd769b10f895d1$export$1af3c925c49f37a2","fns","e","f","h","i","j","xs","slice","$d4ef3b7af17353ca$export$c915e14294a7d06f","$8c2dba9bcb88d686$export$eca2c7e8e95bbf0a","xform","$59253dee0f6d9da2$export$1af3c925c49f37a2","map","apply","$6194684b3d8f3e2c$export$9652023d9040757","Symbol","iterator","$ec817db8412917bb$export$5adef4befe47917","rfn","$448ae742b1df3dea$export$a7d1fa727cb10b0e","$448ae742b1df3dea$export$ca96bc7645ad7951","$9f6f4d5dcced3934$export$ce266a425291df6c","deref","this","value","val","$9f6f4d5dcced3934$export$447808b60b7559bd","$9f6f4d5dcced3934$export$ebab785f9ea33473","$9f6f4d5dcced3934$export$f2412ace46b7b087","$9f6f4d5dcced3934$export$7ca7c14b24aa137b","$cd6e51f1df8edf10$var$parseArgs","$cd6e51f1df8edf10$export$533b26079ad0b4b","init","complete","reduce","acc","$reduce","$cd6e51f1df8edf10$var$reduceArray","$cd6e51f1df8edf10$var$reduceIterable","$cd6e51f1df8edf10$export$1650419e431d3ba3","$ecf1a68d32b88184$export$4cbf152802aa238","push","$543964fba0104a15$export$6f58e2338da23f4d","y","$543964fba0104a15$export$a6bff14a9cefe0e8","_","$543964fba0104a15$export$9b6eac2a13c3d07","$b211149e2ca2c37f$export$871de8747c9eaa88","src","r","$cdc31f3900adb4f6$export$e5bd5b3b105c2a71","$60aa22503228278a$export$d02631cccf789723","from","to","step","$60aa22503228278a$export$9a58ef0d7ad3278c","i1","n1","Infinity","$c20f21322f5c3b41$export$42d51816ce590c93","sep","first","join","$a1139f6ab37d5aae$export$b7df5d561049483a","m","$4a33c39974791f48$export$9608d0eacffd6284","$4a33c39974791f48$var$$transduce","tfn","$8e5008ab2fe19a4b$export$8901015135f2fb22","iters","s","tuple","v","next","done","$4262448ff70bdd87$export$9e772ae751f37666","$4262448ff70bdd87$export$da5c1e34018ecc43","op","o","$4262448ff70bdd87$export$4061f92b6da4a345","$4262448ff70bdd87$export$5e8f180ef0142226","$aa191e3e961b6e33$var$indicesStrided","sym","$aa191e3e961b6e33$var$lookup","$aa191e3e961b6e33$var$indices","$aa191e3e961b6e33$var$assemble","tpl","syms","ret","opJoin","pre","post","strided","split","$aa191e3e961b6e33$var$assembleG","$aa191e3e961b6e33$export$6d9e0940428d9eae","$aa191e3e961b6e33$export$ef7acd7185315e22","Function","$aa191e3e961b6e33$export$aeba7862bf0c66c4","$aa191e3e961b6e33$export$e40cf5ce9a490533","$4262448ff70bdd87$export$ccd27f3e7091205c","$","$763b93b85c300977$export$adaa4cf7ef1b65be","$763b93b85c300977$export$55640438a4edf3d6","$763b93b85c300977$export$9cbac02f28c9a9a9","$763b93b85c300977$export$a7c139a4194832bf","$b749981b58a69e4d$var$$","$b749981b58a69e4d$export$adaa4cf7ef1b65be","$435238292d3e6e17$export$f0954fd7d5368655","$435238292d3e6e17$export$2191d5173c5a0ec5","$6104990329916807$export$6b5c1ceb16d01dc3","Math","PI","$6104990329916807$export$460c4029b1a54a2e","sqrt","SQRT2","$6104990329916807$export$56469a43a57ad8b6","$4b6fbad7fdfb60ce$export$7d5e3328550ce0cd","theta","sin","cos","$6a288e5ac7bdcdf0$var$$","$6a288e5ac7bdcdf0$export$57ce51e080b800","$6a288e5ac7bdcdf0$export$9bdeebc943bb634d","$3bd401801b8d8a16$export$523c9d3eb3d8d990","$3bd401801b8d8a16$export$b54ddf06b57709b1","$3bd401801b8d8a16$export$1c0ad2738a5ae4b0","$3bd401801b8d8a16$export$1f214a01989f466a","$f0529e3ef4b12485$export$6feaa6aa9769ce13","out","$bd691298fed78422$export$dcfbb7940cfb3a48","$bd691298fed78422$export$ba8c70ce75474f8d","z","$bd691298fed78422$export$abee0037e1db715","w","$bd691298fed78422$export$d58a46c754825a51","$bd691298fed78422$export$644e79245f7d24b5","$7ebff06786be5794$export$c3d49302a4b760b2","m33","$c7c5d1bc7aa405a4$export$91ef8150045801d7","axis","normalize","t","ys","zs","xt","yt","zt","$c7c5d1bc7aa405a4$export$6af315cc92b6bcce","$e7ea728616f7fff3$export$89b5708c387cac6c","left","right","bottom","top","near","far","dx","dy","dz","$e7ea728616f7fff3$export$afe7eeb07fe5f7b2","fovy","aspect","tan","$82059b4fcd3d6640$export$541149539f3a4684","fov","$341c430088d7247a$export$ea0ef2e80b79c3dc","$04cd289c866a5263$var$$","$04cd289c866a5263$export$94132a0e348806d4","$04cd289c866a5263$export$6f9aa2c904053c13","$e0f394f817650d37$export$f93b5905241a7cca","$e0f394f817650d37$export$27409c384c4283a","$e0f394f817650d37$export$4d77c846ee8dc708","$e0f394f817650d37$export$317805a8a51cab87","$52b284cec6c915bc$export$d924e14fd6d9aa66","eye","target","up","$c08475a3abb814d1$var$$","$c08475a3abb814d1$export$cf66b157879064b6","$c08475a3abb814d1$export$78ae608fdbee4899","$c08475a3abb814d1$export$7cff64c0e2ba076b","$0db9fb27841d2deb$export$be747b9875ee8d57","$0db9fb27841d2deb$export$d012f6a5572fd758","$fd9a8e608540655c$export$ee1b3e54f0441b22","$b54ca50f5bdd4d57$export$8eba860695d17007","$b54ca50f5bdd4d57$export$1c6c7bbb3c786559","$a7fa0f3582254b6a$export$ec923e38fabc9186","$a7fa0f3582254b6a$export$52f3cc8bf1fcf271","$c30aba8569446037$var$dp4","$c30aba8569446037$var$dp6","$c30aba8569446037$export$7b7ad19b83443ac6","m00","m01","m02","m03","m10","m11","m12","m13","m20","m21","m22","m23","m30","m31","m32","$c30aba8569446037$export$ea9ce22bf01d0ac","$f50c2d875351a809$var$dp4","$f50c2d875351a809$var$dp6","$f50c2d875351a809$export$6897c284b6f9f4dc","$f50c2d875351a809$export$f3d3af87b23e55b9","det","d01","d11","d21","coeffs","d00","d02","d03","d04","d05","d06","d07","d08","d09","d10","$3c24628525b554a5$export$651a6eb01ea522f3","$2c09503d96cd8db8$export$772aa0961a81b065","$2c09503d96cd8db8$export$9f1b9fbfe882200d","$15e644f6640b52b4$export$1af3c925c49f37a2","$d272869268600ec8$export$c915e14294a7d06f","$65cff94ebfb58e53$export$eca2c7e8e95bbf0a","$82a67af8c3091b62$export$1af3c925c49f37a2","$61dda606b1ba50dd$export$9652023d9040757","$0459eae806dabc25$export$5adef4befe47917","$b9b3bcd84b0b11d0$export$a7d1fa727cb10b0e","$b9b3bcd84b0b11d0$export$ca96bc7645ad7951","$08403c0d77a86076$export$ce266a425291df6c","$08403c0d77a86076$export$447808b60b7559bd","$08403c0d77a86076$export$ebab785f9ea33473","$08403c0d77a86076$export$f2412ace46b7b087","$08403c0d77a86076$export$7ca7c14b24aa137b","$bee6795b28b29810$var$parseArgs","$bee6795b28b29810$export$533b26079ad0b4b","$bee6795b28b29810$var$reduceArray","$bee6795b28b29810$var$reduceIterable","$bee6795b28b29810$export$1650419e431d3ba3","$8655725b29697f58$export$4cbf152802aa238","$68c3592f16e58baf$export$6f58e2338da23f4d","$68c3592f16e58baf$export$a6bff14a9cefe0e8","$68c3592f16e58baf$export$9b6eac2a13c3d07","$fefbba5ee02b65a6$export$871de8747c9eaa88","$36112acd709faaa2$export$e5bd5b3b105c2a71","$d4e53a124aebb81a$export$d02631cccf789723","$d4e53a124aebb81a$export$9a58ef0d7ad3278c","$737426a14ae1c382$export$42d51816ce590c93","$bc72d9348a7814cf$export$b7df5d561049483a","$0500b09f83c283db$export$9608d0eacffd6284","$0500b09f83c283db$var$$transduce","$b88e3746170e4336$export$8901015135f2fb22","$090c7e6fab2f85bc$export$ab59e00737fb22e6","$090c7e6fab2f85bc$export$98e633703a635f","$ced6b867384a1f9b$export$c37d18c23b2ea60c","$6fa9ea0b57707f8c$export$9e772ae751f37666","$6fa9ea0b57707f8c$export$ff73a40106eb353","$6fa9ea0b57707f8c$export$51277e3ac6690f26","$6fa9ea0b57707f8c$export$da5c1e34018ecc43","$6fa9ea0b57707f8c$export$6ab71ad6f57b0093","$6fa9ea0b57707f8c$export$5e8f180ef0142226","$31175cc00429bb2b$var$indicesStrided","$31175cc00429bb2b$var$lookup","$31175cc00429bb2b$var$indices","$31175cc00429bb2b$var$assemble","$31175cc00429bb2b$var$assembleG","$31175cc00429bb2b$var$assembleS","$6fa9ea0b57707f8c$export$ccd27f3e7091205c","$31175cc00429bb2b$export$6d9e0940428d9eae","$31175cc00429bb2b$export$ef7acd7185315e22","$31175cc00429bb2b$export$aeba7862bf0c66c4","$31175cc00429bb2b$export$6c4e26942fd16e7","$31175cc00429bb2b$export$e40cf5ce9a490533","$31175cc00429bb2b$export$503c6222d3c48f54","idxArgs","sizes","$31175cc00429bb2b$export$5d7f662452a819b3","$31175cc00429bb2b$export$24ecd06eea36a882","$2d5368126985e7d9$export$523c9d3eb3d8d990","$2d5368126985e7d9$export$b54ddf06b57709b1","$2d5368126985e7d9$export$1c0ad2738a5ae4b0","$2d5368126985e7d9$export$1f214a01989f466a","$4263ed34f07fb601$export$159d9494db57879b","$4263ed34f07fb601$export$87ee28508e334108","$4263ed34f07fb601$export$515c756757bc7dd6","$4263ed34f07fb601$export$1610da4f4fb6074f","$8991643121119e6e$export$6747e444d0e25f8e","$8991643121119e6e$export$c8a0e366d15bb712","$8991643121119e6e$export$cb6d410f870ee721","$8991643121119e6e$export$9e7986c53a12814a","$232796377ead486a$export$f93b5905241a7cca","$232796377ead486a$export$27409c384c4283a","$232796377ead486a$export$4d77c846ee8dc708","$232796377ead486a$export$317805a8a51cab87","$076346b88f6eb5fa$export$e16d8520af44a096","$076346b88f6eb5fa$export$363c2f72629e4a7f","$076346b88f6eb5fa$export$287691874d09163a","$076346b88f6eb5fa$export$81b475958bcba316","$8107172e4dbdb60c$export$6897c284b6f9f4dc","$8107172e4dbdb60c$export$eb08a4e6e8934de4","$8107172e4dbdb60c$export$2f6df6f9964c34d8","$8107172e4dbdb60c$export$2cac2c285d867dd","$142101175af5fe50$export$dcfbb7940cfb3a48","$142101175af5fe50$export$ba8c70ce75474f8d","$142101175af5fe50$export$abee0037e1db715","$5c4bd089da59d86c$var$tpl","$5c4bd089da59d86c$var$pre","$5c4bd089da59d86c$var$$","$5c4bd089da59d86c$export$1717f45d0ace7417","$5c4bd089da59d86c$export$8ad5a30d17ee2508","$3a435c0bd73a5399$export$49f8ee6768bb070e","$53ef25cecfc5c59e$export$56469a43a57ad8b6","$00b0f56d494185e5$var$$","$00b0f56d494185e5$export$57ce51e080b800","$00b0f56d494185e5$export$9bdeebc943bb634d","$9f3993d959235691$export$adaa4cf7ef1b65be","$9f3993d959235691$export$55640438a4edf3d6","$9f3993d959235691$export$9cbac02f28c9a9a9","$9f3993d959235691$export$a7c139a4194832bf","$e09bee14ba21bb6a$export$6feaa6aa9769ce13","$bf2ada5ebc073771$var$gsl_const","CGS","SPEED_OF_LIGHT","GRAVITATIONAL_CONSTANT","PLANCKS_CONSTANT_H","PLANCKS_CONSTANT_HBAR","ASTRONOMICAL_UNIT","LIGHT_YEAR","PARSEC","GRAV_ACCEL","ELECTRON_VOLT","MASS_ELECTRON","MASS_MUON","MASS_PROTON","MASS_NEUTRON","RYDBERG","BOLTZMANN","MOLAR_GAS","STANDARD_GAS_VOLUME","MINUTE","HOUR","DAY","WEEK","INCH","FOOT","YARD","MILE","NAUTICAL_MILE","FATHOM","MIL","POINT","TEXPOINT","MICRON","ANGSTROM","HECTARE","ACRE","BARN","LITER","US_GALLON","QUART","PINT","CUP","FLUID_OUNCE","TABLESPOON","TEASPOON","CANADIAN_GALLON","UK_GALLON","MILES_PER_HOUR","KILOMETERS_PER_HOUR","KNOT","POUND_MASS","OUNCE_MASS","TON","METRIC_TON","UK_TON","TROY_OUNCE","CARAT","UNIFIED_ATOMIC_MASS","GRAM_FORCE","POUND_FORCE","KILOPOUND_FORCE","POUNDAL","CALORIE","BTU","THERM","HORSEPOWER","BAR","STD_ATMOSPHERE","TORR","METER_OF_MERCURY","INCH_OF_MERCURY","INCH_OF_WATER","PSI","POISE","STOKES","STILB","LUMEN","LUX","PHOT","FOOTCANDLE","LAMBERT","FOOTLAMBERT","CURIE","ROENTGEN","RAD","SOLAR_MASS","BOHR_RADIUS","NEWTON","DYNE","JOULE","ERG","STEFAN_BOLTZMANN_CONSTANT","THOMSON_CROSS_SECTION","CGSM","BOHR_MAGNETON","NUCLEAR_MAGNETON","ELECTRON_MAGNETIC_MOMENT","PROTON_MAGNETIC_MOMENT","FARADAY","ELECTRON_CHARGE","MKS","VACUUM_PERMITTIVITY","VACUUM_PERMEABILITY","DEBYE","GAUSS","MKSA","NUM","FINE_STRUCTURE","AVOGADRO","YOTTA","ZETTA","EXA","PETA","TERA","GIGA","MEGA","KILO","MILLI","MICRO","NANO","PICO","FEMTO","ATTO","ZEPTO","YOCTO","$bf2ada5ebc073771$exports","$1316132715667b29$export$be3f796aed065412","diff","dt","pause","$1316132715667b29$export$7548f4bc1b09ff22","$1316132715667b29$export$85b884786400d38f","$1316132715667b29$export$eb8a9b7a1ebec59a","Date","now","$1316132715667b29$export$2e2bcd8739ae039","state","time","t0","_step","ref","ref1","t1","isNaN","$89beda50188af594$var$r","prototype","$89beda50188af594$export$533b26079ad0b4b","call","$89beda50188af594$export$2e2bcd8739ae039","$c4bc3007b6455a61$export$2e2bcd8739ae039","$79032a9cfe022ef9$var$e","forEach","$79032a9cfe022ef9$export$2e2bcd8739ae039","fill","$2c63bf99ae799f26$var$fill","isFinite","$2c63bf99ae799f26$var$isFinite","Number","floor","$2c63bf99ae799f26$var$floor","$2c63bf99ae799f26$export$2e2bcd8739ae039","l","start","end","$468c4cfcd4415fd1$export$2e2bcd8739ae039","$b899d114aecf61c1$export$2e2bcd8739ae039","$3703f54d1665b027$export$ba60520149d1328e","$3703f54d1665b027$export$85b9a36db797e02b","$3703f54d1665b027$export$878041e1e4cd4218","flat","$699ea889147b78f1$export$dc207adda608f979","$parcel$interopDefault","$699ea889147b78f1$export$cfdc3a7c4cb854c6","$699ea889147b78f1$export$832d88422d279bbc","$699ea889147b78f1$export$ac0cd3cc21f80dfc","$699ea889147b78f1$export$4bceda1224fc5ab8","$699ea889147b78f1$export$b4781c2237bde956","$699ea889147b78f1$export$26945b8c914b7fc","$699ea889147b78f1$export$154f256b9eac9103","$699ea889147b78f1$export$b6267c3f91c57c78","$699ea889147b78f1$export$b029aceb5666f022","$699ea889147b78f1$export$617a37502ff8853","$699ea889147b78f1$export$ff01eb58fe4e69","$699ea889147b78f1$export$27fb0dad99ae5dd2","$699ea889147b78f1$export$47b10f415de592b1","$699ea889147b78f1$export$1fb689c67b965bff","$699ea889147b78f1$export$8d7f4a48e1f2b2a","$699ea889147b78f1$export$a211ab2c8ecded9a","$699ea889147b78f1$export$a1b7c201e9365814","$699ea889147b78f1$export$5544d416ac8224f1","$699ea889147b78f1$export$2902d6d00b7c2bce","$699ea889147b78f1$export$2fcc13103217f9a3","color","depth","stencil","$699ea889147b78f1$export$78f9fb74e68ed5c6","$699ea889147b78f1$export$72e520e6a70b780c","copy","$65ce5154e50f483f$var$_cache","$65ce5154e50f483f$var$_step","$65ce5154e50f483f$var$_reads","$65ce5154e50f483f$var$_pass","$65ce5154e50f483f$var$_ref","$65ce5154e50f483f$var$_valueNext","isInteger","$65ce5154e50f483f$var$isInteger","isArray","$65ce5154e50f483f$var$isArray","$65ce5154e50f483f$export$5ca26c99531348ec","channelsMax","console","error","$65ce5154e50f483f$export$9d1d9285bd6d8c57","values","channels","packed","fitIndex","fitSize","fit","pack","$65ce5154e50f483f$export$574963e692b662ec","maps","derives","passes","textures","valueToTexture","reads","cache","allStepSamples","getAddSample","pass","valueNext","set","derive","dp","texture","findIndex","samples","p","dn","getAddSamples","$65ce5154e50f483f$export$798cdecdcbbf9755","buffersMax","valueToPass","textureToPass","output","getIndex","getValue","index","$65ce5154e50f483f$export$96707a1f51900f3d","$cf3851181e517041$var$isFinite","$cf3851181e517041$var$isInteger","$cf3851181e517041$export$3c49c185de0c2bfc","width","shape","size","side","v0","ref2","ref3","ref4","ref5","$cf3851181e517041$export$c08559766941f856","height","v1","$cf3851181e517041$var$ref","$cf3851181e517041$var$ref1","$cf3851181e517041$var$ref2","$cf3851181e517041$export$87ed20f81f3c66ff","entries","$cf3851181e517041$export$2815acae70277c92","$cf3851181e517041$export$f99427edb65f5558","scale","$7d42eff872c88882$var$_textures","$7d42eff872c88882$var$_step","$7d42eff872c88882$var$_passes","$7d42eff872c88882$var$_step1","$7d42eff872c88882$var$isInteger","$7d42eff872c88882$var$mergeDef","steps","$7d42eff872c88882$export$24a6b176bdc41ce5","framebuffer","type","mag","wrap","scaled","channelsMin","texturesMap","passesMap","_length","stepsL","merge","passChannels","sum","mergeChannels","framebuffers","colors","colorPool","addTexture","entry","addPass","mScale","all","mAll","mNext","mScaled","mw","ref6","ref7","mh","$5bf334de58f5e290$var$_state","$5bf334de58f5e290$export$1aad3af825e3305b","$5bf334de58f5e290$var$_uniforms","uniforms","bound","texturesL","stateShape","viewShape","stepNow","drawingBufferWidth","drawingBufferHeight","addTextures","ago","ts","pl","$a167e8ea6bbf8bb3$var$start","$a167e8ea6bbf8bb3$var$end","$a167e8ea6bbf8bb3$export$bf9fb029d174d554","toString","$8b3b066d03fa4cc4$var$_cache","$8b3b066d03fa4cc4$var$_ref","$8b3b066d03fa4cc4$var$lf","$8b3b066d03fa4cc4$export$4e46ac54fc82cf3b","$8b3b066d03fa4cc4$export$497faa7f0daf9da","$8b3b066d03fa4cc4$var$id","JSON","stringify","$8b3b066d03fa4cc4$export$11949c6f5fba7dcd","$8b3b066d03fa4cc4$export$feaf5ffc92c2af94","key","on","macros","$8b3b066d03fa4cc4$var$ref","$8b3b066d03fa4cc4$export$83d01c7b88bc16d5","name","qualify","$8b3b066d03fa4cc4$export$45db4de6da38aa8d","$8b3b066d03fa4cc4$export$3df19e70a88cb8cd","$8b3b066d03fa4cc4$export$1c7039c93eddfba","$8b3b066d03fa4cc4$export$c346962e7dd3191","glsl","trim","$8b3b066d03fa4cc4$var$ref1","$8b3b066d03fa4cc4$export$d38b14fb9031108e","passesL","$8b3b066d03fa4cc4$export$84186522bf5a7d4d","passNow","$8b3b066d03fa4cc4$export$49873e279ff642c0","passSamples","passReads","$8b3b066d03fa4cc4$export$9cb6037fa2a40c2e","glsl3","tap","by","aka","akaBy","st","tapsSamples","$8b3b066d03fa4cc4$export$562ddd36066ad650","$1a374edfd27fba4d$var$_verts","$1a374edfd27fba4d$var$_p","$1a374edfd27fba4d$var$_frags","$1a374edfd27fba4d$var$_p1","$1a374edfd27fba4d$var$_ref","$1a374edfd27fba4d$export$d86e3abd7686c23f","ps","$1a374edfd27fba4d$export$12661000d11a17d2","copyFrame","cf","copyImage","ci","subimage","sl","use","$1a374edfd27fba4d$export$d89197afac86b993","api","buffer","clear","command","pipeline","verts","frag","frags","attributes","vert","replaceAll","count","positions","vs","fs","enable","_update","update","onPass","onStep","stepMax","clearPass","mergeUpdate","stepProps","passProps","$48449d871f87e3df$var$_maps","$48449d871f87e3df$var$_to","$48449d871f87e3df$var$_to1","$48449d871f87e3df$var$isFinite","$48449d871f87e3df$var$ref","$48449d871f87e3df$export$2e2bcd8739ae039","_limits","maxDrawbuffers","apiGLSL","limits","version","parseFloat","match","_buffersMax","_maps1","_uniforms","$7be1562a8ac0a4e2$export$2e2bcd8739ae039","states","form","$d0656bc8f7624269$export$2c9e8a9632a706b2","$2060e0e40b39b992$export$5fde601f2db1a7a6","$2060e0e40b39b992$export$f5f3637a663c816","$2060e0e40b39b992$export$b845ad3a59cfd772","$2060e0e40b39b992$export$5a6ac9c3945935e8","op1","op2","$6490e68280e85459$export$b1681e55aa41cf93","$6490e68280e85459$export$ce03ce82183fcacf","$6490e68280e85459$export$fce72d6f58f3bf47","$6490e68280e85459$export$cbb07426a95117ea","$e565ba4c701c62e2$export$5dceb76539a08116","$261f920c3c8ece79$var$mi","$261f920c3c8ece79$var$mx","$261f920c3c8ece79$export$c2fad5ac839d6a20","$261f920c3c8ece79$export$8b0b3f9a2d1cfdb4","$1005debad1977863$var$cos","$1005debad1977863$var$sin","$1005debad1977863$export$6e6697ef026a96","$1005debad1977863$export$c922d23b3f1f2998","phi","ct","$f7d3c1ea3ca91c4d$var$sin","$f7d3c1ea3ca91c4d$var$cos","$f7d3c1ea3ca91c4d$export$5610d322dd37c6c0","random","$b3b786a244f0f899$var$random","$b3b786a244f0f899$var$min","$b3b786a244f0f899$var$pi","TAU","$b3b786a244f0f899$var$tau","$b3b786a244f0f899$export$267b06a7460aa7d3","at","idle","radius","yaw","spin","turn","wait","curve","pole","atl","$9a6b765804fb9ec0$var$ref","$9a6b765804fb9ec0$var$ref1","$9a6b765804fb9ec0$var$ref2","$9a6b765804fb9ec0$var$ref3","$9a6b765804fb9ec0$var$ugc","$9a6b765804fb9ec0$var$g","abs","$9a6b765804fb9ec0$var$abs","$9a6b765804fb9ec0$var$floor","$9a6b765804fb9ec0$var$random","$9a6b765804fb9ec0$var$sin","$9a6b765804fb9ec0$var$cos","$9a6b765804fb9ec0$var$min","$9a6b765804fb9ec0$var$max","$9a6b765804fb9ec0$var$sqrt","log2","$9a6b765804fb9ec0$var$log2","$9a6b765804fb9ec0$var$pi","$9a6b765804fb9ec0$var$tau","self","gpgpu","macroPass","mapStep","toUniforms","getDrawIndexes","indexForms","$9a6b765804fb9ec0$var$canvas","document","querySelector","$9a6b765804fb9ec0$var$scroll","scrollIntoView","$9a6b765804fb9ec0$var$scrollDefer","setTimeout","$9a6b765804fb9ec0$var$toggleError","classList","$9a6b765804fb9ec0$var$getQuery","search","location","URLSearchParams","$9a6b765804fb9ec0$var$query","$9a6b765804fb9ec0$var$fragDepth","get","$9a6b765804fb9ec0$var$extend","required","optional","$9a6b765804fb9ec0$var$pixelRatio","devicePixelRatio","$9a6b765804fb9ec0$var$regl","regl","$bfb2626fd038bacb$exports","extensions","optionalExtensions","onDone","group","log","hasExtension","groupEnd","$9a6b765804fb9ec0$var$valuesMap","Map","$9a6b765804fb9ec0$var$values","$9a6b765804fb9ec0$var$valuesIndex","k","maxTextureUnits","$9a6b765804fb9ec0$var$maxTextureUnits","maxTextureSize","$9a6b765804fb9ec0$var$maxTextureSize","lineWidthDims","$9a6b765804fb9ec0$var$lineWidthDims","pointSizeDims","$9a6b765804fb9ec0$var$pointSizeDims","depthBits","$9a6b765804fb9ec0$var$depthBits","$9a6b765804fb9ec0$var$merge","$9a6b765804fb9ec0$var$limits","$9a6b765804fb9ec0$var$niceScale","$9a6b765804fb9ec0$var$scale","$9a6b765804fb9ec0$var$steps","$9a6b765804fb9ec0$var$stepsPast","$9a6b765804fb9ec0$var$canVerlet","$9a6b765804fb9ec0$var$prefill","$9a6b765804fb9ec0$var$form","$9a6b765804fb9ec0$var$wide","$9a6b765804fb9ec0$var$spin0","$9a6b765804fb9ec0$var$spinPace","$9a6b765804fb9ec0$var$spoutPace","$9a6b765804fb9ec0$var$gapZ","$9a6b765804fb9ec0$var$shakeSource","$9a6b765804fb9ec0$var$shakeSink","$9a6b765804fb9ec0$var$fizz","rate","$9a6b765804fb9ec0$var$hues","getAll","$9a6b765804fb9ec0$var$lit","$9a6b765804fb9ec0$var$paceLit","$9a6b765804fb9ec0$var$rough","$9a6b765804fb9ec0$var$albedo","$9a6b765804fb9ec0$var$skin","$9a6b765804fb9ec0$var$timeQuery","$9a6b765804fb9ec0$var$timestepDef","$9a6b765804fb9ec0$var$timestep","$9a6b765804fb9ec0$var$flipPointer","$9a6b765804fb9ec0$var$guide","$9a6b765804fb9ec0$var$setupLink","hash","has","href","q","delete","$9a6b765804fb9ec0$var$setQuery","$9a6b765804fb9ec0$var$hashScroll","addEventListener","querySelectorAll","checked","$9a6b765804fb9ec0$var$derives","position","motion","life","$9a6b765804fb9ec0$var$toShake","props","timer","shake","$9a6b765804fb9ec0$var$state","every","dt0","dts","dt1","loop","source","sink","lifetime","prop","useVerlet","epsilon","moveCap","pace","spout","ss","u","$9a6b765804fb9ec0$var$drawBound","$9a6b765804fb9ec0$var$drawSteps","$9a6b765804fb9ec0$var$useLines","$9a6b765804fb9ec0$var$drawCounts","$9a6b765804fb9ec0$var$viewScale","$9a6b765804fb9ec0$var$drawState","drawProps","model","matrix","inverse","rotation","angle","angle0","view","ray","projection","transform","modelView","modelViewProjection","light","ambient","points","factor","material","depths","fog","counts","primitives","widths","paceColor","$9a6b765804fb9ec0$var$drawUniforms","fizz","fizzMax","fizzRate","fizzCurve","hues","lightAmbient","wide","ws","$9a6b765804fb9ec0$var$lightPoints","$9a6b765804fb9ec0$var$ref4","$9a6b765804fb9ec0$var$ref5","lp","$9a6b765804fb9ec0$var$drawPipeline","lineWidth","cs","blend","func","dst","primitive","drawState","drawPipeline","$9a6b765804fb9ec0$var$draw","$9a6b765804fb9ec0$var$clearView","$9a6b765804fb9ec0$var$rotateModel","mm","mi","$9a6b765804fb9ec0$var$stopEvent","stopPropagation","preventDefault","$9a6b765804fb9ec0$var$hold","$9a6b765804fb9ec0$var$resize","ar","innerWidth","innerHeight","$9a6b765804fb9ec0$var$aspect","$9a6b765804fb9ec0$var$frameStep","$9a6b765804fb9ec0$var$stepTime","vm","vi","$9a6b765804fb9ec0$var$updateView","d0","d1","pm","pi","$9a6b765804fb9ec0$var$updateProjection","spawned","held","button","flipPointer","clientX","clientY","pointerType","isPrimary","getBoundingClientRect","touch","pick","ro","rv","body","remove","requestFullscreen","frame","tmv","viewProjection","tvp","tmvp","$9a6b765804fb9ec0$var$updateTransform"],"version":3,"file":"index.a2fdbf85.js.map"}